var i,o,a,s,r={allowDownsampling:!0},l=function(){function t(t,e){var n=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return n._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=e,this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw Error("No window is associated with the canvas");return t.devicePixelRatio>1||this._options.allowDownsampling?t.devicePixelRatio:1},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter(function(e){return e!=t})},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach(function(e){return e.call(t)})},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw Error("No window is associated with the canvas");var e=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+e+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}(),c=3,u=function(t,e){return t.defaultOptions[e]};(s=i||(i={})).Blue="#428BF9",s.Green="#13C17B",s.Red="#EC4756",s.Yellow="#FFD40A",s.Orange="#FF7B00",s.Purple="#7874D6",function(t){t[t.thin=1]="thin",t[t.medium=2]="medium",t[t.thick=3]="thick"}(o||(o={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed"}(a||(a={}));var d=function(t,e){return e.colors[t]},h=function(t,e){return(h=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function p(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var f=function(){return(f=Object.assign||function(t){for(var e,n=1,C=arguments.length;n<C;n++)for(var _ in e=arguments[n])Object.prototype.hasOwnProperty.call(e,_)&&(t[_]=e[_]);return t}).apply(this,arguments)};function m(t,e){var n={};for(var C in t)Object.prototype.hasOwnProperty.call(t,C)&&0>e.indexOf(C)&&(n[C]=t[C]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var _=0;for(C=Object.getOwnPropertySymbols(t);_<C.length;_++)0>e.indexOf(C[_])&&Object.prototype.propertyIsEnumerable.call(t,C[_])&&(n[C[_]]=t[C[_]])}return n}function g(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],C=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&C>=t.length&&(t=void 0),{value:t&&t[C++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function v(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var C,_,ts=n.call(t),ta=[];try{for(;(void 0===e||e-- >0)&&!(C=ts.next()).done;)ta.push(C.value)}catch(tl){_={error:tl}}finally{try{C&&!C.done&&(n=ts.return)&&n.call(ts)}finally{if(_)throw _.error}}return ta}function y(t,e,n){if(n||2===arguments.length)for(var C,_=0,ts=e.length;_<ts;_++)!C&&_ in e||(C||(C=Array.prototype.slice.call(e,0,_)),C[_]=e[_]);return t.concat(C||Array.prototype.slice.call(e))}var LineType,LineStyle,b="undefined"!=typeof window,w=function(){function t(){}return t.prototype.setErrorHandler=function(t){var e=this;b&&(this._removeHandler(),t&&(this._errorHandler=function(n){var C;if(n.error){var _=n.error;(null===(C=e._prevError)||void 0===C?void 0:C.message)!==_.message&&(t({name:_.name,stack:_.stack,message:_.message}),e._prevError=_)}},window.addEventListener("error",this._errorHandler)))},t.prototype.destroy=function(){this._removeHandler(),this._prevError=void 0,this._errorHandler=void 0},t.prototype._removeHandler=function(){this._errorHandler&&window.removeEventListener("error",this._errorHandler)},t}(),x=new w,S=function(t){function e(e){var n=t.call(this,e)||this;return n.name="lightweight-chart-error",n}return p(e,t),e}(Error),E=function(t){return t instanceof S},M=function(t){return x.setErrorHandler(t)};function k(t,e){var n,C=((n={})[0]=[],n[1]=[t.lineWidth,t.lineWidth],n[2]=[2*t.lineWidth,2*t.lineWidth],n[3]=[6*t.lineWidth,6*t.lineWidth],n[4]=[t.lineWidth,4*t.lineWidth],n)[e];t.setLineDash(C)}function T(t,e,n,C){t.beginPath();var _=t.lineWidth%2?.5:0;t.moveTo(n,e+_),t.lineTo(C,e+_),t.stroke()}function I(t,e,n,C){t.beginPath();var _=t.lineWidth%2?.5:0;t.moveTo(e+_,n),t.lineTo(e+_,C),t.stroke()}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps"}(LineType||(LineType={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(LineStyle||(LineStyle={}));var H="M0.8 0.6L3.6 2.7C3.85181 2.88885 4 3.18524 4 3.5C4 3.81476 3.85181 4.11115 3.6 4.3L0.8 6.4C0.470382 6.64721 0 6.41202 0 6V1C0 0.587977 0.470382 0.352786 0.8 0.6Z";function N(t,e){if(!t)throw new S("Assertion failed"+(e?": "+e:""))}function P(t){if(void 0===t)throw new S("Value is undefined");return t}function O(t){if(null===t)throw new S("Value is null");return t}function D(t){return O(P(t))}function A(t){return null!=t}function L(t){for(var e,n,C=[],_=1;_<arguments.length;_++)C[_-1]=arguments[_];try{for(var ts=g(C),ta=ts.next();!ta.done;ta=ts.next()){var tl=ta.value;for(var th in tl)void 0!==tl[th]&&("object"!=typeof tl[th]||"object"!=typeof t[th]||null===tl[th]||void 0===t[th]||null===t[th]||Array.isArray(tl[th])||Array.isArray(t[th])?t[th]=tl[th]:L(t[th],tl[th]))}}catch(tc){e={error:tc}}finally{try{ta&&!ta.done&&(n=ts.return)&&n.call(ts)}finally{if(e)throw e.error}}return t}function R(t){return"number"==typeof t&&isFinite(t)}function F(t){return"number"==typeof t&&t%1==0}function B(t){return"string"==typeof t}function V(t){return"boolean"==typeof t}function z(t){var e,n,C,_=t;if(!_||"object"!=typeof _)return _;for(n in e=Array.isArray(_)?[]:{},_)_.hasOwnProperty(n)&&(C=_[n],e[n]=C&&"object"==typeof C?z(C):C);return e}function W(t){return null!==t}function j(t){return null===t?void 0:t}function G(t,e){if(t===e)return!0;if("object"==typeof t&&null!=t&&"object"==typeof e&&null!=e){if(Object.keys(t).length!=Object.keys(e).length)return!1;for(var n in t)if(!e.hasOwnProperty(n)||!G(t[n],e[n]))return!1;return!0}return!1}var U=function(){function t(t){this._hitTestCustom=t,this._renderers=[]}return t.prototype.setRenderers=function(t){this._renderers=t},t.prototype.draw=function(t,e,n,C){this._renderers.forEach(function(_){t.save(),_.draw(t,e,n,C),t.restore()})},t.prototype.hitTest=function(t,e){var n,C,_,ts,ta=null===(_=this._hitTestCustom)||void 0===_?void 0:_.call(this,t,e);if(ta)return ta;try{for(var tl=g(this._renderers),th=tl.next();!th.done;th=tl.next()){var tc=th.value,td=null===(ts=tc.hitTest)||void 0===ts?void 0:ts.call(tc,t,e);if(td)return td}}catch(tu){n={error:tu}}finally{try{th&&!th.done&&(C=tl.return)&&C.call(tl)}finally{if(n)throw n.error}}return null},t}(),Z=function(){function t(){}return t.prototype.draw=function(t,e,n,C){t.save(),t.scale(e,e),this._drawImpl(t,n,C),t.restore()},t.prototype.drawBackground=function(t,e,n,C){t.save(),t.scale(e,e),this._drawBackgroundImpl(t,n,C),t.restore()},t.prototype._drawBackgroundImpl=function(t,e,n){},t}(),q=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._data=null,e}return p(e,t),e.prototype.setData=function(t){this._data=t},e.prototype._drawImpl=function(t){if(null!==this._data&&null!==this._data.visibleRange){var e=this._data.visibleRange,n=this._data,C=function(C){t.beginPath();for(var _=e.to-1;_>=e.from;--_){var ts=n.items[_];t.moveTo(ts.x,ts.y),t.arc(ts.x,ts.y,C,0,2*Math.PI)}t.fill()};t.fillStyle=n.backColor,C(n.radius+2),t.fillStyle=n.lineColor,C(n.radius)}},e}(Z);function K(){return{items:[{x:0,y:0,time:0,price:0}],lineColor:"",backColor:"",radius:0,visibleRange:null}}var Y,X,$,J={from:0,to:1},Q=function(){function t(t,e){this._compositeRenderer=new U,this._markersRenderers=[],this._markersData=[],this._validated=new Map,this._chartModel=t,this._crosshair=e,this._compositeRenderer.setRenderers(this._markersRenderers)}return t.prototype.update=function(t){var e=this._chartModel.serieses();e.length!==this._markersRenderers.length&&(this._markersData=e.map(K),this._markersRenderers=this._markersData.map(function(t){var e=new q;return e.setData(t),e}),this._compositeRenderer.setRenderers(this._markersRenderers)),this._validated.clear()},t.prototype.renderer=function(t,e,n,C){var _=this._validated.get(n);if(!_){_=this._updateImpl(n,t),this._validated.set(n,_);var ts=new U;return ts.setRenderers(_),ts}var ta=new U;return ta.setRenderers(_),ta},t.prototype._updateImpl=function(t,e){var n=this,C=this._chartModel.serieses().map(function(t,e){return[t,e]}).filter(function(e){return t.dataSources().includes(e[0])}),_=this._crosshair.appliedIndex(),ts=this._chartModel.timeScale();return C.map(function(t){var C,ta=v(t,2),tl=ta[0],th=ta[1],tc=n._markersData[th],td=tl.markerDataAtIndex(_);if(null!==td&&tl.visible()){var tu=O(tl.firstValue());tc.lineColor=td.backgroundColor,tc.radius=td.radius,tc.items[0].price=td.price,tc.items[0].y=tl.priceScale().priceToCoordinate(td.price,tu.value),tc.backColor=null!==(C=td.borderColor)&&void 0!==C?C:n._chartModel.backgroundColorAtYPercentFromTop(tc.items[0].y/e),tc.items[0].time=_,tc.items[0].x=ts.indexToCoordinate(_),tc.visibleRange=J}else tc.visibleRange=null;return n._markersRenderers[th]})},t}();function ee(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function te(t){if(t>=1)return 0;for(var e=0;e<8&&!(1e-8>Math.abs(Math.round(t)-t));e++){t*=10}return e}function ne(t,e){var n=te(e);return+(Math.round(t/e)*e).toFixed(n)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(Y||(Y={})),function(t){t[t.LastPriceAndPercentageValue=0]="LastPriceAndPercentageValue",t[t.LastValueAccordingToScale=1]="LastValueAccordingToScale"}(X||(X={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}($||($={}));var re={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function ie(t){return t<0?0:t>255?255:Math.round(t)||0}function oe(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}var ae=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,se=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,le=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,ce=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function ue(t){var e;if((t=t.toLowerCase())in re&&(t=re[t]),e=ce.exec(t)||le.exec(t))return[ie(parseInt(e[1],10)),ie(parseInt(e[2],10)),ie(parseInt(e[3],10)),oe(e.length<5?1:parseFloat(e[4]))];if(e=se.exec(t))return[ie(parseInt(e[1],16)),ie(parseInt(e[2],16)),ie(parseInt(e[3],16)),1];if(e=ae.exec(t))return[ie(17*parseInt(e[1],16)),ie(17*parseInt(e[2],16)),ie(17*parseInt(e[3],16)),1];throw new S("Cannot parse color: "+t)}function de(t){var e,n=ue(t);return{background:"rgb("+n[0]+", "+n[1]+", "+n[2]+")",foreground:.199*(e=n)[0]+.687*e[1]+.114*e[2]>180?"black":"white"}}var he=function(t,e){var n=ue(t);return"rgba("+n[0]+", "+n[1]+", "+n[2]+", "+e+")"},pe=function(){function t(t){this._canvasCoords=null,this._data=t}return t.prototype.draw=function(t,e){if(this._canvasCoords=t.canvas.getBoundingClientRect(),null!==this._data){var n=this._data.vertLine.visible,C=this._data.horzLine.visible;if(n||C){t.save();var _=Math.round(this._data.x*e),ts=Math.round(this._data.y*e),ta=Math.ceil(this._data.w*e),tl=Math.ceil(this._data.h*e);if(t.lineCap="butt",n&&_>=0&&(t.lineWidth=Math.floor(this._data.vertLine.lineWidth*e),t.strokeStyle=this._data.vertLine.color,t.fillStyle=this._data.vertLine.color,k(t,this._data.vertLine.lineStyle),I(t,_,0,tl)),C&&ts>=0&&(t.lineWidth=Math.floor(this._data.horzLine.lineWidth*e),t.strokeStyle=this._data.horzLine.color,t.fillStyle=this._data.horzLine.color,k(t,this._data.horzLine.lineStyle),T(t,ts,0,ta),this._data.withPlus)){var th=Math.floor(this._data.plusIconSize*e),tc=Math.floor(e%2),td=ts-Math.floor(.5*tc),tu=td-Math.floor(th/2),tp=td+tc+(td-tu)-tu,t8=Math.round(ta-tp-fe*e);t.fillRect(t8,tu,tp,tp);var tf=Math.round(tp/4);t.strokeStyle=de(this._data.horzLine.color).foreground,t.lineWidth=Math.floor(1*e),k(t,0),T(t,ts,t8+tf,t8+tp-tf),I(t,Math.round(t8+tp/2)-tc,Math.round(ts+tp/2-tf),Math.round(ts-tp/2+tf))}t.restore()}}},t.prototype.getCanvasCoords=function(){return this._canvasCoords},t.prototype.hitTest=function(t,e){if(!(null===(n=this._data)||void 0===n?void 0:n.withPlus))return null;var n,C=this._data,_=C.w,ts=C.plusIconSize;return t>=_-ts-fe&&t<=_-fe&&e>=e-ts/2&&e<=e+ts/2?{}:null},t}(),fe=1,me=function(){function t(t){this._validated=new Map,this._withPlus=!1,this._rendererData={vertLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},horzLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},w:0,h:0,x:0,y:0,withPlus:!1,plusIconSize:20},this._renderer=new pe(this._rendererData),this._source=t}return t.prototype.update=function(){this._validated.clear()},t.prototype.renderer=function(t,e,n){return this._updateImpl(n),this._renderer},t.prototype._updateImpl=function(t){var e=this._source.visible(),n=O(this._source.pane()),C=n.model().options().crosshair,_=this._rendererData;_.horzLine.visible=e&&this._source.horzLineVisible(t),_.vertLine.visible=e&&this._source.vertLineVisible(),_.horzLine.lineWidth=C.horzLine.width,_.horzLine.lineStyle=C.horzLine.style,_.horzLine.color=C.horzLine.color,_.vertLine.lineWidth=C.vertLine.width,_.vertLine.lineStyle=C.vertLine.style,_.vertLine.color=C.vertLine.color,_.w=t.width(),_.h=t.height(),_.x=this._source.appliedX(),_.y=this._source.appliedY(),_.withPlus=this._withPlus=n.model().getPaneIndex(t)===n.model().mainPaneIndex&&!!n.model().options().onPlusClick&&!n.model().isDrawingToolActive()&&!n.model().hasActiveIndicator();var ts=n.model().priceAxisRendererOptions(),ta=ts.fontSize,tl=ts.paddingBottom,th=ts.paddingTop;_.plusIconSize=ta+tl+th},t.prototype.clickHandler=function(t,e){var n,C,_,ts=O(this._source.pane()).model().options().onPlusClick;if(ts&&this._withPlus){var ta=null!==(_=null===(C=null===(n=this._source.pane())||void 0===n?void 0:n.defaultPriceScale().formatterSource())||void 0===C?void 0:C.minMove())&&void 0!==_?_:.01,tl=this._source.appliedPrice(),th=O(this._renderer.getCanvasCoords());ts({price:ne(tl,ta),clientX:t,clientY:e,pageX:th.left+window.scrollX+t,pageY:th.top+window.scrollY+e,screenX:th.left+t,screenY:th.top+e})}},t}();function ge(t,e,n,C,_,ts){t.fillRect(e+ts,n,C-2*ts,ts),t.fillRect(e+ts,n+_-ts,C-2*ts,ts),t.fillRect(e,n,ts,_),t.fillRect(e+C-ts,n,ts,_)}function ve(t,e,n){t.save(),t.scale(e,e),n(),t.restore()}function ye(t,e,n,C,_,ts){t.save(),t.globalCompositeOperation="copy",t.fillStyle=ts,t.fillRect(e,n,C,_),t.restore()}function _e(t,e,n,C,_,ts,ta){t.save(),t.globalCompositeOperation="copy";var tl=t.createLinearGradient(0,0,0,_);tl.addColorStop(0,ts),tl.addColorStop(1,ta),t.fillStyle=tl,t.fillRect(e,n,C,_),t.restore()}var CrosshairMode,be=new Map,we=function(){function t(t,e){this._coordinates=[],this.setData(t,e)}return t.prototype.setData=function(t,e){this._data=t,this._commonData=e},t.prototype.draw=function(t,e,n,C,_,ts){var ta;if(this._data.visible){t.font=e.font;var tl=1*ts,th=this._data.tickVisible||!this._data.moveTextToInvisibleTick?e.tickLength:0,tc=e.borderSize,td=e.paddingTop,tu=e.paddingBottom,tp=e.paddingInner,t8=e.paddingOuter,tf=this._data.text,tv=this._data.icon,tg=this._data.withCancel,tm=Math.ceil(n.measureText(t,tf)),ty=e.baselineOffset,t$=e.fontSize+td+tu,tS=t$+1,tb=this._data.fullWidth?C:tc+tm+1+tp+t8+th+(this._data.withCancel?tS:0),tw=this._commonData.coordinate;this._commonData.fixedCoordinate&&!this._data.edgeMargin&&(tw=this._commonData.fixedCoordinate);var tx,tP,tC=(tw=Math.round(tw))-Math.ceil(.5*t$),t_=tC+t$,tT="right"===_,tk=null!==(ta=this._data.edgeMargin)&&void 0!==ta?ta:0,tI=tT?C-tk:tk,tR=tI;if(t.fillStyle=this._commonData.background,t.lineWidth=1,t.lineCap="butt",tf){tT?(tx=tI-th,tP=(tR=tI-tb)+t8):(tR=tI+tb,tx=tI+th,tP=tI+tc+th+tp);var tA=Math.max(1,Math.floor(ts)),tM=tT?Math.ceil(tI*ts):0,tD=tM-(tg?Math.ceil(tS*ts):0),tV=Math.round(tC*ts),tL=Math.round(tR*ts),tO=Math.round(tw*ts)-Math.floor(.5*ts),tE=tO+tA+(tO-tV),tB=Math.round(tx*ts);if(t.save(),t.beginPath(),t.moveTo(tD,tV),t.lineTo(tL,tV),t.lineTo(tL,tE),t.lineTo(tD,tE),t.fill(),tg){var tz=tD+tl;t.fillRect(tz,tV,tM-tz,tE-tV);var tW=Math.round((tM-tz)/3.5);t.strokeStyle="white"===this._commonData.color?he("#FFFFFF",1):this._commonData.color,t.lineWidth=Math.floor(1*ts),t.beginPath(),t.moveTo(tz+tW,tV+tW),t.lineTo(tM-tW,tE-tW),t.stroke(),t.beginPath(),t.moveTo(tM-tW,tV+tW),t.lineTo(tz+tW,tE-tW),t.stroke()}return this._data.tickVisible&&(t.fillStyle=this._commonData.color,t.fillRect(tM,tO,tB-tM,tA)),t.textAlign="left",t.fillStyle=this._commonData.color,tv&&function(t,e){var n=e.icon,C=e.x,_=e.y,ts=e.pixelRatio,ta=be.get(n);if(ta)ve(t,ts,function(){t.drawImage(ta,C,_)});else{var tl=new Image;tl.src="data:image/svg+xml;utf8,"+n,tl.onload=function(){be.set(n,tl),ve(t,ts,function(){t.drawImage(tl,C,_)})}}}(t,{icon:tv,x:tR+tm/2-1,y:tC+1,pixelRatio:ts}),ve(t,ts,function(){t.fillText(tf,tP,t_-tu-ty)}),t.restore(),this._coordinates=[{bottom:tE,top:tV,right:tD,left:tL,externalId:this._data.externalId,source:"axis"},{bottom:tE,top:tV,left:tD+tl,right:tM,externalId:this._data.cancelExternalId,source:"pane"}],this._coordinates}}},t.prototype.height=function(t,e){return this._data.visible?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),xe=function(){function t(t){this._commonRendererData={coordinate:0,color:"#FFF",background:"#000"},this._axisRendererData={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:""},this._paneRendererData={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:""},this._invalidated=!0,this._axisRenderer=new(t||we)(this._axisRendererData,this._commonRendererData),this._paneRenderer=new(t||we)(this._paneRendererData,this._commonRendererData)}return t.prototype.text=function(){return this._axisRendererData.text},t.prototype.coordinate=function(){return this._updateRendererDataIfNeeded(),this._commonRendererData.coordinate},t.prototype.update=function(){this._invalidated=!0},t.prototype.height=function(t,e){return void 0===e&&(e=!1),Math.max(this._axisRenderer.height(t,e),this._paneRenderer.height(t,e))},t.prototype.getFixedCoordinate=function(){return this._commonRendererData.fixedCoordinate||0},t.prototype.setFixedCoordinate=function(t){this._commonRendererData.fixedCoordinate=t},t.prototype.isVisible=function(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible||this._paneRendererData.visible},t.prototype.isAxisLabelVisible=function(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible},t.prototype.renderer=function(t){return this._updateRendererDataIfNeeded(),this._axisRendererData.tickVisible=this._axisRendererData.tickVisible&&t.options().drawTicks,this._paneRendererData.tickVisible=this._paneRendererData.tickVisible&&t.options().drawTicks,this._axisRenderer.setData(this._axisRendererData,this._commonRendererData),this._paneRenderer.setData(this._paneRendererData,this._commonRendererData),this._axisRenderer},t.prototype.paneRenderer=function(){return this._updateRendererDataIfNeeded(),this._axisRenderer.setData(this._axisRendererData,this._commonRendererData),this._paneRenderer.setData(this._paneRendererData,this._commonRendererData),this._paneRenderer},t.prototype._updateRendererDataIfNeeded=function(){this._invalidated&&(this._axisRendererData.tickVisible=!0,this._paneRendererData.tickVisible=!1,this._updateRendererData(this._axisRendererData,this._paneRendererData,this._commonRendererData))},t}(),Se=function(t){function e(e,n,C){var _=t.call(this)||this;return _._source=e,_._priceScale=n,_._valueProvider=C,_}return p(e,t),e.prototype._updateRendererData=function(t,e,n){t.visible=!1;var C=this._source.options().horzLine;if(C.labelVisible){var _=this._priceScale.firstValue();if(this._source.visible()&&!this._priceScale.isEmpty()&&null!==_){var ts=de(C.labelBackgroundColor);n.background=ts.background,n.color=ts.foreground;var ta=this._valueProvider(this._priceScale);n.coordinate=ta.coordinate,t.text=this._priceScale.formatPrice(ta.price,_),t.visible=!0,t.fullWidth=!0}}},e}(xe),Ee=/[1-9]/g,Me=function(){function t(t,e){var n=this;void 0===t&&(t=!0),this._data=[],this.setBackgroundBetween=function(t){n.backgroundBetween=t},this.drawLabel=function(t,e,C){return function(_){if(null!==_&&!1!==_.visible&&0!==_.text.length){t.font=e.font;var ts=Math.round(e.widthCache.measureText(t,_.text,Ee));if(!(ts<=0)){t.save();var ta=e.paddingHorizontal,tl=ts+2*ta,th=tl/2,tc=_.width,td=_.coordinate,tu=Math.floor(td-th)+.5;tu<0&&n._inViewport?(td+=Math.abs(0-tu),tu=Math.floor(td-th)+.5):tu+tl>tc&&n._inViewport&&(td-=Math.abs(tc-(tu+tl)),tu=Math.floor(td-th)+.5);var tp=tu+tl,t8=0+e.borderSize+e.paddingTop+e.fontSize+e.paddingBottom;t.fillStyle=_.background;var tf=Math.round(tu*C),tv=Math.round(0*C);t.fillRect(tf,tv,Math.round(tp*C)-tf,Math.round(t8*C)-tv);var tg=Math.round(_.coordinate*C),tm=tv,ty=Math.round((tm+e.borderSize+e.tickLength)*C);t.fillStyle=_.color,t.fillRect(tg-Math.floor(.5*C),tm,Math.max(1,Math.floor(C)),ty-tm);var t$=t8-e.baselineOffset-e.paddingBottom;t.textAlign="left",t.fillStyle=_.color,ve(t,C,function(){t.fillText(O(_).text,tu+ta,t$)}),t.restore()}}}},this._inViewport=t,this.backgroundBetween=e}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t,e,n){if(this._data.length>1&&this.backgroundBetween){var C=this._data.map(function(t){return t.coordinate}),_=Math.min.apply(Math,y([],v(C),!1)),ts=Math.max.apply(Math,y([],v(C),!1));t.save(),t.fillStyle=this.backgroundBetween,t.scale(n,n);var ta=[_,0,ts-_,t.canvas.height];t.fillRect.apply(t,y([],v(ta),!1)),t.restore()}this._data.forEach(this.drawLabel(t,e,n))},t}(),ke=function(){function t(t,e,n){this._invalidated=!0,this._renderer=new Me,this._rendererData={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},this._crosshair=t,this._model=e,this._valueProvider=n}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer.setData([this._rendererData]),this._renderer},t.prototype._updateImpl=function(){var t=this._rendererData;t.visible=!1;var e=this._crosshair.options().vertLine;if(e.labelVisible){var n=this._model.timeScale();if(!n.isEmpty()){var C=n.indexToTime(this._crosshair.appliedIndex(),!1);t.width=n.width();var _=this._valueProvider();if(_.time){t.coordinate=_.coordinate,t.text=n.formatDateTime(O(C)),t.visible=!0;var ts=de(e.labelBackgroundColor);t.background=ts.background,t.color=ts.foreground}}}},t}(),Te=function(){function t(){this._priceScale=null,this._zorder=0}return t.prototype.zorder=function(){return this._zorder},t.prototype.setZorder=function(t){this._zorder=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.priceAxisViews=function(t,e){return[]},t.prototype.paneViews=function(t){return[]},t.prototype.timeAxisViews=function(){return[]},t.prototype.visible=function(){return!0},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(CrosshairMode||(CrosshairMode={}));var Ie=function(t){function e(e,n){var C,_,ts=t.call(this)||this;ts._pane=null,ts._price=NaN,ts._index=0,ts._visible=!0,ts._priceAxisViews=new Map,ts._subscribed=!1,ts._x=NaN,ts._y=NaN,ts._originX=NaN,ts._originY=NaN,ts._model=e,ts._options=n,ts._markersPaneView=new Q(e,ts),ts._currentPosPriceProvider=(C=function(){return ts._price},_=function(){return ts._y},function(t){var e=_(),n=C();if(t===O(ts._pane).defaultPriceScale())return{price:n,coordinate:e};var ta=O(t.firstValue());return{price:t.coordinateToPrice(e,ta),coordinate:e}});var ta=function(){return{time:ts._model.timeScale().indexToTime(ts._index,!1),coordinate:ts.appliedX()}};return ts._timeAxisView=new ke(ts,e,ta),ts._paneView=new me(ts),ts}return p(e,t),e.prototype.options=function(){return this._options},e.prototype.setOptions=function(t){this._options=t},e.prototype.saveOriginCoord=function(t,e){this._originX=t,this._originY=e},e.prototype.clearOriginCoord=function(){this._originX=NaN,this._originY=NaN},e.prototype.originCoordX=function(){return this._originX},e.prototype.originCoordY=function(){return this._originY},e.prototype.setPosition=function(t,e,n){this._subscribed||(this._subscribed=!0),this._visible=!0,this._tryToUpdateViews(t,e,n)},e.prototype.appliedIndex=function(){return this._index},e.prototype.appliedPrice=function(){return this._price},e.prototype.appliedX=function(){return this._x},e.prototype.appliedY=function(){return this._y},e.prototype.visible=function(){return this._visible},e.prototype.clearPosition=function(){this._visible=!1,this._setIndexToLastSeriesBarIndex(),this._price=NaN,this._x=NaN,this._y=NaN,this._pane=null,this.clearOriginCoord()},e.prototype.paneViews=function(t){return null!==this._pane?[this._paneView,this._markersPaneView]:[]},e.prototype.horzLineVisible=function(t){return t===this._pane&&this._options.horzLine.visible},e.prototype.vertLineVisible=function(){return this._options.vertLine.visible},e.prototype.priceAxisViews=function(t,e){this._visible&&this._pane===t||this._priceAxisViews.clear();var n=[];return this._pane===t&&n.push(this._createPriceAxisViewOnDemand(this._priceAxisViews,e,this._currentPosPriceProvider)),n},e.prototype.timeAxisViews=function(){return this._visible?[this._timeAxisView]:[]},e.prototype.pane=function(){return this._pane},e.prototype.updateAllViews=function(){this._paneView.update(),this._priceAxisViews.forEach(function(t){return t.update()}),this._timeAxisView.update(),this._markersPaneView.update()},e.prototype._priceScaleByPane=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},e.prototype._tryToUpdateViews=function(t,e,n){this._tryToUpdateData(t,e,n)&&this.updateAllViews()},e.prototype._tryToUpdateData=function(t,e,n){var C=this._x,_=this._y,ts=this._price,ta=this._index,tl=this._pane,th=this._priceScaleByPane(n);this._index=t,this._x=isNaN(t)?NaN:this._model.timeScale().indexToCoordinate(t),this._pane=n;var tc=null!==th?th.firstValue():null;return null!==th&&null!==tc?(this._price=e,this._y=th.priceToCoordinate(e,tc)):(this._price=NaN,this._y=NaN),C!==this._x||_!==this._y||ta!==this._index||ts!==this._price||tl!==this._pane},e.prototype._setIndexToLastSeriesBarIndex=function(){var t=this._model.serieses().map(function(t){return t.bars().lastIndex()}).filter(W),e=0===t.length?null:Math.max.apply(Math,y([],v(t),!1));this._index=null!==e?e:NaN},e.prototype._createPriceAxisViewOnDemand=function(t,e,n){var C=t.get(e);return void 0===C&&(C=new Se(this,e,n),t.set(e,C)),C},e}(Te);function He(t,e){if(!R(t))return"n/a";if(!F(e)||e<0||e>16)throw TypeError("invalid length");return 0===e?t.toString():("0000000000000000"+t.toString()).slice(-e)}var Ne,Pe=function(){function t(t,e){if(e||(e=1),R(t)&&F(t)||(t=100),t<0)throw TypeError("invalid base");this._priceScale=t,this._minMove=e,this._calculateDecimal()}return t.prototype.format=function(t){var e=t<0?"âˆ’":"";return t=Math.abs(t),e+this._formatAsDecimal(t)},t.prototype._calculateDecimal=function(){if(this._fractionalLength=0,this._priceScale>0&&this._minMove>0)for(var t=this._priceScale;t>1;)t/=10,this._fractionalLength++},t.prototype._formatAsDecimal=function(t){var e=this._priceScale/this._minMove,n=Math.floor(t),C="",_=void 0!==this._fractionalLength?this._fractionalLength:NaN;if(e>1){var ts=+(Math.round(t*e)-n*e).toFixed(this._fractionalLength);ts>=e&&(ts-=e,n+=1),C=","+He(+ts.toFixed(this._fractionalLength)*this._minMove,_)}else n=Math.round(n*e)/e,_>0&&(C=","+He(0,_));return n.toFixed(0)+C},t}(),Oe=function(t){function e(e){return void 0===e&&(e=100),t.call(this,e)||this}return p(e,t),e.prototype.format=function(e){return t.prototype.format.call(this,e)+"%"},e}(Pe),Delegate=function(){function t(){this._listeners=[]}return t.prototype.subscribe=function(t,e,n){this._listeners.push({callback:t,linkedObject:e,singleshot:!0===n})},t.prototype.unsubscribe=function(t){var e=this._listeners.findIndex(function(e){return t===e.callback});e>-1&&this._listeners.splice(e,1)},t.prototype.unsubscribeAll=function(t){this._listeners=this._listeners.filter(function(e){return e.linkedObject===t})},t.prototype.fire=function(t,e){var n=y([],v(this._listeners),!1);this._listeners=this._listeners.filter(function(t){return!t.singleshot}),n.forEach(function(n){return n.callback(t,e)})},t.prototype.hasListeners=function(){return this._listeners.length>0},t.prototype.destroy=function(){this._listeners=[]},t}(),Ae=function(){function t(t,e){this._minValue=t,this._maxValue=e}return t.prototype.equals=function(t){return null!==t&&this._minValue===t._minValue&&this._maxValue===t._maxValue},t.prototype.clone=function(){return new t(this._minValue,this._maxValue)},t.prototype.minValue=function(){return this._minValue},t.prototype.maxValue=function(){return this._maxValue},t.prototype.length=function(){return this._maxValue-this._minValue},t.prototype.isEmpty=function(){return this._maxValue===this._minValue||Number.isNaN(this._maxValue)||Number.isNaN(this._minValue)},t.prototype.merge=function(e){return null===e?this:new t(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))},t.prototype.scaleAroundCenter=function(t){if(R(t)&&0!=this._maxValue-this._minValue){var e=.5*(this._maxValue+this._minValue),n=this._maxValue-e,C=this._minValue-e;n*=t,C*=t,this._maxValue=e+n,this._minValue=e+C}},t.prototype.shift=function(t){R(t)&&(this._maxValue+=t,this._minValue+=t)},t.prototype.toRaw=function(){return{minValue:this._minValue,maxValue:this._maxValue}},t.fromRaw=function(e){return null===e?null:new t(e.minValue,e.maxValue)},t}();function Le(t,e,n){return Math.min(Math.max(t,e),n)}function Re(t,e,n){return e-t<=n}function Fe(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Be(t){var e=Math.ceil(t);return e%2!=0?e-1:e}function Ve(t){var e=Math.ceil(t);return e%2==0?e-1:e}function ze(t,e){var n=100*(t-e)/e;return e<0?-n:n}function We(t,e){var n=ze(t.minValue(),e),C=ze(t.maxValue(),e);return new Ae(n,C)}function je(t,e){var n=100*(t-e)/e+100;return e<0?-n:n}function Ge(t,e){var n=je(t.minValue(),e),C=je(t.maxValue(),e);return new Ae(n,C)}function Ue(t){var e=Math.abs(t);if(e<1e-8)return 0;var n=Fe(e+1e-4)+4;return t<0?-n:n}function Ze(t){var e=Math.abs(t);if(e<1e-8)return 0;var n=Math.pow(10,e-4)-1e-4;return t<0?-n:n}function qe(t){if(null===t)return null;var e=Ue(t.minValue()),n=Ue(t.maxValue());return new Ae(e,n)}!function(t){t[t.LogicalOffset=4]="LogicalOffset",t[t.CoordOffset=1e-4]="CoordOffset"}(Ne||(Ne={}));var Ke,Ye=function(){function t(t,e){if(this._base=t,this._integralDividers=e,function(t){if(t<0)return!1;for(var e=t;e>1;e/=10)if(e%10!=0)return!1;return!0}(this._base))this._fractionalDividers=[2,2.5,2];else{this._fractionalDividers=[];for(var n=this._base;1!==n;){if(n%2==0)this._fractionalDividers.push(2),n/=2;else{if(n%5!=0)throw new S("unexpected base");this._fractionalDividers.push(2,2.5),n/=5}if(this._fractionalDividers.length>100)throw new S("something wrong with base")}}}return t.prototype.tickSpan=function(t,e,n){for(var C,_=0===this._base?0:1/this._base,ts=1e-9,ta=Math.pow(10,Math.max(0,Math.ceil(Fe(t-e)))),tl=0,th=this._integralDividers[0];;){var tc=Re(ta,_,ts)&&ta>_+ts,td=Re(ta,n*th,ts),tu=Re(ta,1,ts);if(!(tc&&td&&tu))break;ta/=th,th=this._integralDividers[++tl%this._integralDividers.length]}if(ta<=_+ts&&(ta=_),ta=Math.max(1,ta),this._fractionalDividers.length>0&&1e-9>Math.abs((C=ta)-1))for(tl=0,th=this._fractionalDividers[0];Re(ta,n*th,ts)&&ta>_+ts;)ta/=th,th=this._fractionalDividers[++tl%this._fractionalDividers.length];return ta},t}(),Xe=function(){function t(t,e,n,C){this._marks=[],this._priceScale=t,this._base=e,this._coordinateToLogicalFunc=n,this._logicalToCoordinateFunc=C}return t.prototype.tickSpan=function(t,e){if(t<e)throw new S("high < low");var n=this._priceScale.height(),C=(t-e)*this._tickMarkHeight()/n,_=new Ye(this._base,[2,2.5,2]),ts=new Ye(this._base,[2,2,2.5]),ta=new Ye(this._base,[2.5,2,2]),tl=[];return tl.push(_.tickSpan(t,e,C),ts.tickSpan(t,e,C),ta.tickSpan(t,e,C)),function(t){if(t.length<1)throw Error("array is empty");for(var e=t[0],n=1;n<t.length;++n)t[n]<e&&(e=t[n]);return e}(tl)},t.prototype.rebuildTickMarks=function(){var t=this._priceScale,e=t.firstValue();if(null!==e){var n=t.height(),C=this._coordinateToLogicalFunc(n-1,e),_=this._coordinateToLogicalFunc(0,e),ts=this._priceScale.options().entireTextOnly?this._fontHeight()/2:0,ta=ts,tl=n-1-ts,th=Math.max(C,_),tc=Math.min(C,_);if(th!==tc){for(var td=this.tickSpan(th,tc),tu=th%td,tp=th>=tc?1:-1,t8=null,tf=0,tv=th-(tu+=tu<0?td:0);tv>tc;tv-=td){var tg=this._logicalToCoordinateFunc(tv,e,!0);null!==t8&&Math.abs(tg-t8)<this._tickMarkHeight()||tg<ta||tg>tl||(tf<this._marks.length?(this._marks[tf].coord=tg,this._marks[tf].label=t.formatLogical(tv)):this._marks.push({coord:tg,label:t.formatLogical(tv)}),tf++,t8=tg,t.isLog()&&(td=this.tickSpan(tv*tp,tc)))}this._marks.length=tf}else this._marks=[]}else this._marks=[]},t.prototype.marks=function(){return this._marks},t.prototype._fontHeight=function(){return this._priceScale.fontSize()},t.prototype._tickMarkHeight=function(){return Math.ceil(2.5*this._fontHeight())},t}();function $e(t){return t.slice().sort(function(t,e){return O(t.zorder())-O(e.zorder())})}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(Ke||(Ke={}));var Je=new Oe,Qe=new Pe(100,1),et=function(){function t(t,e,n,C){this._height=0,this._internalHeightCache=null,this._priceRange=null,this._priceRangeSnapshot=null,this._invalidatedForRange={isValid:!1,visibleBars:null},this._marginAbove=0,this._marginBelow=0,this._onMarksChanged=new Delegate,this._modeChanged=new Delegate,this._dataSources=[],this._cachedOrderedSources=null,this._marksCache=null,this._scaleStartPoint=null,this._scrollStartPoint=null,this._formatter=Qe,this._id=t,this._options=e,this._layoutOptions=n,this._localizationOptions=C,this._markBuilder=new Xe(this,100,this._coordinateToLogical.bind(this),this._logicalToCoordinate.bind(this))}return t.prototype.id=function(){return this._id},t.prototype.options=function(){return this._options},t.prototype.applyOptions=function(t){if(L(this._options,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),void 0!==t.scaleMargins){var e=P(t.scaleMargins.top),n=P(t.scaleMargins.bottom);if(e<0||e>1)throw new S("Invalid top margin - expect value between 0 and 1, given="+e);if(n<0||n>1||e+n>1)throw new S("Invalid bottom margin - expect value between 0 and 1, given="+n);if(e+n>1)throw new S("Invalid margins - sum of margins must be less than 1, given="+(e+n));this._invalidateInternalHeightCache(),this._marksCache=null}},t.prototype.isAutoScale=function(){return this._options.autoScale},t.prototype.isLog=function(){return 1===this._options.mode},t.prototype.isPercentage=function(){return 2===this._options.mode},t.prototype.isIndexedTo100=function(){return 3===this._options.mode},t.prototype.mode=function(){return{autoScale:this._options.autoScale,isInverted:this._options.invertScale,mode:this._options.mode}},t.prototype.setMode=function(t){var e=this.mode(),n=null;void 0!==t.autoScale&&(this._options.autoScale=t.autoScale),void 0!==t.mode&&(this._options.mode=t.mode,2!==t.mode&&3!==t.mode||(this._options.autoScale=!0),this._invalidatedForRange.isValid=!1),1===e.mode&&t.mode!==e.mode&&(function(t){if(null===t)return!1;var e=Ze(t.minValue()),n=Ze(t.maxValue());return isFinite(e)&&isFinite(n)}(this._priceRange)?null!==(n=function(t){if(null===t)return null;var e=Ze(t.minValue()),n=Ze(t.maxValue());return new Ae(e,n)}(this._priceRange))&&this.setPriceRange(n):this._options.autoScale=!0),1===t.mode&&t.mode!==e.mode&&null!==(n=qe(this._priceRange))&&this.setPriceRange(n);var C=e.mode!==this._options.mode;C&&(2===e.mode||this.isPercentage())&&this.updateFormatter(),C&&(3===e.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&e.isInverted!==t.isInverted&&(this._options.invertScale=t.isInverted,this._onIsInvertedChanged()),this._modeChanged.fire(e,this.mode())},t.prototype.modeChanged=function(){return this._modeChanged},t.prototype.fontSize=function(){return this._layoutOptions.fontSize},t.prototype.height=function(){return this._height},t.prototype.setHeight=function(t){this._height!==t&&(this._height=t,this._invalidateInternalHeightCache(),this._marksCache=null)},t.prototype.internalHeight=function(){if(this._internalHeightCache)return this._internalHeightCache;var t=this.height()-this._topMarginPx()-this._bottomMarginPx();return this._internalHeightCache=t,t},t.prototype.priceRange=function(){return this._makeSureItIsValid(),this._priceRange},t.prototype.setPriceRange=function(t,e){var n=this._priceRange;(e||null===n&&null!==t||null!==n&&!n.equals(t))&&(this._marksCache=null,this._priceRange=t)},t.prototype.isEmpty=function(){return this._makeSureItIsValid(),0===this._height||!this._priceRange||this._priceRange.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,e){return this.isPercentage()?t=ze(t,e):this.isIndexedTo100()&&(t=je(t,e)),this._logicalToCoordinate(t,e)},t.prototype.pointsArrayToCoordinates=function(t,e,n){this._makeSureItIsValid();for(var C=this._bottomMarginPx(),_=O(this.priceRange()),ts=_.minValue(),ta=_.maxValue(),tl=this.internalHeight()-1,th=this.isInverted(),tc=tl/(ta-ts),td=void 0===n?0:n.from,tu=void 0===n?t.length:n.to,tp=this._getCoordinateTransformer(),t8=td;t8<tu;t8++){var tf=t[t8],tv=tf.price;if(!isNaN(tv)){var tg=tv;null!==tp&&(tg=tp(tf.price,e));var tm=C+tc*(tg-ts),ty=th?tm:this._height-1-tm;tf.y=ty}}},t.prototype.barPricesToCoordinates=function(t,e,n){this._makeSureItIsValid();for(var C=this._bottomMarginPx(),_=O(this.priceRange()),ts=_.minValue(),ta=_.maxValue(),tl=this.internalHeight()-1,th=this.isInverted(),tc=tl/(ta-ts),td=void 0===n?0:n.from,tu=void 0===n?t.length:n.to,tp=this._getCoordinateTransformer(),t8=td;t8<tu;t8++){var tf=t[t8],tv=tf.open,tg=tf.high,tm=tf.low,ty=tf.close;null!==tp&&(tv=tp(tf.open,e),tg=tp(tf.high,e),tm=tp(tf.low,e),ty=tp(tf.close,e));var t$=C+tc*(tv-ts),tS=th?t$:this._height-1-t$;tf.openY=tS,t$=C+tc*(tg-ts),tS=th?t$:this._height-1-t$,tf.highY=tS,t$=C+tc*(tm-ts),tS=th?t$:this._height-1-t$,tf.lowY=tS,t$=C+tc*(ty-ts),tS=th?t$:this._height-1-t$,tf.closeY=tS}},t.prototype.coordinateToPrice=function(t,e){var n=this._coordinateToLogical(t,e);return this.logicalToPrice(n,e)},t.prototype.logicalToPrice=function(t,e){var n,C,_,ts,ta=t;return this.isPercentage()?ta=(n=ta,(C=e)<0&&(n=-n),n/100*C+C):this.isIndexedTo100()&&(ta=(_=ta,_-=100,(ts=e)<0&&(_=-_),_/100*ts+ts)),ta},t.prototype.dataSources=function(){return this._dataSources},t.prototype.orderedSources=function(){if(this._cachedOrderedSources)return this._cachedOrderedSources;for(var t=[],e=0;e<this._dataSources.length;e++){var n=this._dataSources[e];null===n.zorder()&&n.setZorder(e+1),t.push(n)}return t=$e(t),this._cachedOrderedSources=t,this._cachedOrderedSources},t.prototype.addDataSource=function(t){-1===this._dataSources.indexOf(t)&&(this._dataSources.push(t),this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var e=this._dataSources.indexOf(t);if(-1===e)throw new S("source is not attached to scale");this._dataSources.splice(e,1),0===this._dataSources.length&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.firstValue=function(){var t,e,n=null;try{for(var C=g(this._dataSources),_=C.next();!_.done;_=C.next()){var ts=_.value.firstValue();null!==ts&&(null===n||ts.timePoint<n.timePoint)&&(n=ts)}}catch(ta){t={error:ta}}finally{try{_&&!_.done&&(e=C.return)&&e.call(C)}finally{if(t)throw t.error}}return null===n?null:n.value},t.prototype.isInverted=function(){return this._options.invertScale},t.prototype.marks=function(){return this._marksCache||(this._markBuilder.rebuildTickMarks(),this._marksCache=this._markBuilder.marks(),this._onMarksChanged.fire()),this._marksCache},t.prototype.onMarksChanged=function(){return this._onMarksChanged},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this._scaleStartPoint&&null===this._priceRangeSnapshot&&(this.isEmpty()||(this._scaleStartPoint=this._height-t,this._priceRangeSnapshot=O(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this._scaleStartPoint){this.setMode({autoScale:!1}),(t=this._height-t)<0&&(t=0);var e=(this._scaleStartPoint+.2*(this._height-1))/(t+.2*(this._height-1)),n=O(this._priceRangeSnapshot).clone();e=Math.max(e,.1),n.scaleAroundCenter(e),this.setPriceRange(n)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this._scaleStartPoint=null,this._priceRangeSnapshot=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this._scrollStartPoint&&null===this._priceRangeSnapshot&&(this.isEmpty()||(this._scrollStartPoint=t,this._priceRangeSnapshot=O(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this._scrollStartPoint){var e=O(this.priceRange()).length()/(this.internalHeight()-1),n=t-this._scrollStartPoint;this.isInverted()&&(n*=-1);var C=n*e,_=O(this._priceRangeSnapshot).clone();_.shift(C),this.setPriceRange(_,!0),this._marksCache=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this._scrollStartPoint&&(this._scrollStartPoint=null,this._priceRangeSnapshot=null)},t.prototype.formatter=function(){return this._formatter||this.updateFormatter(),this._formatter},t.prototype.formatPrice=function(t,e){switch(this._options.mode){case 2:return this.formatter().format(ze(t,e));case 3:return this.formatter().format(je(t,e));default:return this._formatPrice(t)}},t.prototype.formatLogical=function(t){switch(this._options.mode){case 2:case 3:return this.formatter().format(t);default:return this._formatPrice(t)}},t.prototype.formatPriceAbsolute=function(t){return this._formatPrice(t,O(this.formatterSource()).formatter())},t.prototype.formatPricePercentage=function(t,e){return t=ze(t,e),Je.format(t)},t.prototype.sourcesForAutoScale=function(){return this._dataSources},t.prototype.recalculatePriceRange=function(t){this._invalidatedForRange={visibleBars:t,isValid:!1}},t.prototype.updateAllViews=function(){this._dataSources.forEach(function(t){return t.updateAllViews()})},t.prototype.updateFormatter=function(){this._marksCache=null;var t=this.formatterSource(),e=100;null!==t&&(e=Math.round(1/t.minMove())),this._formatter=Qe,this.isPercentage()?(this._formatter=Je,e=100):this.isIndexedTo100()?(this._formatter=new Pe(100,1),e=100):null!==t&&(this._formatter=t.formatter()),this._markBuilder=new Xe(this,e,this._coordinateToLogical.bind(this),this._logicalToCoordinate.bind(this)),this._markBuilder.rebuildTickMarks()},t.prototype.invalidateSourcesCache=function(){this._cachedOrderedSources=null},t.prototype.formatterSource=function(){return this._dataSources[0]||null},t.prototype._topMarginPx=function(){return this.isInverted()?Math.max(this._options.scaleMargins.bottom*this.height(),this._marginBelow):Math.max(this._options.scaleMargins.top*this.height(),this._marginAbove)},t.prototype._bottomMarginPx=function(){return this.isInverted()?Math.max(this._options.scaleMargins.top*this.height(),this._marginAbove):Math.max(this._options.scaleMargins.bottom*this.height(),this._marginBelow)},t.prototype._makeSureItIsValid=function(){this._invalidatedForRange.isValid||(this._invalidatedForRange.isValid=!0,this._recalculatePriceRangeImpl())},t.prototype._invalidateInternalHeightCache=function(){this._internalHeightCache=null},t.prototype._logicalToCoordinate=function(t,e){if(this._makeSureItIsValid(),this.isEmpty())return 0;t=this.isLog()&&t?Ue(t):t;var n=O(this.priceRange()),C=this._bottomMarginPx()+(this.internalHeight()-1)*(t-n.minValue())/n.length();return this.invertedCoordinate(C)},t.prototype._coordinateToLogical=function(t,e){if(this._makeSureItIsValid(),this.isEmpty())return 0;var n=this.invertedCoordinate(t),C=O(this.priceRange()),_=C.minValue()+C.length()*((n-this._bottomMarginPx())/(this.internalHeight()-1));return this.isLog()?Ze(_):_},t.prototype._onIsInvertedChanged=function(){this._marksCache=null,this._markBuilder.rebuildTickMarks()},t.prototype._recalculatePriceRangeImpl=function(){var t,e,n=this._invalidatedForRange.visibleBars;if(null!==n){var C=null,_=this.sourcesForAutoScale(),ts=0,ta=0;try{for(var tl=g(_),th=tl.next();!th.done;th=tl.next()){var tc=th.value;if(tc.visible()){var td=tc.firstValue();if(null!==td){var tu=tc.autoscaleInfo(n.left(),n.right()),tp=tu&&tu.priceRange();if(null!==tp){switch(this._options.mode){case 1:tp=qe(tp);break;case 2:tp=We(tp,td.value);break;case 3:tp=Ge(tp,td.value)}if(C=null===C?tp:C.merge(O(tp)),null!==tu){var t8=tu.margins();null!==t8&&(ts=Math.max(ts,t8.above),ta=Math.max(ta,t8.below))}}}}}}catch(tf){t={error:tf}}finally{try{th&&!th.done&&(e=tl.return)&&e.call(tl)}finally{if(t)throw t.error}}if(ts===this._marginAbove&&ta===this._marginBelow||(this._marginAbove=ts,this._marginBelow=ta,this._marksCache=null,this._invalidateInternalHeightCache()),null!==C){if(C.minValue()===C.maxValue()){var tv=this.formatterSource(),tg=5*(null===tv||this.isPercentage()||this.isIndexedTo100()?1:tv.minMove());C=new Ae(C.minValue()-tg,C.maxValue()+tg)}this.setPriceRange(C)}else null===this._priceRange&&this.setPriceRange(new Ae(-.5,.5));this._invalidatedForRange.isValid=!0}},t.prototype._getCoordinateTransformer=function(){return this.isPercentage()?ze:this.isIndexedTo100()?je:this.isLog()?Ue:null},t.prototype._formatPrice=function(t,e){return void 0===this._localizationOptions.priceFormatter?(void 0===e&&(e=this.formatter()),e.format(t)):this._localizationOptions.priceFormatter(t)},t}(),tt=function(t){return t.getUTCFullYear()},nt=function(){function t(t,e){void 0===t&&(t="yyyy-MM-dd"),void 0===e&&(e="default"),this._dateFormat=t,this._locale=e}return t.prototype.format=function(t){var e,n,C,_,ts,ta,tl,th,tc,td,tu,tp,t8;return e=t,n=this._dateFormat,C=this._locale,n.replace(/yyyy/g,He(tt(_=e),4)).replace(/yy/g,He(tt(ts=e)%100,2)).replace(/MMMM/g,(ta=e,tl=C,new Date(ta.getUTCFullYear(),ta.getUTCMonth(),1).toLocaleString(tl,{month:"long"}))).replace(/MMM/g,(th=e,tc=C,new Date(th.getUTCFullYear(),th.getUTCMonth(),1).toLocaleString(tc,{month:"short"}))).replace(/MM/g,He((tu=td=e).getUTCMonth()+1,2)).replace(/dd/g,He((t8=tp=e).getUTCDate(),2))},t}(),rt=function(){function t(t){this._formatStr=t||"%h:%m:%s"}return t.prototype.format=function(t){return this._formatStr.replace("%h",He(t.getUTCHours(),2)).replace("%m",He(t.getUTCMinutes(),2)).replace("%s",He(t.getUTCSeconds(),2))},t}(),it={dateFormat:"yyyy-MM-dd",timeFormat:"%h:%m:%s",dateTimeSeparator:" ",locale:"default"},ot=function(){function t(t){void 0===t&&(t={});var e=f(f({},it),t);this._dateFormatter=new nt(e.dateFormat,e.locale),this._timeFormatter=new rt(e.timeFormat),this._separator=e.dateTimeSeparator}return t.prototype.format=function(t){return""+this._dateFormatter.format(t)+this._separator+this._timeFormatter.format(t)},t}(),at=[86400,3600,60],st=function(){function t(t,e){void 0===e&&(e=50),this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._cache=new Map,this._tick2Labels=new Map,this._format=t,this._maxSize=e}return t.prototype.format=function(t){var e=void 0===t.businessDay?new Date(1e3*t.timestamp).getTime():new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)).getTime(),n=this._cache.get(e);if(void 0!==n)return n.string;if(this._actualSize===this._maxSize){var C=this._tick2Labels.get(this._oldestTick);this._tick2Labels.delete(this._oldestTick),this._cache.delete(P(C)),this._oldestTick++,this._actualSize--}var _=this._format(t);return this._cache.set(e,{string:_,tick:this._usageTick}),this._tick2Labels.set(this._usageTick,e),this._actualSize++,this._usageTick++,_},t}(),lt=function(){function t(t,e){N(t<=e,"right should be >= left"),this._left=t,this._right=e}return t.prototype.left=function(){return this._left},t.prototype.right=function(){return this._right},t.prototype.count=function(){return this._right-this._left+1},t.prototype.contains=function(t){return this._left<=t&&t<=this._right},t.prototype.equals=function(t){return this._left===t.left()&&this._right===t.right()},t}();function ct(t,e){return null===t||null===e?t===e:t.equals(e)}var ut,dt,ht,pt=function(){function t(){this._marksByWeight=new Map,this._cache=null}return t.prototype.setTimeScalePoints=function(t){var e=this;this._cache=null,this._marksByWeight.clear(),t.forEach(function(t,n){var C=e._marksByWeight.get(t.timeWeight);void 0===C&&(C=[],e._marksByWeight.set(t.timeWeight,C)),C.push({index:n,time:t.time,weight:t.timeWeight})})},t.prototype.build=function(t,e){var n=Math.ceil(e/t);return null!==this._cache&&this._cache.maxIndexesPerMark===n||(this._cache={marks:this._buildMarksImpl(n),maxIndexesPerMark:n}),this._cache.marks},t.prototype._buildMarksImpl=function(t){var e,n,C=[];try{for(var _=g(Array.from(this._marksByWeight.keys()).sort(function(t,e){return e-t})),ts=_.next();!ts.done;ts=_.next()){var ta=ts.value;if(this._marksByWeight.get(ta)){var tl=C;C=[];for(var th=tl.length,tc=0,td=P(this._marksByWeight.get(ta)),tu=td.length,tp=1/0,t8=-1/0,tf=0;tf<tu;tf++){for(var tv=td[tf],tg=tv.index;tc<th;){var tm=tl[tc],ty=tm.index;if(!(ty<tg)){tp=ty;break}tc++,C.push(tm),t8=ty,tp=1/0}tp-tg>=t&&tg-t8>=t&&(C.push(tv),t8=tg)}for(;tc<th;tc++)C.push(tl[tc])}}}catch(t$){e={error:t$}}finally{try{ts&&!ts.done&&(n=_.return)&&n.call(_)}finally{if(e)throw e.error}}return C},t}(),ft=function(){function t(t){this._logicalRange=t}return t.prototype.strictRange=function(){return null===this._logicalRange?null:new lt(Math.floor(this._logicalRange.left()),Math.ceil(this._logicalRange.right()))},t.prototype.logicalRange=function(){return this._logicalRange},t.invalid=function(){return new t(null)},t}();!function(t){t[t.DefaultAnimationDuration=400]="DefaultAnimationDuration",t[t.MinVisibleBarsCount=2]="MinVisibleBarsCount"}(ut||(ut={})),function(t){t[t.Minute=20]="Minute",t[t.Hour=30]="Hour",t[t.Day=40]="Day",t[t.Week=50]="Week",t[t.Month=60]="Month",t[t.Year=70]="Year"}(dt||(dt={})),function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(ht||(ht={}));var mt,gt=function(){function t(t,e,n){var C=this;this._width=0,this._baseIndexOrNull=null,this._points=[],this._scrollStartPoint=null,this._scaleStartPoint=null,this._tickMarks=new pt,this._formattedByWeight=new Map,this._visibleRange=ft.invalid(),this._visibleRangeInvalidated=!0,this._visibleBarsChanged=new Delegate,this._logicalRangeChanged=new Delegate,this._optionsApplied=new Delegate,this._commonTransitionStartState=null,this._timeMarksCache=null,this._labels=[],this._outRangeIndexesCache={values:{indexesByTimestamps:{},timestampsByIndexes:{}},params:{}},this._initOutRangeIndexesCache=function(){var t=C._model.options(),e=t.timeframe,n=t.sessionsSchedule;C._outRangeIndexesCache={params:f(f({timeframe:e},n),{firstPoint:C._points[0].time.timestamp,pointsCount:C._points.length}),values:{indexesByTimestamps:{},timestampsByIndexes:{}}}},this._maxCacheSize=300,this._calcTimestampByOutRangeIndex=function(t){var e=C._points[0].time.timestamp,n=C._model.options(),_=n.timeframe,ts=n.sessionsSchedule,ta=Dt(e);if("M"===_){var tl=ta;return tl.setUTCMonth(tl.getUTCMonth()+t),At(tl)}var th=Ot(_)/1e3;if("W"===_)return e+th*t;var tc,td=Math.abs(t),tu=t<0?"back":"forward";if("D"===_)tc=St(t,ta,ts);else{td-=_t(ts,_,{type:"forward"===tu?"start":"end",date:ta});var tp,t8,tf,tv,tg,tm,ty,t$,tS,tb,tw=_t(ts,_),tx=Math.floor(td/tw);td-=tx*tw,tc=(tp=ts,t8=_,tf=St("forward"===tu?tx:-tx,ta,ts),tv={type:"forward"===tu?"end":"start",index:td},wt(tp),tg=tv.index,tm=tv.type,t$=(ty=kt(tp,tf)).startDate,tS=ty.endDate,tb=Ot(t8),0===tg?tf:new Date("end"===tm?+t$+tg*tb:+tS-tg*tb))}return Math.round(+tc/1e3)},this._options=e,this._localizationOptions=n,this._rightOffset=e.rightOffset,this._barSpacing=e.barSpacing,this._model=t,this._updateDateTimeFormatter()}return t.prototype.options=function(){return this._options},t.prototype.applyLocalizationOptions=function(t){L(this._localizationOptions,t),this._invalidateTickMarks(),this._updateDateTimeFormatter()},t.prototype.applyOptions=function(t,e){var n;L(this._options,t),this._options.fixLeftEdge&&this._doFixLeftEdge(),this._options.fixRightEdge&&this._doFixRightEdge(),void 0!==t.barSpacing&&this._model.setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this._model.setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this._model.setBarSpacing(null!==(n=t.barSpacing)&&void 0!==n?n:this._barSpacing),this._invalidateTickMarks(),this._updateDateTimeFormatter(),this._optionsApplied.fire()},t.prototype.indexToTime=function(t,e){void 0===e&&(e=!0);var n,C=null===(n=this._points[t])||void 0===n?void 0:n.time;if(C)return C;if(e||this._points.length<2)return null;var _=this._getCachedValue("index",t);if(void 0!==_)return{timestamp:_};var ts=this._getNonEmptyCandlesRatio(),ta=this._calcTimestampByOutRangeIndex(Math.round(t/ts));return this._addCachedValue("index",t,ta),{timestamp:ta}},t.prototype.timeToIndex=function(t,e,n,C){if(void 0===n&&(n=!0),void 0===C&&(C=2),this._points.length<C)return null;if(t.timestamp>this._points[this._points.length-1].time.timestamp||t.timestamp<this._points[0].time.timestamp)return n?null:this._calcIndexOutRange(t);for(var _=0;_<this._points.length;++_){if(t.timestamp===this._points[_].time.timestamp)return _;if(t.timestamp<this._points[_].time.timestamp)return e?_:null}return null},t.prototype.isEmpty=function(){return 0===this._width||0===this._points.length},t.prototype.visibleStrictRange=function(){return this._updateVisibleRange(),this._visibleRange.strictRange()},t.prototype.visibleLogicalRange=function(){return this._updateVisibleRange(),this._visibleRange.logicalRange()},t.prototype.visibleTimeRange=function(){var t=this.visibleStrictRange();if(null===t)return null;var e={from:t.left(),to:t.right()};return this.timeRangeForLogicalRange(e)},t.prototype.timeRangeForLogicalRange=function(t){var e=Math.round(t.from),n=Math.round(t.to),C=O(this._firstIndex()),_=O(this._lastIndex());return{from:O(this.indexToTime(Math.max(C,e))),to:O(this.indexToTime(Math.min(_,n)))}},t.prototype.logicalRangeForTimeRange=function(t){return{from:O(this.timeToIndex(t.from,!0)),to:O(this.timeToIndex(t.to,!0))}},t.prototype.tickMarks=function(){return this._tickMarks},t.prototype.width=function(){return this._width},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this._width!==t){if(this._options.lockVisibleTimeRangeOnResize&&this._width){var e=this._barSpacing*t/this._width;this._barSpacing=e}if(this._options.fixLeftEdge){var n=this.visibleStrictRange();if(null!==n&&0>=n.left()){var C=this._width-t;this._rightOffset-=Math.round(C/this._barSpacing)+1}}this._width=t,this._visibleRangeInvalidated=!0,this._correctBarSpacing(),this._correctOffset()}},t.prototype.indexToCoordinate=function(t){if(this.isEmpty()||!F(t))return 0;var e=this.baseIndex()+this._rightOffset-t;return this._width-(e+.5)*this._barSpacing-1},t.prototype.indexesToCoordinates=function(t,e){for(var n=this.baseIndex(),C=void 0===e?0:e.from,_=void 0===e?t.length:e.to,ts=C;ts<_;ts++){var ta=t[ts].time,tl=n+this._rightOffset-ta,th=this._width-(tl+.5)*this._barSpacing-1;t[ts].x=th}},t.prototype.coordinateToIndex=function(t){return Math.ceil(this._coordinateToFloatIndex(t))},t.prototype.setRightOffset=function(t){this._visibleRangeInvalidated=!0,this._rightOffset=t,this._correctOffset(),this._model.recalculateAllPanes(),this._model.lightUpdate()},t.prototype.barSpacing=function(){return this._barSpacing},t.prototype.setBarSpacing=function(t){this._setBarSpacing(t),this._correctOffset(),this._model.recalculateAllPanes(),this._model.lightUpdate()},t.prototype.rightOffset=function(){return this._rightOffset},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this._timeMarksCache)return this._timeMarksCache;var t,e,n=this._barSpacing,C=5*(this._model.options().layout.fontSize+4),_=Math.round(C/n),ts=O(this.visibleStrictRange()),ta=Math.max(ts.left(),ts.left()-_),tl=Math.max(ts.right(),ts.right()-_),th=this._tickMarks.build(n,C),tc=this._firstIndex()+_,td=this._lastIndex()-_,tu=0;try{for(var tp=g(th),t8=tp.next();!t8.done;t8=tp.next()){var tf=t8.value;if(ta<=tf.index&&tf.index<=tl){var tv=this.indexToTime(tf.index);if(null!==tv){var tg=void 0;tu<this._labels.length?((tg=this._labels[tu]).coord=this.indexToCoordinate(tf.index),tg.label=this._formatLabel(tv,tf.weight),tg.weight=tf.weight):(tg={needAlignCoordinate:!1,coord:this.indexToCoordinate(tf.index),label:this._formatLabel(tv,tf.weight),weight:tf.weight},this._labels.push(tg)),this._barSpacing>C/2?tg.needAlignCoordinate=!1:tg.needAlignCoordinate=this._options.fixLeftEdge&&tf.index<=tc||this._options.fixRightEdge&&tf.index>=td,tu++}}}}catch(tm){t={error:tm}}finally{try{t8&&!t8.done&&(e=tp.return)&&e.call(tp)}finally{if(t)throw t.error}}return this._labels.length=tu,this._timeMarksCache=this._labels,this._labels},t.prototype.restoreDefault=function(){this._visibleRangeInvalidated=!0,this.setBarSpacing(this._options.barSpacing),this.setRightOffset(this._options.rightOffset)},t.prototype.setBaseIndex=function(t){this._visibleRangeInvalidated=!0,this._baseIndexOrNull=t,this._correctOffset(),this._doFixLeftEdge()},t.prototype.zoom=function(t,e){var n=this._coordinateToFloatIndex(t),C=this.barSpacing();this.setBarSpacing(C+e*(C/10)),this._options.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(n-this._coordinateToFloatIndex(t)))},t.prototype.startScale=function(t){this._scrollStartPoint&&this.endScroll(),null===this._scaleStartPoint&&null===this._commonTransitionStartState&&(this.isEmpty()||(this._scaleStartPoint=t,this._saveCommonTransitionsStartState()))},t.prototype.scaleTo=function(t){if(null!==this._commonTransitionStartState){var e=Le(this._width-t,0,this._width),n=Le(this._width-O(this._scaleStartPoint),0,this._width);0!==e&&0!==n&&this.setBarSpacing(this._commonTransitionStartState.barSpacing*e/n)}},t.prototype.endScale=function(){null!==this._scaleStartPoint&&(this._scaleStartPoint=null,this._clearCommonTransitionsStartState())},t.prototype.startScroll=function(t){null===this._scrollStartPoint&&null===this._commonTransitionStartState&&(this.isEmpty()||(this._scrollStartPoint=t,this._saveCommonTransitionsStartState()))},t.prototype.scrollTo=function(t){if(null!==this._scrollStartPoint){var e=(this._scrollStartPoint-t)/this.barSpacing();this._rightOffset=O(this._commonTransitionStartState).rightOffset+e,this._visibleRangeInvalidated=!0,this._correctOffset()}},t.prototype.endScroll=function(){null!==this._scrollStartPoint&&(this._scrollStartPoint=null,this._clearCommonTransitionsStartState())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this._options.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,e){var n=this;if(void 0===e&&(e=400),!isFinite(t))throw RangeError("offset is required and must be finite number");if(!isFinite(e)||e<=0)throw RangeError("animationDuration (optional) must be finite positive number");var C=this._rightOffset,_=performance.now(),ts=function(){var ta=(performance.now()-_)/e,tl=ta>=1;n.setRightOffset(tl?t:C+(t-C)*ta),tl||setTimeout(ts,20)};ts()},t.prototype.update=function(t){this._visibleRangeInvalidated=!0,this._points=t,this._tickMarks.setTimeScalePoints(t),this._correctOffset()},t.prototype.visibleBarsChanged=function(){return this._visibleBarsChanged},t.prototype.logicalRangeChanged=function(){return this._logicalRangeChanged},t.prototype.optionsApplied=function(){return this._optionsApplied},t.prototype.baseIndex=function(){return this._baseIndexOrNull||0},t.prototype.setVisibleRange=function(t){var e=t.count();this._setBarSpacing(this._width/e),this._rightOffset=t.right()-this.baseIndex(),this._correctOffset(),this._visibleRangeInvalidated=!0,this._model.recalculateAllPanes(),this._model.lightUpdate()},t.prototype.fitContent=function(){var t=this._firstIndex(),e=this._lastIndex();null!==t&&null!==e&&this.setVisibleRange(new lt(t,e+this._options.rightOffset))},t.prototype.setLogicalRange=function(t){var e=new lt(t.from,t.to);this.setVisibleRange(e)},t.prototype.formatDateTime=function(t){return void 0!==this._localizationOptions.timeFormatter?this._localizationOptions.timeFormatter(t.businessDay||t.timestamp):this._dateTimeFormatter.format(new Date(1e3*t.timestamp))},t.prototype._firstIndex=function(){return 0===this._points.length?null:0},t.prototype._lastIndex=function(){return 0===this._points.length?null:this._points.length-1},t.prototype._rightOffsetForCoordinate=function(t){return(this._width-1-t)/this._barSpacing},t.prototype._coordinateToFloatIndex=function(t){var e=this._rightOffsetForCoordinate(t);return Math.round(1e6*(this.baseIndex()+this._rightOffset-e))/1e6},t.prototype._setBarSpacing=function(t){var e=this._barSpacing;this._barSpacing=t,this._correctBarSpacing(),e!==this._barSpacing&&(this._visibleRangeInvalidated=!0,this._resetTimeMarksCache())},t.prototype._updateVisibleRange=function(){if(this._visibleRangeInvalidated){if(this._visibleRangeInvalidated=!1,this.isEmpty())this._setVisibleRange(ft.invalid());else{var t=this.baseIndex(),e=this._width/this._barSpacing,n=this._rightOffset+t,C=new lt(n-e+1,n);this._setVisibleRange(new ft(C))}}},t.prototype._correctBarSpacing=function(){var t=this._minBarSpacing();if(this._barSpacing<t&&(this._barSpacing=t,this._visibleRangeInvalidated=!0),0!==this._width){var e=.5*this._width;this._barSpacing>e&&(this._barSpacing=e,this._visibleRangeInvalidated=!0)}},t.prototype._minBarSpacing=function(){return this._options.fixLeftEdge&&this._options.fixRightEdge&&0!==this._points.length?this._width/this._points.length:this._options.minBarSpacing},t.prototype._correctOffset=function(){var t=this._maxRightOffset();this._rightOffset>t&&(this._rightOffset=t,this._visibleRangeInvalidated=!0);var e=this._minRightOffset();null!==e&&this._rightOffset<e&&(this._rightOffset=e,this._visibleRangeInvalidated=!0)},t.prototype._minRightOffset=function(){var t=this._firstIndex(),e=this._baseIndexOrNull;return null===t||null===e?null:t-e-1+(this._options.fixLeftEdge?this._width/this._barSpacing:Math.min(2,this._points.length))},t.prototype._maxRightOffset=function(){return this._options.fixRightEdge?0:this._width/this._barSpacing-Math.min(2,this._points.length)},t.prototype._saveCommonTransitionsStartState=function(){this._commonTransitionStartState={barSpacing:this.barSpacing(),rightOffset:this.rightOffset()}},t.prototype._clearCommonTransitionsStartState=function(){this._commonTransitionStartState=null},t.prototype._formatLabel=function(t,e){var n=this,C=this._formattedByWeight.get(e);return void 0===C&&(C=new st(function(t){return n._formatLabelImpl(t,e)}),this._formattedByWeight.set(e,C)),C.format(t)},t.prototype._formatLabelImpl=function(t,e){var n,C,_=this._options.timeVisible;return C=e<20&&_?this._options.secondsVisible?4:3:e<40&&_?3:e<50||e<60?2:e<70?1:0,void 0!==this._options.tickMarkFormatter?this._options.tickMarkFormatter(null!==(n=t.businessDay)&&void 0!==n?n:t.timestamp,C,this._localizationOptions.locale):function(t,e,n){var C={};switch(e){case 0:C.year="numeric";break;case 1:C.month="short";break;case 2:C.day="numeric";break;case 3:C.hour12=!1,C.hour="2-digit",C.minute="2-digit";break;case 4:C.hour12=!1,C.hour="2-digit",C.minute="2-digit",C.second="2-digit"}var _=new Date(void 0===t.businessDay?1e3*t.timestamp:Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day));return new Date(_.getUTCFullYear(),_.getUTCMonth(),_.getUTCDate(),_.getUTCHours(),_.getUTCMinutes(),_.getUTCSeconds(),_.getUTCMilliseconds()).toLocaleString(n,C)}(t,C,this._localizationOptions.locale)},t.prototype._setVisibleRange=function(t){var e=this._visibleRange;this._visibleRange=t,ct(e.strictRange(),this._visibleRange.strictRange())||this._visibleBarsChanged.fire(),ct(e.logicalRange(),this._visibleRange.logicalRange())||this._logicalRangeChanged.fire(),this._resetTimeMarksCache()},t.prototype._resetTimeMarksCache=function(){this._timeMarksCache=null},t.prototype._invalidateTickMarks=function(){this._resetTimeMarksCache(),this._formattedByWeight.clear()},t.prototype._updateDateTimeFormatter=function(){var t=this._localizationOptions.dateFormat;this._options.timeVisible?this._dateTimeFormatter=new ot({dateFormat:t,timeFormat:this._options.secondsVisible?"%h:%m:%s":"%h:%m",dateTimeSeparator:"   ",locale:this._localizationOptions.locale}):this._dateTimeFormatter=new nt(t,this._localizationOptions.locale)},t.prototype._doFixLeftEdge=function(){if(this._options.fixLeftEdge){var t=this._firstIndex();if(null!==t){var e=this.visibleStrictRange();if(null!==e){var n=e.left()-t;if(n<0){var C=this._rightOffset-n-1;this.setRightOffset(C)}this._correctBarSpacing()}}}},t.prototype._doFixRightEdge=function(){this._correctOffset(),this._correctBarSpacing()},t.prototype._isOutRangeIndexesCacheValid=function(){var t=this._model.options(),e=t.timeframe,n=t.sessionsSchedule,C=this._outRangeIndexesCache.params,_=f(f({},n),{timeframe:e,firstPoint:this._points[0].time.timestamp,pointsCount:this._points.length});return Object.keys(_).every(function(t){return C[t]===_[t]})},t.prototype._getCachedValue=function(t,e){if(this._isOutRangeIndexesCacheValid())return this._outRangeIndexesCache.values["index"===t?"timestampsByIndexes":"indexesByTimestamps"][e];this._initOutRangeIndexesCache()},t.prototype._addCachedValue=function(t,e,n){this._resetCacheIfNedeed();var C="index"===t?["timestampsByIndexes","indexesByTimestamps"]:["indexesByTimestamps","timestampsByIndexes"];this._outRangeIndexesCache.values[C[0]][e]=n,this._outRangeIndexesCache.values[C[1]][n]=e},t.prototype._resetCacheIfNedeed=function(){Object.keys(this._outRangeIndexesCache.values.timestampsByIndexes).length>this._maxCacheSize&&this._initOutRangeIndexesCache()},t.prototype._getNonEmptyCandlesRatio=function(){var t=this._outRangeIndexesCache.values.nonEmptyCandlesRatio;if(void 0!==t)return t;var e=this._model.options(),n=e.timeframe,C=e.sessionsSchedule,_=Dt(this._points[0].time.timestamp),ts=Dt(this._points[this._points.length-1].time.timestamp),ta=(this._points.length-1)/vt(_,ts,C,n);return isFinite(ta)?(this._outRangeIndexesCache.values.nonEmptyCandlesRatio=ta,ta):1},t.prototype._calcIndexOutRange=function(t){var e=this._model.options(),n=e.timeframe,C=e.sessionsSchedule,_=this._getCachedValue("timestamp",t.timestamp);if(void 0!==_)return _;var ts=Dt(this._points[0].time.timestamp),ta=Dt(t.timestamp),tl=this._getNonEmptyCandlesRatio(),th=Math.round(+ta<+ts?-vt(ta,ts,C,n)*tl:vt(ts,ta,C,n)*tl);return this._addCachedValue("timestamp",t.timestamp,th),th},t}(),vt=function(t,e,n,C){if("M"===C)return yt(t,e);if("W"===C)return Math.ceil((+e-+t)/Ot(C));var _=xt(t,e,n);if("D"===C)return _;if(Pt(C)){var ts=_*_t(n,C);return(ts+=_t(n,C,{type:"start",date:t}))+_t(n,C,{type:"end",date:e})}return C},yt=function(t,e){var n;return n=12*(e.getFullYear()-t.getFullYear()),(n-=t.getMonth())+e.getMonth()},_t=function(t,e,n){var C,_,ts,ta=kt(t,null==n?void 0:n.date),tl=ta.startDate,th=ta.endDate,tc=+th-+tl;if(n)return(C=n.date,_=t,wt(_),ts=Mt(C).toISOString(),Ct.has(ts)&&Ct.get(ts).isHoliday)?0:Math.ceil(("end"===n.type?Math.min(Math.max(+n.date-+tl,0),tc):Math.min(Math.max(+th-+n.date,0),tc))/Ot(e));return Math.ceil(tc/Ot(e))},Ct=new Map,bt=1,wt=function(t){var e=t.holidays;if(e!==mt&&(mt=e,Ct.clear()),!(e.length<10)){if(0!==Ct.size);else{for(var n=Et(e),C=n.isoFormattedHolidays,_=n.min,ts=n.max,ta=_,tl=0;ta<=ts;)!function(){var t=Mt(ta).toISOString(),e=!!C.find(function(e){return e===t});e||tl++,Ct.set(t,{count:tl,isHoliday:e}),ta.setUTCDate(ta.getUTCDate()+1)}();bt=tl/Ct.size}}},xt=function(t,e,n){var C=new Date(+e);C.setUTCDate(C.getUTCDate()-1),wt(n);var _=Mt(t).toISOString(),ts=Mt(C).toISOString();return Ct.has(_)&&Ct.has(ts)?Ct.get(ts).count-Ct.get(_).count:Math.round((+C-+t)*bt/Nt)};function St(t,e,n){var C,_,ts,ta=t+1;wt(n);var tl,th=Mt(e).toISOString(),tc=null===(ts=Ct.get(th))||void 0===ts?void 0:ts.count;if(A(tc)){var td=tc+ta;try{for(var tu=g(Ct),tp=tu.next();!tp.done;tp=tu.next()){var t8=v(tp.value,2),tf=t8[0],tv=t8[1],tg=tv.count,tm=tv.isHoliday;if(tg===td&&!tm){tl=tf;break}}}catch(ty){C={error:ty}}finally{try{tp&&!tp.done&&(_=tu.return)&&_.call(tu)}finally{if(C)throw C.error}}}if(tl)return new Date(tl);var t$=Math.round(ta/bt);return(tf=new Date(th)).setUTCDate(tf.getUTCDate()+t$),tf}var Et=function(t){var e=new Date;e.setUTCFullYear(e.getUTCFullYear()-1);var n=new Date,C=new Date(0);return{isoFormattedHolidays:t.reduce(function(t,_){var ts=v(_.split("/").map(Number),3),ta=ts[0],tl=ts[1],th=ts[2],tc=new Date(Date.UTC(th,ta-1,tl));return tc>=e&&(t.push(Mt(tc).toISOString()),n=n<=tc?n:tc,C=C>=tc?C:tc),t},[]),min:n,max:C}},Mt=function(t){var e=new Date(+t);return e.setUTCHours(0,0,0,0),e},kt=function(t,e){void 0===e&&(e=new Date);var n=Tt(t),C=n.start,_=n.end,ts=new Date(+e);ts.setUTCHours(C[0],C[1],0,0);var ta=new Date(+e);return ta.setUTCHours(_[0],_[1],0,0),{startDate:ts,endDate:ta}},Tt=function(t){var e,n,C,_,ts,ta,tl,th,tc=t.startTime,td=t.endTime,tu=t.timezoneOffset,tp=v(It(tc),2),t8=tp[0],tf=tp[1],tv=v(It(td),2),tg=tv[0],tm=tv[1];return{start:[t8-tu,tf],end:[(tg+=(e=tc,n=td,_=(C=v(It(e),2))[0],ts=C[1],tl=(ta=v(It(n),2))[0],th=ta[1],_===tl?ts>th:_>tl)?24:0)-tu,tm]}};function It(t){return t.split(":").map(function(t){return parseInt(t,10)})}var Ht,Nt=864e5,Pt=function(t){return!isNaN(+t)},Ot=function(t){return Pt(t)?6e4*+t:"D"===t?Nt:7*Nt},Dt=function(t){return new Date(1e3*t)},At=function(t){return+t/1e3};function Lt(t){return!R(t)&&!B(t)}function Rt(t){return R(t)}!function(t){t.Solid="solid",t.VerticalGradient="gradient"}(Ht||(Ht={}));var Ft=["EMA","SMA","RSI","MACD","STOCH"],Bt=function(t){return{index:t.time,value:t.price}},Vt=function(t){return Math.max(t,1)},zt=function(){if(!b)return!1;var t=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||!!b&&("ontouchstart"in window||Boolean(window.DocumentTouch&&document instanceof window.DocumentTouch));return"onorientationchange"in window&&t}();!function(){if(!b)return!1;/Android/i.test(navigator.userAgent),/iPhone|iPad|iPod|AppleWebKit.+Mobile/i.test(navigator.userAgent)}();var Wt,jt=function(){function t(){var t=this;this._updated=!0,this.setData=function(e){t._data=e,t._updated=!0},this.remove=function(){t._tooltipEl&&t._tooltipEl.remove()},this.getTooltipCoords=function(e,n){if(void 0===n&&(n=!1),!t._data)return{x:0,y:0};var C=t._data,_=C.firstPoint,ts=C.secondPoint,ta=n?-1:1,tl=(ts.x-_.x)*ta>0?"right":"left",th=(ts.y-_.y)*ta>0?"top":"bottom";return{x:ts.x+e[tl],y:ts.y+e[th]}}}return t.prototype.draw=function(t,e,n,C){if(this._data){var _,ts,ta,tl,th,tc,td,tu,tp,t8,tf,tv,tg,tm,ty,t$,tS,tb,tw,tx,tP=this._data,tC=tP.firstPoint,t_=tP.secondPoint,tT=Math.round(tC.x*e),tk=Math.round(tC.y*e),tI=Math.round(t_.x*e),tR=Math.round(t_.y*e);t.save(),t.fillStyle=this._data.backgroundColor,t.strokeStyle=this._data.color,t.lineWidth=Math.floor(e),t.fillRect(tT,tk,tI-tT,tR-tk),_=t,ts=Math.round((tR+tk)/2),ta=tT,tl=tI,th=this._data.color,void 0===(tc=e)&&(tc=1),_.save(),th&&(_.fillStyle=th,_.strokeStyle=th),T(_,ts,ta,tl),td=new Path2D(H),tp=4*tc*((tu=tl-ta>=0)?-1:1),t8=7*tc/2*(tu?-1:1)+(_.lineWidth%2?.5:0),_.translate(tl+tp,ts+t8),_.rotate(tu?0:Math.PI),_.scale(tc,tc),_.fill(td),_.restore(),tf=t,tv=Math.round((tT+tI)/2),tg=tk,tm=tR,ty=this._data.color,void 0===(t$=e)&&(t$=1),tf.save(),ty&&(tf.fillStyle=ty,tf.strokeStyle=ty),I(tf,tv,tg,tm),tS=new Path2D(H),tw=7*t$/2*((tb=tm-tg>=0)?1:-1)+(tf.lineWidth%2?.5:0),tx=4*t$*(tb?-1:1),tf.translate(tv+tw,tm+tx),tf.rotate(tb?Math.PI/2:3*Math.PI/2),tf.scale(t$,t$),tf.fill(tS),tf.restore(),t.restore(),this.drawTooltip(t)}},t.prototype.drawTooltip=function(t){var e=this._getTooltipEl(t);if(e&&this._data){var n=Gt(e),C=Ut(t.canvas),_=this.getTooltipCoords(n);(_.y<C.top+n.top||_.y>C.bottom+n.bottom)&&(_=this.getTooltipCoords(n,!0));var ts,ta=this._data;Zt(ta.firstPoint,ta.secondPoint,t.canvas)&&(_=qt(_,t.canvas,e)),e.style.backgroundColor=this._data.tooltipBackground,e.style.boxShadow=this._data.tooltipShadow,e.style.font=this._data.tooltipFont,e.style.transform="translate("+_.x+"px, "+_.y+"px)",e.innerHTML=this._data.rulerData,this._updated=!1}},t.prototype._getTooltipEl=function(t){var e;if(this._tooltipElContainer=t.canvas.closest(".CHART_CANVAS_CONTAINER"),this._tooltipElContainer&&this._updated&&this._data)return this._tooltipEl=this._tooltipElContainer.querySelector(".ruler_data"),this._tooltipEl?this._tooltipEl.style.visibility="visible":(this._tooltipEl=document.createElement("div"),this._tooltipEl.className="ruler_data",this._tooltipEl.style.position="absolute",this._tooltipEl.style.borderRadius="8px",this._tooltipEl.style.padding="8px",this._tooltipEl.style.maxWidth="100%",this._tooltipEl.style.zIndex="3",this._tooltipEl.style.pointerEvents="none",this._tooltipEl.style.visibility="hidden",null===(e=this._tooltipElContainer)||void 0===e||e.appendChild(this._tooltipEl)),this._tooltipEl},t}(),Gt=function(t){return{top:10,bottom:-t.clientHeight-10,left:10,right:-10-t.clientWidth}},Ut=function(t){return{top:0,bottom:t.clientHeight,left:0,right:t.clientWidth}},Zt=function(t,e,n){var C=Ut(n),_=function(n){return[t,e].every(n)},ts=!_(function(t){return t.y<C.top})&&!_(function(t){return t.y>C.bottom}),ta=!_(function(t){return t.x<C.left})&&!_(function(t){return t.x>C.right});return ts||ta},qt=function(t,e,n){var C=Ut(e),_=Gt(n),ts=Object.keys(C).reduce(function(t,e){var n;return f(f({},t),((n={})[e]=C[e]+_[e],n))},{});return{x:Math.max(Math.min(t.x,ts.right),ts.left),y:Math.max(Math.min(t.y,ts.bottom),ts.top)}},Kt=function(){function t(t){var e=this;this._renderer=new jt,this._prevPoints=[],this._isPointEqual=function(t,e){return t.x===e.x&&t.y===e.y},this.isPointsChanged=function(t){return t.some(function(t,n){return!e._prevPoints[n]||!e._isPointEqual(t,e._prevPoints[n])})},this._source=t}return t.prototype.renderer=function(t,e){return this._updateImpl(),this._renderer},t.prototype._updateImpl=function(){var t=this._source.getPointsCoords(),e=this._source.getColors(),n=e.color,C=e.tooltipLineHeight,_=e.tooltipBoldLineHeight,ts=e.tooltipColor,ta=e.tooltipBoldFont,tl=m(e,["color","tooltipLineHeight","tooltipBoldLineHeight","tooltipColor","tooltipBoldFont"]);if(t&&(this.isPointsChanged(t)||!G(e,this._prevOptions))){this._prevPoints=t,this._prevOptions=e;var th=this._source.getRulerData();this._renderer.setData(f({firstPoint:t[0],secondPoint:t[1],color:n,rulerData:th?'<div \n						style="color: '+n+"; font: "+ta+"; margin-bottom: 4px; line-height: "+_+'"\n					>'+th.priceDiff+" ("+th.relPriceDiff+'%)</div>\n                    <div style="color: '+ts+"; margin-bottom: 4px; line-height: "+C+'">'+th.barsCount+'</div>\n                    <div style="color: '+ts+"; line-height: "+C+'">'+th.timeDiff+"</div>":""},tl))}},t}(),Yt=function(t){function e(e,n){var C=t.call(this)||this;return C._source=e,C._priceScale=n,C}return p(e,t),e.prototype.setValue=function(t){this._value=t},e.prototype._updateRendererData=function(t,e,n){t.visible=!1;var C=this._priceScale.firstValue();if(!this._priceScale.isEmpty()&&null!==C&&this._value){var _=this._source.getColors().color;n.background=_,n.color=de(_).foreground,n.coordinate=this._source.yCoord(this._value.price),t.text=this._priceScale.formatPrice(this._value.price,C),t.visible=!0}},e}(xe),Xt=function(){var t=this;this._rendererData=void 0,this.setData=function(e){t._rendererData=e},this.draw=function(e,n,C,_,ts,ta){if(t._rendererData){e.save();var tl=t._rendererData,th=tl.x,tc=tl.y,td=tl.height,tu=tl.color;e.fillStyle=tu,e.scale(ta,ta),e.fillRect(th,tc,e.canvas.width,td),e.restore()}}},$t=function(){function t(t){var e=this;this._renderer=new Xt,this._invalidated=!0,this._getRendererData=function(){var t=e._source.getPointsCoords();if(t){var n=t.map(function(t){return t.y}),C=Math.min.apply(Math,y([],v(n),!1));return{x:0,y:C,height:Math.max.apply(Math,y([],v(n),!1))-C,color:e._source.getColors().backgroundColor}}},this.renderer=function(){if(e._invalidated){var t=e._getRendererData();t&&e._renderer.setData(t)}return e._renderer},this._source=t}return t.prototype.update=function(){this._invalidated=!0},t}(),Jt=function(){function t(t,e){var n=this;this._renderer=new Me(!1),this._updated=!1,this.setValues=function(t){n._values="function"==typeof t?t(n._values):t},this.pushValue=function(t){return n.setValues(y(y([],v(n._values),!1),[t],!1))},this.renderer=function(){return n._updated&&n._updateImpl(),n._renderer.setData(n._rendererData),n._renderer},this._updateImpl=function(){n._rendererData=n._values.map(function(t){return n._formatRendererData(t)});var t=n._source.getColors().backgroundColor;t&&n._renderer.setBackgroundBetween(t)},this._formatRendererData=function(t){var e,C=f({},Qt),_=n._model.timeScale();if(_.isEmpty())return C;C.width=_.width(),C.coordinate=null!==(e=t.coordinate)&&void 0!==e?e:NaN,C.text=t.time?_.formatDateTime(O(t.time)):"";var ts=n._source.getColors().color;return C.background=ts,C.color=de(ts).foreground,C},this._source=t,this._model=e,this._rendererData=[],this._values=[]}return t.prototype.update=function(){this._updated=!0},t}(),Qt={visible:!0,background:"blue",color:"white",text:"",width:0,coordinate:NaN};function en(t){return"left"===t||"right"===t}!function(t){t.Left="left",t.Right="right",t.NonPrimary="non-primary"}(Wt||(Wt={}));var tn,nn=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t,e,n,C){var _=this;if(null!==this._data){var ts=Math.max(1,Math.floor(e));t.lineWidth=ts;var ta,tl,th=Math.ceil(this._data.h*e),tc=Math.ceil(this._data.w*e);ta=t,tl=function(){var n,C,ta,tl,td=O(_._data);if(td.vertLinesVisible){t.strokeStyle=td.vertLinesColor,k(t,td.vertLineStyle),t.beginPath();try{for(var tu=g(td.timeMarks),tp=tu.next();!tp.done;tp=tu.next()){var t8=tp.value,tf=Math.round(t8.coord*e);t.moveTo(tf,-ts),t.lineTo(tf,th+ts)}}catch(tv){n={error:tv}}finally{try{tp&&!tp.done&&(C=tu.return)&&C.call(tu)}finally{if(n)throw n.error}}t.stroke()}if(td.horzLinesVisible){t.strokeStyle=td.horzLinesColor,k(t,td.horzLineStyle),t.beginPath();try{for(var tg=g(td.priceMarks),tm=tg.next();!tm.done;tm=tg.next()){var ty=tm.value,t$=Math.round(ty.coord*e);t.moveTo(-ts,t$),t.lineTo(tc+ts,t$)}}catch(tS){ta={error:tS}}finally{try{tm&&!tm.done&&(tl=tg.return)&&tl.call(tg)}finally{if(ta)throw ta.error}}t.stroke()}},ta.save(),ta.lineWidth%2&&ta.translate(.5,.5),tl(),ta.restore()}},t}(),rn=function(){function t(t){this._renderer=new nn,this._invalidated=!0,this._pane=t}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(t,e){if(this._invalidated){var n=this._pane.model().options().grid,C={h:t,w:e,horzLinesVisible:n.horzLines.visible,vertLinesVisible:n.vertLines.visible,horzLinesColor:n.horzLines.color,vertLinesColor:n.vertLines.color,horzLineStyle:n.horzLines.style,vertLineStyle:n.vertLines.style,priceMarks:this._pane.defaultPriceScale().marks(),timeMarks:this._pane.model().timeScale().marks()||[]};this._renderer.setData(C),this._invalidated=!1}return this._renderer},t}(),on=function(){function t(t){this._paneView=new rn(t)}return t.prototype.paneView=function(){return this._paneView},t}(),an=function(){function t(t,e,n){this._dataSources=[],this._overlaySourcesByScaleId=new Map,this._height=0,this._width=0,this._cachedOrderedSources=null,this._destroyed=new Delegate,this._timeScale=t,this._model=e,this._grid=new on(this),this._options=n;var C=e.options();this._leftPriceScale=this._createPriceScale("left",C.leftPriceScale),this._rightPriceScale=this._createPriceScale("right",C.rightPriceScale),this._leftPriceScale.modeChanged().subscribe(this._onPriceScaleModeChanged.bind(this,this._leftPriceScale),this),this._rightPriceScale.modeChanged().subscribe(this._onPriceScaleModeChanged.bind(this,this._rightPriceScale),this)}return t.prototype.applyScaleOptions=function(t){var e,n,C,_=this.model().getPaneIndex(this);if(void 0!==_&&this.applyPaneOptions(null===(C=t.panes)||void 0===C?void 0:C[_]),t.leftPriceScale&&this._leftPriceScale.applyOptions(t.leftPriceScale),"right"===this._rightPriceScale.id()&&t.rightPriceScale&&this._rightPriceScale.applyOptions(t.rightPriceScale),"non-primary"===this._rightPriceScale.id()&&t.nonPrimaryPriceScale&&this._rightPriceScale.applyOptions(t.nonPrimaryPriceScale),t.localization&&(this._leftPriceScale.updateFormatter(),this._rightPriceScale.updateFormatter()),t.overlayPriceScales){var ts=Array.from(this._overlaySourcesByScaleId.values());try{for(var ta=g(ts),tl=ta.next();!tl.done;tl=ta.next()){var th=O(tl.value[0].priceScale());th.applyOptions(t.overlayPriceScales),t.localization&&th.updateFormatter()}}catch(tc){e={error:tc}}finally{try{tl&&!tl.done&&(n=ta.return)&&n.call(ta)}finally{if(e)throw e.error}}}},t.prototype.updatePriceScalesFormatters=function(){this._leftPriceScale.updateFormatter(),this._rightPriceScale.updateFormatter()},t.prototype.applyPaneOptions=function(t){L(this._options,null!=t?t:{})},t.prototype.priceScaleById=function(t){switch(t){case"left":return this._leftPriceScale;case"right":return this._rightPriceScale}return this._overlaySourcesByScaleId.has(t)?P(this._overlaySourcesByScaleId.get(t))[0].priceScale():null},t.prototype.destroy=function(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this._leftPriceScale.modeChanged().unsubscribeAll(this),this._rightPriceScale.modeChanged().unsubscribeAll(this),this._dataSources.forEach(function(t){t.destroy&&t.destroy()}),this._destroyed.fire()},t.prototype.stretchFactor=function(){return this._isMobileMode()?this._options.stretchFactorMobile:this._options.stretchFactor},t.prototype.setStretchFactor=function(t){this._isMobileMode()?this._options.stretchFactorMobile=t:this._options.stretchFactor=t},t.prototype.options=function(){return this._options},t.prototype.model=function(){return this._model},t.prototype.width=function(){return this._width},t.prototype.height=function(){return this._height},t.prototype.setWidth=function(t){this._width=t,this.updateAllSources()},t.prototype.setHeight=function(t){var e=this;this._height=t,this._leftPriceScale.setHeight(t),this._rightPriceScale.setHeight(t),this._dataSources.forEach(function(n){if(e.isOverlay(n)){var C=n.priceScale();null!==C&&C.setHeight(t)}}),this.updateAllSources()},t.prototype.dataSources=function(){return this._dataSources},t.prototype.isOverlay=function(t){var e=t.priceScale();return null===e||this._leftPriceScale!==e&&this._rightPriceScale!==e},t.prototype.addDataSource=function(t,e,n){var C=void 0!==n?n:this._getZOrderMinMax().minZOrder-1;this._insertDataSource(t,e,C)},t.prototype.removeDataSource=function(t){var e=this._dataSources.indexOf(t);N(-1!==e,"removeDataSource: invalid data source"),this._dataSources.splice(e,1);var n=O(t.priceScale()).id();if(this._overlaySourcesByScaleId.has(n)){var C=P(this._overlaySourcesByScaleId.get(n)),_=C.indexOf(t);-1!==_&&(C.splice(_,1),0===C.length&&this._overlaySourcesByScaleId.delete(n))}var ts=t.priceScale();ts&&ts.dataSources().indexOf(t)>=0&&ts.removeDataSource(t),null!==ts&&(ts.invalidateSourcesCache(),this.recalculatePriceScale(ts)),this._cachedOrderedSources=null},t.prototype.priceScalePosition=function(t){return t===this._leftPriceScale?"left":t===this._rightPriceScale?"right":"overlay"},t.prototype.leftPriceScale=function(){return this._leftPriceScale},t.prototype.rightPriceScale=function(){return this._rightPriceScale},t.prototype.startScalePrice=function(t,e){t.startScale(e)},t.prototype.scalePriceTo=function(t,e){t.scaleTo(e),this.updateAllSources()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,e){t.startScroll(e)},t.prototype.scrollPriceTo=function(t,e){t.scrollTo(e),this.updateAllSources()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.updateAllSources=function(){this._dataSources.forEach(function(t){t.updateAllViews()})},t.prototype.defaultPriceScale=function(){var t=null;return this._model.options().rightPriceScale.visible&&0!==this._rightPriceScale.dataSources().length?t=this._rightPriceScale:this._model.options().leftPriceScale.visible&&0!==this._leftPriceScale.dataSources().length?t=this._leftPriceScale:0!==this._dataSources.length&&(t=this._dataSources[0].priceScale()),null===t&&(t=this._rightPriceScale),t},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this._recalculatePriceScaleImpl(t)},t.prototype.resetPriceScale=function(t){var e=this._timeScale.visibleStrictRange();t.setMode({autoScale:!0}),null!==e&&t.recalculatePriceRange(e),this.updateAllSources()},t.prototype.momentaryAutoScale=function(){this._recalculatePriceScaleImpl(this._leftPriceScale),this._recalculatePriceScaleImpl(this._rightPriceScale)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this._leftPriceScale),this.recalculatePriceScale(this._rightPriceScale),this._dataSources.forEach(function(e){t.isOverlay(e)&&t.recalculatePriceScale(e.priceScale())}),this.updateAllSources(),this._model.lightUpdate()},t.prototype.orderedSources=function(){return null===this._cachedOrderedSources&&(this._cachedOrderedSources=$e(this._dataSources)),this._cachedOrderedSources},t.prototype.onDestroyed=function(){return this._destroyed},t.prototype.grid=function(){return this._grid},t.prototype._recalculatePriceScaleImpl=function(t){var e=t.sourcesForAutoScale();if(e&&e.length>0&&!this._timeScale.isEmpty()){var n=this._timeScale.visibleStrictRange();null!==n&&t.recalculatePriceRange(n)}t.updateAllViews()},t.prototype._getZOrderMinMax=function(){var t=this.orderedSources();if(0===t.length)return{minZOrder:0,maxZOrder:0};for(var e=0,n=0,C=0;C<t.length;C++){var _=t[C].zorder();null!==_&&(_<e&&(e=_),_>n&&(n=_))}return{minZOrder:e,maxZOrder:n}},t.prototype._insertDataSource=function(t,e,n){var C=this.priceScaleById(e);if(null===C&&(C=this._createPriceScale(e,this._model.options().overlayPriceScales)),this._dataSources.push(t),!en(e)){var _=this._overlaySourcesByScaleId.get(e)||[];_.push(t),this._overlaySourcesByScaleId.set(e,_)}C.addDataSource(t),t.setPriceScale(C),t.setZorder(n),this.recalculatePriceScale(C),this._cachedOrderedSources=null},t.prototype._onPriceScaleModeChanged=function(t,e,n){e.mode!==n.mode&&this._recalculatePriceScaleImpl(t)},t.prototype._createPriceScale=function(t,e){var n=f({visible:!0,autoScale:!0},z(e)),C=new et(t,n,this._model.options().layout,this._model.options().localization);return C.setHeight(this.height()),C},t.prototype._isMobileMode=function(){return void 0===this._isMobile&&(this._isMobile=Boolean(this.model().options().isMobile)),this._isMobile},t}(),sn=function(){function t(t){var e,n,C=this;this._pane=null,this._priceAxisViews=[new Map,new Map],this._priceAxisBackgroundView=new $t(this),this._defaultPercentFormatter=new Pe(100,1),this._tempPaneIndex=0,this.switchOff=function(){var t,e,n,_;C._model.applyOptions({activeDrawingTool:null}),null===(e=(t=C._model.options().drawingConfig).eventHandler)||void 0===e||e.call(t,"remove","ruler"),null===(_=(n=C._model.chartWidget).activeToolChangeHandler)||void 0===_||_.call(n,{})},this.getRulerData=function(){var t,e,n,_=v([C.firstPoint,C.secondPoint||C.crosshairPoint],2),ts=_[0],ta=_[1];if(ts&&ta){var tl=null===(t=C._model.serieses().find(function(t){return t.isMain()}))||void 0===t?void 0:t.options().priceFormat,th=null!==(e=null==tl?void 0:tl.minMove)&&void 0!==e?e:.01;if(!C._defaultPriceFormatter){var tc=Math.pow(10,null!==(n=null==tl?void 0:tl.precision)&&void 0!==n?n:2);C._defaultPriceFormatter=new Pe(tc,th*tc)}var td,tu,tp,t8,tf,tv,tg,tm,ty,t$=C._model.options().localization.priceFormatter||function(t){return C._defaultPriceFormatter.format(t)},tS=C._model.options().localization.numberFormatter||function(t){return C._defaultPercentFormatter.format(t)},tb=ta.price-ts.price,tw=tS(100*Math.abs(tb/ts.price),2),tx=function(t,e){var n=Math.abs(t)%100;if(n>=5&&n<=20)return t+" "+e[0];var C=n%10;return 1===C?t+" "+e[1]:C>=2&&C<=4?t+" "+e[2]:t+" "+e[0]}(Math.abs(ta.timeIndex-ts.timeIndex),["Ð±Ð°Ñ€Ð¾Ð²","Ð±Ð°Ñ€","Ð±Ð°Ñ€Ð°"]),tP=(td=ts.time.timestamp,tp=Math.abs((tu=ta.time.timestamp)-td),tf=(t8=v(at.map(function(t){var e=Math.floor(tp/t);return tp-=e*t,e}),3))[0],tv=t8[1],tm=0!==(tg=t8[2])?tg+"Ð¼":"",ty=0!==tv?tv+"Ñ‡"+(tm?",":""):"",(0!==tf?tf+"Ð´"+(ty||tm?",":""):"")+" "+ty+" "+tm),tC=th?tS(tb/th,0):void 0;return{priceDiff:t$(tb),relPriceDiff:tw,barsCount:tx,timeDiff:tP,minPriceMoveCount:tC}}},this.getColors=function(){if(!C._direction){var t=v([C.firstPoint,C.secondPoint||C.crosshairPoint],2),e=t[0],n=t[1];n&&e&&(C._direction=n.price>=e.price?"up":"down")}var _=C._model.options().drawingConfig.defaultOptions.ruler,ts=_.colorDown,ta=_.colorUp,tl=_.backgroundDown,th=_.backgroundUp,tc=m(_,["colorDown","colorUp","backgroundDown","backgroundUp"]);return f({color:"down"===C._direction?ts:ta,backgroundColor:"down"===C._direction?tl:th},tc)},this.yCoord=function(t){var e,n=null===(e=C._pane)||void 0===e?void 0:e.defaultPriceScale(),_=null==n?void 0:n.firstValue();return A(n)&&A(_)?n.priceToCoordinate(t,_):NaN},this.getPointsCoords=function(){var t=[C.firstPoint,C.secondPoint||C.crosshairPoint].filter(Boolean);if(t[1]&&t[0])return t.map(function(t){return{x:t.coordinates.x,y:C.yCoord(t.price)}})},this._onPaneWidgetClick=function(t,e){if(e&&R(e.paneIndex)){C.firstPoint&&C.secondPoint&&C.switchOff();var n=e.paneIndex,_=m(e,["paneIndex"]);if(zt&&C._isChangePaneNeeded(e))return C._startTrackingPointOnMobile(n,_),void(C._tempPaneIndex=n);if(C._setPaneIndexOnce(n),C._checkPaneByIndex(n)){if(C.firstPoint){if(!C.secondPoint&&(C.secondPoint=C.crosshairPoint,C.secondPoint)){C._updateXcoordIfNeeded(C.secondPoint);var ts=C._formatTimeAxisViewValue(C.secondPoint);C._timeAxisView.setValues(function(t){return[t[0],ts]}),C._setPriceAxisViewValue(C._priceAxisViews[1],C.secondPoint),C._saveCrosshairOnSensor(!1)}}else C.firstPoint=C.crosshairPoint,C.firstPoint&&(C._updateXcoordIfNeeded(C.firstPoint),C._timeAxisView.pushValue(C._formatTimeAxisViewValue(C.firstPoint)),C._setPriceAxisViewValue(C._priceAxisViews[0],C.firstPoint))}}},this._isChangePaneNeeded=function(t){if(void 0!==C._paneIndex)return!1;var e=t.paneIndex;return R(e)&&e!==C._tempPaneIndex},this._onPaneWidgetMove=function(t,e){if(e&&R(e.paneIndex)){var n=e.paneIndex,_=m(e,["paneIndex"]);if((!C.secondPoint||!C.firstPoint)&&(C._tempPaneIndex=n,C._checkPaneByIndex(n)&&(C.crosshairPoint=C._formatRulerPoint(t,_),C.crosshairPoint&&C.firstPoint&&!C.secondPoint))){C._updateXcoordIfNeeded(C.crosshairPoint);var ts=C._formatTimeAxisViewValue(C.crosshairPoint);C._timeAxisView.setValues(function(t){return[t[0],ts]}),C._setPriceAxisViewValue(C._priceAxisViews[1],C.crosshairPoint);var ta=C.crosshairPoint.price>=C.firstPoint.price?"up":"down";ta!==C._direction&&(C._direction=ta,C._changeCrosshairColor())}}},this._formatRulerPoint=function(t,e){var n;if(null!==t&&e){var _=null===(n=C._pane)||void 0===n?void 0:n.defaultPriceScale(),ts=null==_?void 0:_.firstValue(),ta=A(_)&&A(ts)&&_.coordinateToPrice(e.y,ts),tl=C._model.timeScale().indexToTime(t,!1);return R(ta)&&A(tl)?{time:tl,timeIndex:t,coordinates:e,price:ta}:void 0}},this._formatTimeAxisViewValue=function(t){return{time:t.time,coordinate:t.coordinates.x}},this._updateXcoordIfNeeded=function(t){var e=C._model.timeScale(),n=e.timeToIndex(t.time,!1,!1),_=null!==n?e.indexToCoordinate(n):null;null!==_&&t.coordinates.x!==_&&(t.coordinates.x=_)},this._getPrice=function(t,e){var n,_=e.price;if(t===(null===(n=C._pane)||void 0===n?void 0:n.defaultPriceScale()))return _;var ts=t.firstValue();return t.coordinateToPrice(e.coordinates.y,ts)},this._setPriceAxisViewValue=function(t,e){t.forEach(function(t){var n=C._getPrice(t._priceScale,e);t.setValue({price:n})})},this._changeCrosshairColor=function(t){void 0===t&&(t=C.getColors().color),C._model.changeCrosshairColor(t)},this._model=t,this._paneView=new Kt(this),this._model.clicked().subscribe(this._onPaneWidgetClick),this._model.crosshairMoved().subscribe(this._onPaneWidgetMove),this._timeAxisView=new Jt(this,t);var _=u(this._model.options().drawingConfig,"ruler").defaultCrosshairColor;this._changeCrosshairColor(_),null===(n=(e=this._model.chartWidget).activeToolChangeHandler)||void 0===n||n.call(e,{type:"ruler"}),zt&&(this._startTrackingPointOnMobile(this._tempPaneIndex),this._saveCrosshairOnSensor(!0))}return t.prototype.paneViews=function(t){var e=this._model.getPaneIndex(t);return this._checkPaneByIndex(e)?(this._pane=t,this._addFirstPointIfHas(),this._setCrosshairPointOnPaneChangeOnce(),[this._paneView]):[]},t.prototype.setFirstPoint=function(t,e,n){this._setPaneIndexOnce(n),this._firstPointRawData={point:t,timeIndex:e}},t.prototype._addFirstPointIfHas=function(){this._firstPointRawData&&(this.firstPoint=this._formatRulerPoint(this._firstPointRawData.timeIndex,this._firstPointRawData.point))},t.prototype.timeAxisViews=function(){return[this._timeAxisView]},t.prototype.pane=function(){return this._pane},t.prototype.updateAllViews=function(){this._timeAxisView.update(),this._updateCoordinates(),this._priceAxisViews.forEach(function(t){return t.forEach(function(t){return t.update()})})},t.prototype.destroy=function(){this._model.clicked().unsubscribe(this._onPaneWidgetClick),this._model.crosshairMoved().unsubscribe(this._onPaneWidgetMove),this._paneView._renderer.remove(),this._saveCrosshairOnSensor(!1)},t.prototype.priceAxisViews=function(t,e){var n=this,C=this._model.getPaneIndex(t);if(!this._checkPaneByIndex(C))return[];this._pane!==t&&this._priceAxisViews.forEach(function(t){return t.clear()});var _=[];return _.push(this._priceAxisBackgroundView),this._priceAxisViews.forEach(function(t){return _.push(n._createPriceAxisViewOnDemand(t,e))}),_},t.prototype._startTrackingPointOnMobile=function(t,e){void 0===t&&(t=this._model.mainPaneIndex);var n=this._model.getPaneWidgetByIndex(t);if(void 0!==n){var C=null!=e?e:n.getPaneMiddlePoint();n.startTrackingMode(C,C),this._pointInNewPane=C}},t.prototype._setCrosshairPointOnPaneChangeOnce=function(){if(this._pointInNewPane){var t=this._model.timeScale().coordinateToIndex(this._pointInNewPane.x);this.crosshairPoint=this._formatRulerPoint(t,this._pointInNewPane),this._pointInNewPane=void 0}},t.prototype._setPaneIndexOnce=function(t){void 0===this._paneIndex&&(this._paneIndex=t)},t.prototype._checkPaneByIndex=function(t){return void 0!==this._paneIndex?this._paneIndex===t:this._tempPaneIndex===t},t.prototype._createPriceAxisViewOnDemand=function(t,e){var n=t.get(e);return void 0===n&&(n=new Yt(this,e),t.set(e,n)),n},t.prototype._updateCoordinates=function(){var t=this,e=[this.firstPoint,this.firstPoint&&(this.secondPoint||this.crosshairPoint)].filter(Boolean).map(function(e){return t._updateXcoordIfNeeded(e),t._formatTimeAxisViewValue(e)});this._timeAxisView.setValues(e)},t.prototype._saveCrosshairOnSensor=function(t){var e=this._model.options().drawingOptionsInternal.saveMobileCrosshairOnClick;zt&&t!==e&&this._model.applyOptions({drawingOptionsInternal:{saveMobileCrosshairOnClick:t}})},t}(),ln=function(t,e,n,C,_){var ts=n.x,ta=n.y,tl=C.x,th=C.y,tc=v([Math.min(ts,tl)-_,Math.max(ts,tl)+_],2),td=tc[0],tu=tc[1],tp=v([Math.min(ta,th)-_,Math.max(ta,th)+_],2),t8=tp[0],tf=tp[1];if(e<=t8||e>=tf||t<=td||t>=tu)return!1;var tv=cn(n,C),tg=un(n,C);return t>=tv(e)-_&&t<=tv(e)+_||e>=tg(t)-_&&e<=tg(t)+_},cn=function(t,e){return function(n){var C=t.x,_=t.y,ts=e.x,ta=e.y;return C+(ta-_&&(n-_)/(ta-_)*(ts-C))}},un=function(t,e){return function(n){var C=t.x,_=t.y,ts=e.x,ta=e.y;return _+(ts-C&&(n-C)/(ts-C)*(ta-_))}},dn=function(){return zt?8:6},hn=function(t,e,n){var C=this;this.onActiveUpdate=n,this._coordinates=[],this._linePointsCoordinates=[],this._updated=!0,this._active={},this.setData=function(t,e){C._coordinates=t,C._options=e},this.setActive=function(t){var e;C._active.isFixed||C._active.value===t||(null===(e=C.onActiveUpdate)||void 0===e||e.call(C),C._active.value=t)},this.draw=function(t,e){C._coordinates.length<2||(t.save(),t.scale(e,e),t.strokeStyle=C._options.lineColorValue,t.lineWidth=C._options.lineWidth,k(t,C._options.lineStyle),C._linePointsCoordinates=function(t,e,n){cn(e,n);var C=un(e,n);if(e.x===n.x){var _=e.y<n.y?["bottom","top"]:["top","bottom"];return[e,n].map(function(e,n){var C,ts,ta;return e.continious?(C=t,ts=e.x,{x:ts,y:"top"===(ta=_[n])?C.canvas.height:0}):e})}var ts=e.x<n.x?["left","right"]:["right","left"];return[e,n].map(function(e,n){var _,ta,tl,th,tc;return e.continious?(_=t,ta=C,tl=ts[n],th=_.canvas.width,{x:tc="left"===tl?0:th,y:ta(tc)}):e})}(t,f(f({},C._coordinates[0]),{continious:C._options.firstPoint.continuous}),f(f({},C._coordinates[1]),{continious:C._options.secondPoint.continuous})),t.beginPath(),t.moveTo(C._linePointsCoordinates[0].x,C._linePointsCoordinates[0].y),t.lineTo(C._linePointsCoordinates[1].x,C._linePointsCoordinates[1].y),t.stroke(),C._active.value&&(k(t,0),t.lineWidth=C._active.isFixed?4:2,C._coordinates.forEach(function(e){var n=e.x,_=e.y;e.isSurrogatePoint||(t.fillStyle=C._options.circlesBackground,t.beginPath(),t.moveTo(n+pn,_),t.arc(n,_,pn,0,2*Math.PI),t.fill(),t.stroke())})),t.restore())},this.hitTest=function(t,e){if(C._coordinates.length<2||C._linePointsCoordinates.length<2)return null;var n=C._coordinates.findIndex(C._hitTestPoint(t,e)),_=-1!==n?[n]:ln(t,e,C._linePointsCoordinates[0],C._linePointsCoordinates[1],fn)?[0,1]:void 0,ts=function(t,e,n,C){if(null==C?void 0:C.length){if(1===C.length){var _=n[C[0]];return{x:_.x,y:_.y}}if(2===C.length){var ts=n[C[0]],ta=n[C[1]];return ts.x===ta.x?{x:ts.x,y:e}:ts.y===ta.y?{x:t,y:ts.y}:void 0}}}(t,e,C._coordinates,_);return C.setActive(!!_),_?{hitTestData:{pressedMouseMoveble:!0,pointsIndexes:_,crosshairPoint:ts}}:null},this._hitTestPoint=function(t,e){return function(n){var C=n.x-t,_=n.y-e;return Math.sqrt(C*C+_*_)<1.5*fn}},this._options=t,this._active={value:e,isFixed:!!e}},pn=4,fn=dn(),mn=function(){function t(t,e,n){var C,_,ts=this;this.getRendererOptions=function(){return gn(ts._source.getRendererOptions(),ts._drawingMode)},this.renderer=function(){return ts._updateImpl(),ts._renderer},this.clickHandler=function(){var t,e;null===(e=(t=ts._source).activateToolDrawing)||void 0===e||e.call(t)},this.mouseDownHandler=function(){var t,e;null===(e=(t=ts._source).activateToolDrawing)||void 0===e||e.call(t)},this.pressedMouseMoveFinish=function(){var t,e;return null===(e=(t=ts._source).handlePressedPointsMoveFinish)||void 0===e?void 0:e.call(t)},this._source=t,this._drawingMode=e;var ta=null===(_=(C=this._source).model)||void 0===_?void 0:_.call(C);this._renderer=new hn(this.getRendererOptions(),n,null==ta?void 0:ta.lightUpdate.bind(ta)),this.pressedMouseMoveHandler=this._source.handlePressedPointsMove&&function(){for(var t,e,n=[],C=0;C<arguments.length;C++)n[C]=arguments[C];return null===(e=(t=ts._source).handlePressedPointsMove)||void 0===e?void 0:e.call.apply(e,y([t],v(n),!1))}}return t.prototype.setActive=function(t){this._renderer.setActive(t)},t.prototype._updateImpl=function(){var t,e=vn(null!==(t=this._source.getPointsCoords())&&void 0!==t?t:[],this._drawingMode),n=this.getRendererOptions();this._renderer.setData(null!=e?e:[],n)},t}(),gn=function(t,e){switch(e){case"trendLineBeam":return f(f({},t),{firstPoint:{continuous:!1},secondPoint:{continuous:!0}});case"trendLineSegment":return f(f({},t),{firstPoint:{continuous:!1},secondPoint:{continuous:!1}});case"horizontalLine":return f(f({},t),{firstPoint:{continuous:!0},secondPoint:{continuous:!0}});default:return t}},vn=function(t,e){return"horizontalLine"===e?t[0]?y(y([],v(t),!1),[f(f({},t[0]),{x:t[0].x+1,isSurrogatePoint:!0})],!1):[]:t},yn=function(){function t(t){var e,n,C=this;this._model=t,this._pane=null,this._priceAxisViews=[],this._priceAxisBackgroundView=new $t(this),this.points=[],this.priceAxisViewsList=[],this._tempPaneIndex=0,this.getColors=function(){var t=C._model.options().drawingConfig,e=d(C.getOptions().lineColor,t);return{color:e,backgroundColor:he(e,.24)}},this.getRendererOptions=function(){var t=C.getOptions(),e=t.lineColor,n=m(t,["lineColor"]),_=C._model.options().drawingConfig,ts=u(_,C._drawingMode).circlesBackground;return f(f({},n),{circlesBackground:ts,lineColorValue:d(e,_)})},this.getPointsCoords=function(){var t=y(y([],v(C.points),!1),[C.points.length&&C.points.length<C._pointsCount&&C.crosshairPoint],!1).filter(Boolean);return t.forEach(function(t){return C._updateYcoord(t)}),t.map(function(t){return f({},t.coordinates)})},this.yCoord=function(t){var e,n=null===(e=C._pane)||void 0===e?void 0:e.defaultPriceScale(),_=null==n?void 0:n.firstValue();return A(n)&&A(_)?n.priceToCoordinate(t,_):NaN},this.switchOff=function(){C.getOptions().notSave&&(null===(e=(t=C._model.options().drawingConfig).eventHandler)||void 0===e||e.call(t,"remove",C._drawingMode));var t,e,n,_,ts,ta,tl=C._getDrawnTools();null===(_=(n=C._model).applyOptions)||void 0===_||_.call(n,{activeDrawingTool:null,drawnTools:tl}),null===(ta=(ts=C._model.chartWidget).activeToolChangeHandler)||void 0===ta||ta.call(ts,{})},this._dx=0,this.handlePressedPointsMove=function(t,e,n){n&&!C._prevPressedMovePoint&&(C._prevPressedMovePoint=n);var _=t.x-(C._prevPressedMovePoint||t).x,ts=_+C._dx,ta=t.y-(C._prevPressedMovePoint||t).y;C._prevPressedMovePoint=t,e.forEach(function(t,e){var n=C.points[t],tl=null==n?void 0:n.coordinates;if(tl){var th={x:tl.x+ts,y:tl.y+ta},tc=C._model.timeScale().coordinateToIndex(th.x),td=C._formatFixedPoint(tc,f({},th));if(td){var tu=C._formatTimeAxisViewValue(td);0===e&&(tu.time===C.points[t].time?C._dx+=_:C._dx=tu.coordinate?th.x-tu.coordinate:0),C.points[t]=td,C._setPointOnAxis(td,t),zt&&C._model.cursorUpdate()}}})},this.handlePressedPointsMoveFinish=function(){C._dx=0,C._prevPressedMovePoint=void 0},this._isChangePaneNeeded=function(t){return!C._paneIndexSet&&t!==C._tempPaneIndex},this._onPaneWidgetClick=function(t,e){var n=null==e?void 0:e.paneIndex;if(e&&R(n)){if(C.points.length>=C._pointsCount)C.switchOff();else{if(zt&&C._isChangePaneNeeded(n))return C._startTrackingPointOnMobile(n,{x:e.x,y:e.y}),void(C._tempPaneIndex=n);if(C._setPaneIndexOnce(n),C._checkPaneByIndex(n)&&C.crosshairPoint){var _=C.points.length;C.points.push(C.crosshairPoint),C._setPointOnAxis(C.points[_],_),C._model.lightUpdate(),C.points.length>=C._pointsCount&&(C._saveCrosshairOnMobileTouch(!1),C.switchOff())}}}},this._onPaneWidgetMove=function(t,e){var n=null==e?void 0:e.paneIndex;if(e&&R(n)&&(C._tempPaneIndex=n,C._checkPaneByIndex(n))){var _={x:e.x,y:e.y};C.points.length>=C._pointsCount||(C.crosshairPoint=C._formatFixedPoint(t,_),C.crosshairPoint&&C._setPointOnAxis(C.crosshairPoint,C.points.length))}},this._activated=!1,this.getOptions=function(){var t=C._model.options(),e=t.drawingConfig,n=t.activeDrawingTool,_=u(e,C._drawingMode);_.circlesBackground;var ts=m(_,["circlesBackground"]);return f({},(null==n?void 0:n.options)||ts)},this._setPriceAxisViewValue=function(t,e){t.forEach(function(t){var n=C._getPrice(t._priceScale,e);t.setValue({price:n})})},this._getPrice=function(t,e){var n,_=e.price;if(t===(null===(n=C._pane)||void 0===n?void 0:n.defaultPriceScale()))return _;var ts=t.firstValue();return t.coordinateToPrice(e.coordinates.y,ts)},this._getDrawnTools=function(){var t=C._model.options().drawnTools;if(C.getOptions().notSave||C.points.length<C._pointsCount)return t;var e=C.points.map(function(t){return{price:t.price,time:t.time}}),n={id:String(Date.now()),options:C.getOptions(),points:e,type:C._drawingMode};return y(y([],v(t),!1),[n],!1)},this._formatTimeAxisViewValue=function(t){return{time:t.time,coordinate:t.coordinates.x}},this._updateYcoord=function(t){t.coordinates.y=C.yCoord(t.price)},this._updateXcoordIfNeeded=function(t){var e=C._model.timeScale(),n=e.timeToIndex(t.time,!0,!1),_=null!==n?e.indexToCoordinate(n):null;null!==_&&t.coordinates.x!==_&&(t.coordinates.x=_)},this._formatFixedPoint=function(t,e){var n;if(null!==t&&e){var _=null===(n=C._pane)||void 0===n?void 0:n.defaultPriceScale(),ts=null==_?void 0:_.firstValue(),ta=A(_)&&A(ts)&&_.coordinateToPrice(e.y,ts),tl=C._model.timeScale().indexToTime(t,!1),th=f(f({},e),{x:C._model.timeScale().indexToCoordinate(t)});return ta&&A(tl)?{time:tl,timeIndex:t,coordinates:th,price:ta}:void 0}};var _=this._model.options().activeDrawingTool;this.isCreating=!(null==_?void 0:_.initialData),this._paneIndexSet=!this.isCreating,this._drawingMode=null==_?void 0:_.type,this._pointsCount="horizontalLine"===this._drawingMode?1:2;for(var ts=0;ts<this._pointsCount;ts++)this._priceAxisViews.push(new Map);this._paneView=new mn(this,this._drawingMode,!0),this._model.crosshairMoved().subscribe(this._onPaneWidgetMove);var ta=this.getOptions();(null==_?void 0:_.options)||this._model.applyOptions({activeDrawingTool:{options:ta}}),null===(n=(e=this._model.chartWidget).activeToolChangeHandler)||void 0===n||n.call(e,{type:this._drawingMode,options:ta}),this._timeAxisView=new Jt(this,this._model),this._model.clicked().subscribe(this._onPaneWidgetClick),zt&&this.isCreating&&(this._startTrackingPointOnMobile(this._tempPaneIndex),this._saveCrosshairOnMobileTouch(!0))}return t.prototype.priceAxisViews=function(t,e){var n=this,C=this._model.getPaneIndex(t);if(!this._checkPaneByIndex(C))return[];t!==this._pane&&this._priceAxisViews.forEach(function(t){return t.clear()}),this.priceAxisViewsList=[];var _=[];return _.push(this._priceAxisBackgroundView),this._priceAxisViews.forEach(function(t){return _.push(n._createPriceAxisViewOnDemand(t,e))}),_},t.prototype.paneViews=function(t){var e=this._model.getPaneIndex(t);if(!this._checkPaneByIndex(e))return[];var n=this._model.options().activeDrawingTool;return this._pane=t,this._setCrosshairPointOnPaneChangeOnce(),!this._activated&&!this.isCreating&&(null==n?void 0:n.initialData)&&this._isPriceAxisViewsCreated()&&(this._activateFromDrawnTool(n.initialData.points),this._activated=!0),[this._paneView]},t.prototype.timeAxisViews=function(){return[this._timeAxisView]},t.prototype.pane=function(){return this._pane},t.prototype.updateAllViews=function(){this._timeAxisView.update(),this._updateCoordinates(),this._priceAxisViews.forEach(function(t){return t.forEach(function(t){return t.update()})})},t.prototype.destroy=function(){this._model.clicked().unsubscribe(this._onPaneWidgetClick),this._model.crosshairMoved().unsubscribe(this._onPaneWidgetMove),this._saveCrosshairOnMobileTouch(!1)},t.prototype._paneIndex=function(){return this.getOptions().paneIndex},t.prototype._setPaneIndex=function(t){this._model.setActiveToolOptions({paneIndex:t})},t.prototype._setPaneIndexOnce=function(t){this._paneIndexSet||(this._paneIndexSet=!0,this._setPaneIndex(t))},t.prototype._startTrackingPointOnMobile=function(t,e){void 0===t&&(t=this._model.mainPaneIndex);var n=this._model.getPaneWidgetByIndex(t);if(void 0!==n){var C=null!=e?e:n.getPaneMiddlePoint();n.startTrackingMode(C,C),this._pointInNewPane=C}},t.prototype._setCrosshairPointOnPaneChangeOnce=function(){if(this._pointInNewPane){var t=this._model.timeScale().coordinateToIndex(this._pointInNewPane.x);this.crosshairPoint=this._formatFixedPoint(t,this._pointInNewPane),this._pointInNewPane=void 0}},t.prototype._checkPaneByIndex=function(t){return this._paneIndexSet?this._paneIndex()===t:this._tempPaneIndex===t},t.prototype._activateFromDrawnTool=function(t){var e,n,C,_=this,ts=[];if(t.length===this._pointsCount){try{for(var ta=g(t),tl=ta.next();!tl.done;tl=ta.next()){var th=tl.value,tc=null===(C=this._pane)||void 0===C?void 0:C.defaultPriceScale(),td=null==tc?void 0:tc.firstValue(),tu=A(tc)&&A(td)&&tc.priceToCoordinate(th.price,td),tp=this._model.timeScale().timeToIndex(th.time,!0,!1),t8=A(tp)&&this._model.timeScale().indexToCoordinate(tp);if(!R(tu)||!R(t8)||!A(tp))return;ts.push(f(f({},th),{timeIndex:tp,coordinates:{x:t8,y:tu}}))}}catch(tf){e={error:tf}}finally{try{tl&&!tl.done&&(n=ta.return)&&n.call(ta)}finally{if(e)throw e.error}}this.points=ts,this.points.forEach(function(t,e){return _._setPointOnAxis(t,e)}),setTimeout(function(){_._model.fullUpdate()},0)}},t.prototype._setPointOnAxis=function(t,e){var n=this._formatTimeAxisViewValue(t);this._timeAxisView.setValues(function(t){return y(y(y([],v(t.slice(0,e)),!1),[n],!1),v(t.slice(e+1)),!1)}),this._setPriceAxisViewValue(this._priceAxisViews[e],t)},t.prototype._createPriceAxisViewOnDemand=function(t,e){var n=t.get(e);return void 0===n&&(n=new Yt(this,e),t.set(e,n)),this.priceAxisViewsList.push(n),n},t.prototype._isPriceAxisViewsCreated=function(){return this.priceAxisViewsList.length===this._pointsCount},t.prototype._updateCoordinates=function(){var t=this,e=y(y([],v(this.points),!1),[this.points.length<this._pointsCount&&this.crosshairPoint],!1).filter(Boolean).map(function(e){return t._updateYcoord(e),t._updateXcoordIfNeeded(e),t._formatTimeAxisViewValue(e)});this._timeAxisView.setValues(e)},t.prototype._saveCrosshairOnMobileTouch=function(t){var e=this._model.options().drawingOptionsInternal.saveMobileCrosshairOnClick;zt&&t!==e&&this._model.applyOptions({drawingOptionsInternal:{saveMobileCrosshairOnClick:t}})},t}(),_n={ruler:sn,trendLineSegment:yn,trendLineBeam:yn,horizontalLine:yn},Cn={trendLineSegment:mn,trendLineBeam:mn,horizontalLine:mn},bn="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function wn(t,e,n){return void 0!==n?n+=" ":n="",void 0===e&&(e=bn),""+n+t+"px "+e}!function(t){t[t.BorderSize=1]="BorderSize",t[t.TickLength=4]="TickLength"}(tn||(tn={}));var xn,Sn,En=function(){function t(t){this._rendererOptions={borderSize:1,tickLength:4,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this._chartModel=t}return t.prototype.options=function(){var t=this._rendererOptions,e=this._fontSize(),n=this._fontFamily();return t.fontSize===e&&t.fontFamily===n||(t.fontSize=e,t.fontFamily=n,t.font=wn(e,n),t.paddingTop=Math.floor(e/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(e/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(e/2+t.tickLength/2),t.baselineOffset=Math.round(e/10)),t.color=this._textColor(),this._rendererOptions},t.prototype._textColor=function(){return this._chartModel.options().layout.textColor},t.prototype._fontSize=function(){return this._chartModel.options().layout.fontSize},t.prototype._fontFamily=function(){return this._chartModel.options().layout.fontFamily},t}(),Mn=function(){function t(t,e,n){var C=this;this._pane=null,this._xCoordinates=null,this.getRendererOptions=function(){var t=C._model.options().drawingConfig,e=u(t,C._data.type),n=C._data.options,_=n.lineColor,ts=m(n,["lineColor"]);return f(f({},ts),{circlesBackground:e.circlesBackground,lineColorValue:d(_,t)})},this.getId=function(){return C._data.id},this.getPaneIndex=function(){return C._data.options.paneIndex},this.getPointsCoords=function(){if(null!==C._xCoordinates){var t=[];return C._data.points.forEach(function(e,n){t.push({x:C._xCoordinates[n],y:C._yCoord(e.price)})}),t}},this.activateToolDrawing=function(){C._model.activateToolDrawing(C._data)},this._updateXCoords=function(){var t,e;C._xCoordinates=[];try{for(var n=g(C._data.points),_=n.next();!_.done;_=n.next()){var ts=_.value,ta=C._xCoord(ts.time);if(null===ta)return void(C._xCoordinates=null);C._xCoordinates.push(ta)}}catch(tl){t={error:tl}}finally{try{_&&!_.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},this._xCoord=function(t){var e=C._model.timeScale(),n=e.timeToIndex(t,!0,!1);return null===n?null:e.indexToCoordinate(n)},this._yCoord=function(t){var e,n=null===(e=C._pane)||void 0===e?void 0:e.defaultPriceScale(),_=null==n?void 0:n.firstValue();return A(n)&&A(_)?n.priceToCoordinate(t,_):NaN},this._model=t,this._data=n,this._paneView=new e(this,this._data.type),this._updateXCoords()}return t.prototype.model=function(){return this._model},t.prototype.setData=function(t){this._data=t},t.prototype.paneViews=function(t){return this._pane=t,[this._paneView]},t.prototype.deactivate=function(){this._paneView.setActive(!1)},t.prototype.updateAllViews=function(){this._updateXCoords()},t}();!function(t){t[t.None=0]="None",t[t.Cursor=1]="Cursor",t[t.Light=2]="Light",t[t.Full=3]="Full"}(xn||(xn={})),function(t){t[t.FitContent=0]="FitContent",t[t.ApplyRange=1]="ApplyRange",t[t.ApplyBarSpacing=2]="ApplyBarSpacing",t[t.ApplyRightOffset=3]="ApplyRightOffset",t[t.Reset=4]="Reset"}(Sn||(Sn={}));var kn=function(){function t(t){this._invalidatedPanes=new Map,this._force=!1,this._timeScaleInvalidations=[],this._globalLevel=t}return t.prototype.invalidatePane=function(t,e){var n,C,_=(n=this._invalidatedPanes.get(t),C=e,void 0===n?C:{level:Math.max(n.level,C.level),autoScale:n.autoScale||C.autoScale});this._invalidatedPanes.set(t,_)},t.prototype.fullInvalidation=function(){return this._globalLevel},t.prototype.invalidateForPane=function(t){var e=this._invalidatedPanes.get(t);return void 0===e?{level:this._globalLevel}:{level:Math.max(this._globalLevel,e.level),autoScale:e.autoScale}},t.prototype.setFitContent=function(){this._timeScaleInvalidations=[{type:0}]},t.prototype.applyRange=function(t){this._timeScaleInvalidations=[{type:1,value:t}]},t.prototype.resetTimeScale=function(){this._timeScaleInvalidations=[{type:4}]},t.prototype.setBarSpacing=function(t){this._timeScaleInvalidations.push({type:2,value:t})},t.prototype.setRightOffset=function(t){this._timeScaleInvalidations.push({type:3,value:t})},t.prototype.timeScaleInvalidations=function(){return this._timeScaleInvalidations},t.prototype.merge=function(t){var e,n,C=this;this._force=this._force||t._force,this._timeScaleInvalidations=this._timeScaleInvalidations.concat(t._timeScaleInvalidations);try{for(var _=g(t._timeScaleInvalidations),ts=_.next();!ts.done;ts=_.next()){var ta=ts.value;this._applyTimeScaleInvalidation(ta)}}catch(tl){e={error:tl}}finally{try{ts&&!ts.done&&(n=_.return)&&n.call(_)}finally{if(e)throw e.error}}this._globalLevel=Math.max(this._globalLevel,t._globalLevel),t._invalidatedPanes.forEach(function(t,e){C.invalidatePane(e,t)})},t.prototype._applyTimeScaleInvalidation=function(t){switch(t.type){case 0:this.setFitContent();break;case 1:this.applyRange(t.value);break;case 2:this.setBarSpacing(t.value);break;case 3:this.setRightOffset(t.value);break;case 4:this.resetTimeScale()}},t}(),Tn=function(){function t(t){this._precision=t}return t.prototype.format=function(t){var e="";return t<0&&(e="-",t=-t),t<995?e+this._formatNumber(t):t<999995?e+this._formatNumber(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),e+this._formatNumber(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),e+this._formatNumber(t/1e9)+"B")},t.prototype._formatNumber=function(t){var e=Math.pow(10,this._precision);return((t=Math.round(t*e)/e)>=1e-15&&t<1?t.toFixed(this._precision).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,function(t,e){return e})},t}();function In(t,e,n,C){var _=C?e.slice(C.from,C.to):e;if(!(_.length<2)){var ts=_[0].x,ta=_[0].y;t.moveTo(ts,ta);for(var tl=1;tl<_.length;++tl){var th=_[tl];if(1===n){var tc=_[tl-1].y,td=th.x;t.lineTo(td,tc)}t.lineTo(th.x,th.y)}}}var Hn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._data=null,e}return p(e,t),e.prototype.setData=function(t){this._data=t},e.prototype._drawImpl=function(t){if(null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange){if(t.lineCap="butt",t.lineJoin="round",t.strokeStyle=this._data.lineColor,t.lineWidth=this._data.lineWidth,k(t,this._data.lineStyle),t.lineWidth=1,t.beginPath(),1===this._data.items.length){var e=this._data.items[0],n=this._data.barWidth/2;t.moveTo(e.x-n,this._data.bottom),t.lineTo(e.x-n,e.y),t.lineTo(e.x+n,e.y),t.lineTo(e.x+n,this._data.bottom)}else t.moveTo(this._data.items[this._data.visibleRange.from].x,this._data.bottom),t.lineTo(this._data.items[this._data.visibleRange.from].x,this._data.items[this._data.visibleRange.from].y),In(t,this._data.items,this._data.lineType,this._data.visibleRange),this._data.visibleRange.to>this._data.visibleRange.from&&(t.lineTo(this._data.items[this._data.visibleRange.to-1].x,this._data.bottom),t.lineTo(this._data.items[this._data.visibleRange.from].x,this._data.bottom));t.closePath();var C=t.createLinearGradient(0,0,0,this._data.bottom);C.addColorStop(0,this._data.topColor),C.addColorStop(1,this._data.bottomColor),t.fillStyle=C,t.fill()}},e}(Z),Nn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._data=null,e}return p(e,t),e.prototype.setData=function(t){this._data=t},e.prototype._drawImpl=function(t){if(null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange){if(t.lineCap="butt",t.lineWidth=this._data.lineWidth,k(t,this._data.lineStyle),t.strokeStyle=this._data.lineColor,t.lineJoin="round",t.beginPath(),1===this._data.items.length){var e=this._data.items[0];t.moveTo(e.x-this._data.barWidth/2,e.y),t.lineTo(e.x+this._data.barWidth/2,e.y)}else In(t,this._data.items,this._data.lineType,this._data.visibleRange);t.stroke()}},e}(Z);function Pn(t,e,n,C,_){void 0===C&&(C=0),void 0===_&&(_=t.length);for(var ts=_-C;0<ts;){var ta=ts>>1,tl=C+ta;n(t[tl],e)?(C=tl+1,ts-=ta+1):ts=ta}return C}function On(t,e,n,C,_){void 0===C&&(C=0),void 0===_&&(_=t.length);for(var ts=_-C;0<ts;){var ta=ts>>1,tl=C+ta;n(e,t[tl])?ts=ta:(C=tl+1,ts-=ta+1)}return C}function Dn(t,e){return t.time<e}function An(t,e){return t<e.time}function Ln(t,e,n){var C=e.left(),_=e.right(),ts=Pn(t,C,Dn),ta=On(t,_,An);if(!n)return{from:ts,to:ta};var tl=ts,th=ta;return ts>0&&ts<t.length&&t[ts].time>=C&&(tl=ts-1),ta>0&&ta<t.length&&t[ta-1].time<=_&&(th=ta+1),{from:tl,to:th}}var Rn,Fn=function(){function t(t,e,n){this._invalidated=!0,this._dataInvalidated=!0,this._optionsInvalidated=!0,this._items=[],this._itemsVisibleRange=null,this._series=t,this._model=e,this._extendedVisibleRange=n}return t.prototype.update=function(t){this._invalidated=!0,"data"===t&&(this._dataInvalidated=!0),"options"===t&&(this._optionsInvalidated=!0)},t.prototype._makeValid=function(){this._dataInvalidated&&(this._fillRawPoints(),this._dataInvalidated=!1),this._invalidated&&(this._updatePoints(),this._invalidated=!1),this._optionsInvalidated&&(this._updateOptions(),this._optionsInvalidated=!1)},t.prototype._clearVisibleRange=function(){this._itemsVisibleRange=null},t.prototype._updatePoints=function(){var t=this._series.priceScale(),e=this._model.timeScale();if(this._clearVisibleRange(),!e.isEmpty()&&!t.isEmpty()){var n=e.visibleStrictRange();if(null!==n&&0!==this._series.bars().size()){var C=this._series.firstValue();null!==C&&(this._itemsVisibleRange=Ln(this._items,n,this._extendedVisibleRange),this._convertToCoordinates(t,e,C.value))}}},t}(),Bn=function(t){function e(e,n){return t.call(this,e,n,!0)||this}return p(e,t),e.prototype._convertToCoordinates=function(t,e,n){e.indexesToCoordinates(this._items,j(this._itemsVisibleRange)),t.pointsArrayToCoordinates(this._items,n,j(this._itemsVisibleRange))},e.prototype._createRawItemBase=function(t,e){return{time:t,price:e,x:NaN,y:NaN}},e.prototype._updateOptions=function(){},e.prototype._fillRawPoints=function(){var t=this,e=this._series.barColorer();this._items=this._series.bars().rows().map(function(n){var C=n.value[3];return t._createRawItem(n.index,C,e)})},e}(Fn),Vn=function(t){function e(e,n){var C=t.call(this,e,n)||this;return C._renderer=new U,C._areaRenderer=new Hn,C._lineRenderer=new Nn,C._renderer.setRenderers([C._areaRenderer,C._lineRenderer]),C}return p(e,t),e.prototype.renderer=function(t,e){if(!this._series.visible())return null;var n=this._series.options();this._makeValid();var C={lineType:n.lineType,items:this._items,lineColor:n.lineColor,lineStyle:n.lineStyle,lineWidth:n.lineWidth,topColor:n.topColor,bottomColor:n.bottomColor,bottom:t,visibleRange:this._itemsVisibleRange,barWidth:this._model.timeScale().barSpacing()};return this._areaRenderer.setData(C),this._lineRenderer.setData(C),this._renderer},e.prototype._createRawItem=function(t,e){return this._createRawItemBase(t,e)},e}(Bn),zn=function(){function t(){this._data=null,this._barWidth=0,this._barLineWidth=0}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t,e,n,C){if(null!==this._data&&0!==this._data.bars.length&&null!==this._data.visibleRange){this._barWidth=this._calcBarWidth(e),this._barWidth>=2&&Math.max(1,Math.floor(e))%2!=this._barWidth%2&&this._barWidth--,this._barLineWidth=(this._data.thinBars?Math.min(this._barWidth,Math.floor(e)):this._barWidth)||1;for(var _=null,ts=this._barLineWidth<=this._barWidth&&this._data.barSpacing>=Math.floor(1.5*e),ta=this._data.visibleRange.from;ta<this._data.visibleRange.to;++ta){var tl=this._data.bars[ta];_!==tl.color&&(t.fillStyle=tl.color,_=tl.color);var th=Math.floor(.5*this._barLineWidth),tc=Math.round(tl.x*e),td=tc-th,tu=this._barLineWidth,tp=td+tu-1,t8=Math.min(tl.highY,tl.lowY),tf=Math.max(tl.highY,tl.lowY),tv=Math.round(t8*e)-th,tg=Math.max(Math.round(tf*e)+th-tv,this._barLineWidth);t.fillRect(td,tv,tu,tg);var tm=Math.ceil(1.5*this._barWidth);if(ts){if(this._data.openVisible){var ty=tc-tm,t$=Math.max(tv,Math.round(tl.openY*e)-th),tS=t$+tu-1;tS>tv+tg-1&&(t$=(tS=tv+tg-1)-tu+1),t.fillRect(ty,t$,td-ty,tS-t$+1)}var tb=tc+tm,tw=Math.max(tv,Math.round(tl.closeY*e)-th),tx=tw+tu-1;tx>tv+tg-1&&(tw=(tx=tv+tg-1)-tu+1),t.fillRect(tp+1,tw,tb-tp,tx-tw+1)}}}},t.prototype._calcBarWidth=function(t){var e,n;return Math.max(Math.floor(t),Math.floor((e=O(this._data).barSpacing,Math.floor(.3*e*(n=t)))))},t}(),Wn=function(t){function e(e,n){return t.call(this,e,n,!1)||this}return p(e,t),e.prototype._convertToCoordinates=function(t,e,n){e.indexesToCoordinates(this._items,j(this._itemsVisibleRange)),t.barPricesToCoordinates(this._items,n,j(this._itemsVisibleRange))},e.prototype._createDefaultItem=function(t,e,n){return{time:t,open:e.value[0],high:e.value[1],low:e.value[2],close:e.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},e.prototype._fillRawPoints=function(){var t=this,e=this._series.barColorer();this._items=this._series.bars().rows().map(function(n){return t._createRawItem(n.index,n,e)})},e}(Fn),jn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._renderer=new zn,e}return p(e,t),e.prototype.renderer=function(t,e){if(!this._series.visible())return null;var n=this._series.options();this._makeValid();var C={bars:this._items,barSpacing:this._model.timeScale().barSpacing(),openVisible:n.openVisible,thinBars:n.thinBars,visibleRange:this._itemsVisibleRange};return this._renderer.setData(C),this._renderer},e.prototype._updateOptions=function(){var t=this;this._items.forEach(function(e){e.color=t._series.barColorer().barStyle(e.time).barColor})},e.prototype._createRawItem=function(t,e,n){return f(f({},this._createDefaultItem(t,e,n)),{color:n.barStyle(t).barColor})},e}(Wn);!function(t){t[t.BarBorderWidth=1]="BarBorderWidth"}(Rn||(Rn={}));var Gn=function(){function t(){this._data=null,this._barWidth=0}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t,e,n,C){if(null!==this._data&&0!==this._data.bars.length&&null!==this._data.visibleRange){this._barWidth=(_=this._data.barSpacing,ts=e,_>=2.5&&_<=4?Math.floor(3*ts):Math.max(Math.floor(ts),Math.min(Math.floor(_*(1-.2*Math.atan(Math.max(4,_)-4)/(.5*Math.PI))*ts),Math.floor(_*ts)))),this._barWidth>=2&&Math.floor(e)%2!=this._barWidth%2&&this._barWidth--;var _,ts,ta=this._data.bars;this._data.wickVisible&&this._drawWicks(t,ta,this._data.visibleRange,e),this._data.borderVisible&&this._drawBorder(t,ta,this._data.visibleRange,this._data.barSpacing,e);var tl=this._calculateBorderWidth(e);(!this._data.borderVisible||this._barWidth>2*tl)&&this._drawCandles(t,ta,this._data.visibleRange,e)}},t.prototype._drawWicks=function(t,e,n,C){if(null!==this._data){var _="",ts=Math.min(Math.floor(C),Math.floor(this._data.barSpacing*C));ts=Math.max(Math.floor(C),Math.min(ts,this._barWidth));for(var ta=Math.floor(.5*ts),tl=null,th=n.from;th<n.to;th++){var tc=e[th];tc.wickColor!==_&&(t.fillStyle=tc.wickColor,_=tc.wickColor);var td=Math.round(Math.min(tc.openY,tc.closeY)*C),tu=Math.round(Math.max(tc.openY,tc.closeY)*C),tp=Math.round(tc.highY*C),t8=Math.round(tc.lowY*C),tf=Math.round(C*tc.x)-ta,tv=tf+ts-1;null!==tl&&(tf=Math.min(tf=Math.max(tl+1,tf),tv));var tg=tv-tf+1;t.fillRect(tf,tp,tg,td-tp),t.fillRect(tf,tu+1,tg,t8-tu),tl=tv}}},t.prototype._calculateBorderWidth=function(t){var e=Math.floor(1*t);this._barWidth<=2*e&&(e=Math.floor(.5*(this._barWidth-1)));var n=Math.max(Math.floor(t),e);return this._barWidth<=2*n?Math.max(Math.floor(t),Math.floor(1*t)):n},t.prototype._drawBorder=function(t,e,n,C,_){if(null!==this._data)for(var ts="",ta=this._calculateBorderWidth(_),tl=null,th=n.from;th<n.to;th++){var tc=e[th];tc.borderColor!==ts&&(t.fillStyle=tc.borderColor,ts=tc.borderColor);var td=Math.round(tc.x*_)-Math.floor(.5*this._barWidth),tu=td+this._barWidth-1,tp=Math.round(Math.min(tc.openY,tc.closeY)*_),t8=Math.round(Math.max(tc.openY,tc.closeY)*_);if(null!==tl&&(td=Math.min(td=Math.max(tl+1,td),tu)),this._data.barSpacing*_>2*ta)ge(t,td,tp,tu-td+1,t8-tp+1,ta);else{var tf=tu-td+1;t.fillRect(td,tp,tf,t8-tp+1)}tl=tu}},t.prototype._drawCandles=function(t,e,n,C){if(null!==this._data)for(var _="",ts=this._calculateBorderWidth(C),ta=n.from;ta<n.to;ta++){var tl=e[ta],th=Math.round(Math.min(tl.openY,tl.closeY)*C),tc=Math.round(Math.max(tl.openY,tl.closeY)*C),td=Math.round(tl.x*C)-Math.floor(.5*this._barWidth),tu=td+this._barWidth-1;if(tl.color!==_){var tp=tl.color;t.fillStyle=tp,_=tp}this._data.borderVisible&&(td+=ts,th+=ts,tu-=ts,tc-=ts),th>tc||t.fillRect(td,th,tu-td+1,tc-th+1)}},t}(),Un=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._renderer=new Gn,e}return p(e,t),e.prototype.renderer=function(t,e){if(!this._series.visible())return null;var n=this._series.options();this._makeValid();var C={bars:this._items,barSpacing:this._model.timeScale().barSpacing(),wickVisible:n.wickVisible,borderVisible:n.borderVisible,visibleRange:this._itemsVisibleRange};return this._renderer.setData(C),this._renderer},e.prototype._updateOptions=function(){var t=this;this._items.forEach(function(e){var n=t._series.barColorer().barStyle(e.time);e.color=n.barColor,e.wickColor=n.barWickColor,e.borderColor=n.barBorderColor})},e.prototype._createRawItem=function(t,e,n){var C=n.barStyle(t);return f(f({},this._createDefaultItem(t,e,n)),{color:C.barColor,wickColor:C.barWickColor,borderColor:C.barBorderColor})},e}(Wn),Zn=function(){function t(){this._data=null,this._precalculatedCache=[]}return t.prototype.setData=function(t){this._data=t,this._precalculatedCache=[]},t.prototype.draw=function(t,e,n,C){if(null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange){this._precalculatedCache.length||this._fillPrecalculatedCache(e);for(var _=Math.max(1,Math.floor(e)),ts=Math.round(this._data.histogramBase*e)-Math.floor(_/2),ta=ts+_,tl=this._data.visibleRange.from;tl<this._data.visibleRange.to;tl++){var th=this._data.items[tl],tc=this._precalculatedCache[tl-this._data.visibleRange.from],td=Math.round(th.y*e);t.fillStyle=th.color;var tu=void 0,tp=void 0;td<=ts?(tu=td,tp=ta):(tu=ts,tp=td-Math.floor(_/2)+_),t.fillRect(tc.left,tu,tc.right-tc.left+1,tp-tu)}}},t.prototype._fillPrecalculatedCache=function(t){if(null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange){var e=1>=Math.ceil(this._data.barSpacing*t)?0:Math.max(1,Math.floor(t)),n=Math.round(this._data.barSpacing*t)-e;this._precalculatedCache=Array(this._data.visibleRange.to-this._data.visibleRange.from);for(var C=this._data.visibleRange.from;C<this._data.visibleRange.to;C++){var _,ts=this._data.items[C],ta=Math.round(ts.x*t),tl=void 0,th=void 0;n%2?(tl=ta-(_=(n-1)/2),th=ta+_):(tl=ta-(_=n/2),th=ta+_-1),this._precalculatedCache[C-this._data.visibleRange.from]={left:tl,right:th,roundedCenter:ta,center:ts.x*t,time:ts.time}}for(C=this._data.visibleRange.from+1;C<this._data.visibleRange.to;C++){var tc=this._precalculatedCache[C-this._data.visibleRange.from],td=this._precalculatedCache[C-this._data.visibleRange.from-1];tc.time===td.time+1&&tc.left-td.right!==e+1&&(td.roundedCenter>td.center?td.right=tc.left-e-1:tc.left=td.right+e+1)}var tu=Math.ceil(this._data.barSpacing*t);for(C=this._data.visibleRange.from;C<this._data.visibleRange.to;C++){(tc=this._precalculatedCache[C-this._data.visibleRange.from]).right<tc.left&&(tc.right=tc.left);var tp=tc.right-tc.left+1;tu=Math.min(tp,tu)}if(e>0&&tu<4)for(C=this._data.visibleRange.from;C<this._data.visibleRange.to;C++)(tp=(tc=this._precalculatedCache[C-this._data.visibleRange.from]).right-tc.left+1)>tu&&(tc.roundedCenter>tc.center?tc.right-=1:tc.left+=1)}else this._precalculatedCache=[]},t}();function qn(t){return{items:[],barSpacing:t,histogramBase:NaN,visibleRange:null}}function Kn(t,e,n){return{time:t,price:e,x:NaN,y:NaN,color:n}}var Yn,Xn=function(t){function e(e,n){var C=t.call(this,e,n,!1)||this;return C._compositeRenderer=new U,C._histogramData=qn(0),C._renderer=new Zn,C}return p(e,t),e.prototype.renderer=function(t,e){return this._series.visible()?(this._makeValid(),this._compositeRenderer):null},e.prototype._fillRawPoints=function(){var t,e,n=this._model.timeScale().barSpacing();this._histogramData=qn(n);var C=0,_=0,ts=this._series.options().color;try{for(var ta=g(this._series.bars().rows()),tl=ta.next();!tl.done;tl=ta.next()){var th=tl.value,tc=th.value[3],td=void 0!==th.color?th.color:ts,tu=Kn(th.index,tc,td);++C<this._histogramData.items.length?this._histogramData.items[C]=tu:this._histogramData.items.push(tu),this._items[_++]={time:th.index,x:0}}}catch(tp){t={error:tp}}finally{try{tl&&!tl.done&&(e=ta.return)&&e.call(ta)}finally{if(t)throw t.error}}this._renderer.setData(this._histogramData),this._compositeRenderer.setRenderers([this._renderer])},e.prototype._updateOptions=function(){},e.prototype._clearVisibleRange=function(){t.prototype._clearVisibleRange.call(this),this._histogramData.visibleRange=null},e.prototype._convertToCoordinates=function(t,e,n){if(null!==this._itemsVisibleRange){var C=e.barSpacing(),_=O(e.visibleStrictRange()),ts=t.priceToCoordinate(this._series.options().base,n);e.indexesToCoordinates(this._histogramData.items),t.pointsArrayToCoordinates(this._histogramData.items,n),this._histogramData.histogramBase=ts,this._histogramData.visibleRange=Ln(this._histogramData.items,_,!1),this._histogramData.barSpacing=C,this._renderer.setData(this._histogramData)}},e}(Fn),$n=function(t){function e(e,n){var C=t.call(this,e,n)||this;return C._lineRenderer=new Nn,C}return p(e,t),e.prototype.renderer=function(t,e){if(!this._series.visible())return null;var n=this._series.options();this._makeValid();var C={items:this._items,lineColor:n.color,lineStyle:n.lineStyle,lineType:n.lineType,lineWidth:n.lineWidth,visibleRange:this._itemsVisibleRange,barWidth:this._model.timeScale().barSpacing()};return this._lineRenderer.setData(C),this._lineRenderer},e.prototype._createRawItem=function(t,e){return this._createRawItemBase(t,e)},e}(Bn),Jn=/[2-9]/g,Qn=function(){function t(t){void 0===t&&(t=50),this._cache=new Map,this._keysIndex=0,this._keys=Array.from(Array(t))}return t.prototype.reset=function(){this._cache.clear(),this._keys.fill(void 0)},t.prototype.measureText=function(t,e,n){var C=String(e).replace(n||Jn,"0"),_=this._cache.get(C);if(void 0===_){if(0===(_=t.measureText(C).width)&&0!==e.length)return 0;var ts=this._keys[this._keysIndex];void 0!==ts&&this._cache.delete(ts),this._keys[this._keysIndex]=C,this._keysIndex=(this._keysIndex+1)%this._keys.length,this._cache.set(C,_)}return _},t}(),er=function(){function t(t){this._priceAxisViewRenderer=null,this._rendererOptions=null,this._align="right",this._pixelRatio=1,this._width=0,this._coords=[],this._textWidthCache=t}return t.prototype.setParams=function(t,e,n,C){this._priceAxisViewRenderer=t,this._rendererOptions=e,this._width=n,this._align=C},t.prototype.draw=function(t,e){this._pixelRatio=e,null!==this._rendererOptions&&null!==this._priceAxisViewRenderer&&(this._coords=this._priceAxisViewRenderer.draw(t,this._rendererOptions,this._textWidthCache,this._width,this._align,e))},t.prototype.hitTest=function(t,e){var n,C,_,ts=t*this._pixelRatio,ta=e*this._pixelRatio;if(!(null===(_=this._coords)||void 0===_?void 0:_.length))return null;try{for(var tl=g(this._coords),th=tl.next();!th.done;th=tl.next()){var tc=th.value,td=tc.left,tu=tc.right,tp=tc.top,t8=tc.bottom,tf=tc.externalId;if(ts>=td&&ts<=tu&&ta<=t8&&ta>=tp)return{externalId:tf,internalType:"priceLineLabel"}}}catch(tv){n={error:tv}}finally{try{th&&!th.done&&(C=tl.return)&&C.call(tl)}finally{if(n)throw n.error}}return null},t}(),tr=function(){function t(t,e,n){this._priceAxisView=t,this._textWidthCache=new Qn(50),this._dataSource=e,this._chartModel=n,this._fontSize=-1,this._renderer=new er(this._textWidthCache)}return t.prototype.renderer=function(t,e){var n=this._chartModel.paneForSource(this._dataSource);if(null===n)return null;var C=n.isOverlay(this._dataSource)?n.defaultPriceScale():this._dataSource.priceScale();if(null===C)return null;var _=n.priceScalePosition(C);if("overlay"===_)return null;var ts=this._chartModel.priceAxisRendererOptions();return ts.fontSize!==this._fontSize&&(this._fontSize=ts.fontSize,this._textWidthCache.reset()),this._renderer.setParams(this._priceAxisView.paneRenderer(),ts,e,_),this._renderer},t}(),nr=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t,e,n,C){if(null!==this._data&&!1!==this._data.visible){var _=Math.round(this._data.y*e);if(!(_<0||_>Math.ceil(this._data.height*e))){var ts=Math.ceil(this._data.width*e);t.lineCap="butt",t.strokeStyle=this._data.color,t.lineWidth=Math.floor(this._data.lineWidth*e),k(t,this._data.lineStyle),T(t,_,0,ts)}}},t}(),rr=function(){function t(t){this._lineRendererData={width:0,height:0,y:0,color:"rgba(0, 0, 0, 0)",lineWidth:1,lineStyle:0,visible:!1},this._lineRenderer=new nr,this._invalidated=!0,this._series=t,this._model=t.model(),this._lineRenderer.setData(this._lineRendererData)}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(t,e){return this._series.visible()?(this._invalidated&&(this._updateImpl(t,e),this._invalidated=!1),this._lineRenderer):null},t}(),ir=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e.prototype._updateImpl=function(t,e){this._lineRendererData.visible=!1;var n=this._series.priceScale(),C=n.mode().mode;if(2===C||3===C){var _=this._series.options();if(_.baseLineVisible&&this._series.visible()){var ts=this._series.firstValue();null!==ts&&(this._lineRendererData.visible=!0,this._lineRendererData.y=n.priceToCoordinate(ts.value,ts.value),this._lineRendererData.width=e,this._lineRendererData.height=t,this._lineRendererData.color=_.baseLineColor,this._lineRendererData.lineWidth=_.baseLineWidth,this._lineRendererData.lineStyle=_.baseLineStyle)}}},e}(rr),or=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.data=function(){return this._data},t.prototype.draw=function(t,e,n,C){var _=this._data;if(null!==_){t.save();var ts=Math.max(1,Math.floor(e)),ta=Math.round(_.center.x*e)+ts%2/2,tl=_.center.y*e;t.fillStyle=_.seriesLineColor,t.beginPath();var th=Math.max(2,1.5*_.seriesLineWidth)*e;t.arc(ta,tl,th,0,2*Math.PI,!1),t.fill(),t.fillStyle=_.fillColor,t.beginPath(),t.arc(ta,tl,_.radius*e,0,2*Math.PI,!1),t.fill(),t.lineWidth=ts,t.strokeStyle=_.strokeColor,t.beginPath(),t.arc(ta,tl,_.radius*e+ts/2,0,2*Math.PI,!1),t.stroke(),t.restore()}},t}();!function(t){t[t.AnimationPeriod=2600]="AnimationPeriod",t[t.Stage1Period=.25]="Stage1Period",t[t.Stage2Period=.275]="Stage2Period",t[t.Stage3Period=.475]="Stage3Period",t[t.Stage1StartCircleRadius=4]="Stage1StartCircleRadius",t[t.Stage1EndCircleRadius=10]="Stage1EndCircleRadius",t[t.Stage1StartFillAlpha=.25]="Stage1StartFillAlpha",t[t.Stage1EndFillAlpha=0]="Stage1EndFillAlpha",t[t.Stage1StartStrokeAlpha=.4]="Stage1StartStrokeAlpha",t[t.Stage1EndStrokeAlpha=.8]="Stage1EndStrokeAlpha",t[t.Stage2StartCircleRadius=10]="Stage2StartCircleRadius",t[t.Stage2EndCircleRadius=14]="Stage2EndCircleRadius",t[t.Stage2StartFillAlpha=0]="Stage2StartFillAlpha",t[t.Stage2EndFillAlpha=0]="Stage2EndFillAlpha",t[t.Stage2StartStrokeAlpha=.8]="Stage2StartStrokeAlpha",t[t.Stage2EndStrokeAlpha=0]="Stage2EndStrokeAlpha",t[t.Stage3StartCircleRadius=14]="Stage3StartCircleRadius",t[t.Stage3EndCircleRadius=14]="Stage3EndCircleRadius",t[t.Stage3StartFillAlpha=0]="Stage3StartFillAlpha",t[t.Stage3EndFillAlpha=0]="Stage3EndFillAlpha",t[t.Stage3StartStrokeAlpha=0]="Stage3StartStrokeAlpha",t[t.Stage3EndStrokeAlpha=0]="Stage3EndStrokeAlpha"}(Yn||(Yn={}));var ar=[{start:0,end:.25,startRadius:4,endRadius:10,startFillAlpha:.25,endFillAlpha:0,startStrokeAlpha:.4,endStrokeAlpha:.8},{start:.25,end:.525,startRadius:10,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:.8,endStrokeAlpha:0},{start:.525,end:1,startRadius:14,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:0,endStrokeAlpha:0}];function sr(t,e,n,C){return function(t,e){if("transparent"===t)return t;var n=ue(t),C=n[3];return"rgba("+n[0]+", "+n[1]+", "+n[2]+", "+e*C+")"}(t,n+(C-n)*e)}function lr(t,e){var n,C,_,ts=t%2600/2600;try{for(var ta=g(ar),tl=ta.next();!tl.done;tl=ta.next()){var th=tl.value;if(ts>=th.start&&ts<=th.end){_=th;break}}}catch(tc){n={error:tc}}finally{try{tl&&!tl.done&&(C=ta.return)&&C.call(ta)}finally{if(n)throw n.error}}N(void 0!==_,"Last price animation internal logic error");var td,tu,tp,t8=(ts-_.start)/(_.end-_.start);return{fillColor:sr(e,t8,_.startFillAlpha,_.endFillAlpha),strokeColor:sr(e,t8,_.startStrokeAlpha,_.endStrokeAlpha),radius:(td=t8,(tu=_.startRadius)+((tp=_.endRadius)-tu)*td)}}var cr,ur=function(){function t(t){this._renderer=new or,this._invalidated=!0,this._stageInvalidated=!0,this._startTime=performance.now(),this._endTime=this._startTime-1,this._series=t}return t.prototype.update=function(t){if(this._invalidated=!0,"data"===t&&2===this._series.options().lastPriceAnimation){var e=performance.now(),n=this._endTime-e;if(n>0)return void(n<650&&(this._endTime+=2600));this._startTime=e,this._endTime=e+2600}},t.prototype.invalidateStage=function(){this._stageInvalidated=!0},t.prototype.visible=function(){return 0!==this._series.options().lastPriceAnimation},t.prototype.animationActive=function(){switch(this._series.options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this._endTime}},t.prototype.renderer=function(t,e){return this._invalidated?(this._updateImpl(t,e),this._invalidated=!1,this._stageInvalidated=!1):this._stageInvalidated&&(this._updateRendererDataStage(),this._stageInvalidated=!1),this._renderer},t.prototype._updateImpl=function(t,e){this._renderer.setData(null);var n=this._series.model().timeScale(),C=n.visibleStrictRange(),_=this._series.firstValue();if(null!==C&&null!==_){var ts=this._series.lastValueData(!0,!0);if(C.contains(ts.index)){var ta={x:n.indexToCoordinate(ts.index),y:this._series.priceScale().priceToCoordinate(ts.price,_.value)},tl=ts.color,th=this._series.options().lineWidth,tc=lr(this._duration(),tl);this._renderer.setData({seriesLineColor:tl,seriesLineWidth:th,fillColor:tc.fillColor,strokeColor:tc.strokeColor,radius:tc.radius,center:ta})}}},t.prototype._updateRendererDataStage=function(){var t=this._renderer.data();if(null!==t){var e=lr(this._duration(),t.seriesLineColor);t.fillColor=e.fillColor,t.strokeColor=e.strokeColor,t.radius=e.radius}},t.prototype._duration=function(){return this.animationActive()?performance.now()-this._startTime:2599},t}();function dr(t,e){return Ve(Math.min(Math.max(t,12),30)*e)}function hr(t,e){switch(t){case"arrowDown":case"arrowUp":return dr(e,1);case"circle":return dr(e,.8);case"square":return dr(e,.7)}}function pr(t){return Be(dr(t,1))}function fr(t){return Math.max(dr(t,.1),3)}function mr(t,e,n,C,_){var ts=hr("square",n),ta=(ts-1)/2,tl=t-ta,th=e-ta;return C>=tl&&C<=tl+ts&&_>=th&&_<=th+ts}function gr(t,e,n,C,_){var ts=(hr("arrowUp",_)-1)/2,ta=(Ve(_/2)-1)/2;e.beginPath(),t?(e.moveTo(n-ts,C),e.lineTo(n,C-ts),e.lineTo(n+ts,C),e.lineTo(n+ta,C),e.lineTo(n+ta,C+ts),e.lineTo(n-ta,C+ts),e.lineTo(n-ta,C)):(e.moveTo(n-ts,C),e.lineTo(n,C+ts),e.lineTo(n+ts,C),e.lineTo(n+ta,C),e.lineTo(n+ta,C-ts),e.lineTo(n-ta,C-ts),e.lineTo(n-ta,C)),e.fill()}!function(t){t[t.MinShapeSize=12]="MinShapeSize",t[t.MaxShapeSize=30]="MaxShapeSize",t[t.MinShapeMargin=3]="MinShapeMargin"}(cr||(cr={}));var vr,yr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._data=null,e._textWidthCache=new Qn,e._fontSize=-1,e._fontFamily="",e._font="",e}return p(e,t),e.prototype.setData=function(t){this._data=t},e.prototype.setParams=function(t,e){this._fontSize===t&&this._fontFamily===e||(this._fontSize=t,this._fontFamily=e,this._font=wn(t,e),this._textWidthCache.reset())},e.prototype.hitTest=function(t,e){if(null===this._data||null===this._data.visibleRange)return null;for(var n=this._data.visibleRange.from;n<this._data.visibleRange.to;n++){var C=this._data.items[n];if(Cr(C,t,e))return{hitTestData:C.internalId,externalId:C.externalId,internalType:"serieMarker"}}return null},e.prototype._drawImpl=function(t,e,n){if(null!==this._data&&null!==this._data.visibleRange){t.textBaseline="middle",t.font=this._font;for(var C=this._data.visibleRange.from;C<this._data.visibleRange.to;C++){var _=this._data.items[C];void 0!==_.text&&(_.text.width=this._textWidthCache.measureText(t,_.text.content),_.text.height=this._fontSize),_r(_,t)}}},e}(Z);function _r(t,e){e.fillStyle=t.color,void 0!==t.text&&function(t,e,n,C){t.fillText(e,n,C)}(e,t.text.content,t.x-t.text.width/2,t.y+t.text.height/15),function(t,e){if(0!==t.size){switch(t.shape){case"arrowDown":return void gr(!1,e,t.x,t.y,t.size);case"arrowUp":return void gr(!0,e,t.x,t.y,t.size);case"circle":var n,C,_,ts,ta;return void(n=e,C=t.x,_=t.y,ta=(hr("circle",ts=t.size)-1)/2,void(n.beginPath(),n.arc(C,_,ta,0,2*Math.PI,!1),n.strokeStyle=he(n.fillStyle,.4),n.fillStyle=he(n.fillStyle,.15),n.stroke(),n.arc(C,_,ta+1.5,0,2*Math.PI,!1),n.fill()));case"square":return void function(t,e,n,C){var _=hr("square",C),ts=(_-1)/2;t.fillRect(e-ts,n-ts,_,_)}(e,t.x,t.y,t.size)}t.shape}}(t,e)}function Cr(t,e,n){var C,_,ts,ta,tl,th,tc;return!(void 0===t.text||(C=t.x,_=t.y+t.text.height/15,ts=t.text.width,ta=t.text.height,tl=e,th=n,tc=ta/2,!(tl>=C)||!(tl<=C+ts)||!(th>=_-tc)||!(th<=_+tc)))||function(t,e,n){if(0===t.size)return!1;switch(t.shape){case"arrowDown":case"arrowUp":var C,_,ts,ta,tl,th,tc,td,tu,tp,t8,tf,tv;return tu=t.x,tp=t.y,t8=t.size,tf=e,mr(tu,tp,t8,tf,tv=n);case"circle":return C=t.x,_=t.y,ts=t.size,ta=e,tl=n,th=2+hr("circle",ts)/2,tc=C-ta,Math.sqrt(tc*tc+(td=_-tl)*td)<=th;case"square":return mr(t.x,t.y,t.size,e,n)}t.shape}(t,e,n)}function br(t,e,n,C,_,ts,ta,tl,th,tc){var td=R(n)?n:n.close,tu=R(n)?n:n.high,tp=R(n)?n:n.low,t8=R(e.size)?Math.max(e.size,0):1,tf=pr(tl.barSpacing())*t8,tv=tf/2;switch(t.size=tf,e.position){case"inBar":return t.y=ta.priceToCoordinate(td,th),void(void 0!==t.text&&(t.text.y=t.y+tv+ts+.6*_));case"aboveBar":return t.y=ta.priceToCoordinate(tu,th)-tv-C.aboveBar,void 0!==t.text&&(t.text.y=t.y-tv-.6*_,C.aboveBar+=1.2*_),void(C.aboveBar+=tf/4+ts);case"belowBar":return t.y=ta.priceToCoordinate(tp,th)+tv+C.belowBar,void 0!==t.text&&(t.text.y=t.y+tv+ts+.6*_,C.belowBar+=1.2*_),void(C.belowBar+=tf/4+ts);case"bottom":return t.y=tc-tv,void(void 0!==t.text&&(t.text.y=t.y-tv-.6*_))}e.position}!function(t){t[t.TextMargin=.1]="TextMargin"}(vr||(vr={}));var wr,xr=function(){function t(t,e){this._invalidated=!0,this._dataInvalidated=!0,this._autoScaleMarginsInvalidated=!0,this._autoScaleMargins=null,this._renderer=new yr,this._series=t,this._model=e,this._data={items:[],visibleRange:null}}return t.prototype.update=function(t){this._invalidated=!0,this._autoScaleMarginsInvalidated=!0,"data"===t&&(this._dataInvalidated=!0)},t.prototype.renderer=function(t,e,n,C){if(!this._series.visible())return null;this._invalidated&&this._makeValid(t);var _=this._model.options().layout;return this._renderer.setParams(_.markersFontSize,_.fontFamily),this._renderer.setData(this._data),this._renderer},t.prototype.autoScaleMargins=function(){if(this._autoScaleMarginsInvalidated){if(this._series.indexedMarkers().length>0){var t=this._model.timeScale().barSpacing(),e=fr(t),n=pr(t)+2*e;this._autoScaleMargins={above:n,below:n}}else this._autoScaleMargins=null;this._autoScaleMarginsInvalidated=!1}return this._autoScaleMargins},t.prototype._makeValid=function(t){var e=this._series.priceScale(),n=this._model.timeScale(),C=this._series.indexedMarkers();this._dataInvalidated&&(this._data.items=C.map(function(t){return{time:t.time,x:0,y:0,size:0,shape:t.shape,color:t.color,internalId:t.internalId,externalId:t.id,text:void 0}}),this._dataInvalidated=!1);var _=this._model.options().layout;this._data.visibleRange=null;var ts=n.visibleStrictRange();if(null!==ts){var ta=this._series.firstValue();if(null!==ta&&0!==this._data.items.length){var tl=NaN,th=fr(n.barSpacing()),tc={aboveBar:th,belowBar:th};this._data.visibleRange=Ln(this._data.items,ts,!0);for(var td=this._data.visibleRange.from;td<this._data.visibleRange.to;td++){var tu=C[td];tu.time!==tl&&(tc.aboveBar=th,tc.belowBar=th,tl=tu.time);var tp=this._data.items[td];tp.x=n.indexToCoordinate(tu.time),void 0!==tu.text&&tu.text.length>0&&(tp.text={content:tu.text,y:0,width:0,height:0});var t8=this._series.dataAt(tu.time);null!==t8&&br(tp,tu,t8,tc,_.fontSize,th,e,n,ta.value,t)}this._invalidated=!1}}},t}(),Sr=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e.prototype._updateImpl=function(t,e){var n=this._lineRendererData;n.visible=!1;var C=this._series.options();if(C.priceLineVisible&&this._series.visible()){var _=this._series.lastValueData(0===C.priceLineSource);_.noData||(n.visible=!0,n.y=_.coordinate,n.color=this._series.priceLineColor(_.color),n.width=e,n.height=t,n.lineWidth=C.priceLineWidth,n.lineStyle=C.priceLineStyle)}},e}(rr),Er=function(t){function e(e){var n=t.call(this)||this;return n._source=e,n}return p(e,t),e.prototype._updateRendererData=function(t,e,n){t.visible=!1,e.visible=!1;var C=this._source;if(C.visible()){var _=C.options(),ts=_.lastValueVisible,ta=""!==C.title(),tl=0===_.seriesLastValueMode,th=C.lastValueData(!1);if(!th.noData){ts&&(t.text=this._axisText(th,ts,tl),t.visible=0!==t.text.length),(ta||tl)&&(e.text=this._paneText(th,ts,ta,tl),e.visible=e.text.length>0);var tc=C.priceLineColor(th.color),td=de(tc);n.background=td.background,n.color=td.foreground,n.coordinate=th.coordinate,e.borderColor=C.model().backgroundColorAtYPercentFromTop(th.coordinate/C.priceScale().height()),t.borderColor=tc}}},e.prototype._paneText=function(t,e,n,C){var _="",ts=this._source.title();return n&&0!==ts.length&&(_+=ts+" "),e&&C&&(_+=this._source.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),_.trim()},e.prototype._axisText=function(t,e,n){return e?n?this._source.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},e}(xe),Mr=function(){function t(t,e){this._priceRange=t,this._margins=e||null}return t.prototype.priceRange=function(){return this._priceRange},t.prototype.margins=function(){return this._margins},t.prototype.toRaw=function(){return null===this._priceRange?null:{priceRange:this._priceRange.toRaw(),margins:this._margins||void 0}},t.fromRaw=function(e){return null===e?null:new t(Ae.fromRaw(e.priceRange),e.margins)},t}(),kr=function(t){function e(e,n){var C=t.call(this,e)||this;return C._priceLine=n,C}return p(e,t),e.prototype._updateImpl=function(t,e){var n=this._lineRendererData;if(n.visible=!1,this._series.visible()){var C=this._priceLine.yCoord();if(null!==C){var _=this._priceLine.options();n.visible=!0,n.y=C,n.color=_.color,n.width=e,n.height=t,n.lineWidth=_.lineWidth,n.lineStyle=_.lineStyle}}},e}(rr),Tr=function(t){function e(e,n){var C=t.call(this)||this;return C._series=e,C._priceLine=n,C}return p(e,t),e.prototype._updateRendererData=function(t,e,n){t.visible=!1,e.visible=!1;var C=this._priceLine.options(),_=C.axisLabelVisible,ts=""!==C.title;if(_&&this._series.visible()){var ta=this._priceLine.yCoord();if(null!==ta){ts&&(e.text=C.title,e.externalId=C.titleLabelId,e.visible=!0,e.edgeMargin=C.edgeMargin),C.withCancel&&(e.withCancel=C.withCancel,e.cancelExternalId=C.cancelId),C.icon&&(e.icon=C.icon),e.borderColor=this._series.model().backgroundColorAtYPercentFromTop(ta/this._series.priceScale().height()),t.text=this._series.priceScale().formatPriceAbsolute(C.price),t.visible=!0,t.fullWidth=!0;var tl=de(C.color);n.background=tl.background,n.color=tl.foreground,n.coordinate=ta}}},e}(xe),Ir=function(){function t(t,e){this._series=t,this._options=e,this._priceLineView=new kr(t,this),this._priceAxisView=new Tr(t,this),this._panePriceAxisView=new tr(this._priceAxisView,t,t.model())}return t.prototype.applyOptions=function(t){L(this._options,t),this.update(),this._series.model().lightUpdate()},t.prototype.options=function(){return this._options},t.prototype.paneViews=function(){return[this._priceLineView,this._panePriceAxisView]},t.prototype.priceAxisView=function(){return this._priceAxisView},t.prototype.update=function(){this._priceLineView.update(),this._priceAxisView.update()},t.prototype.yCoord=function(){var t=this._series,e=t.priceScale();if(t.model().timeScale().isEmpty()||e.isEmpty())return null;var n=t.firstValue();return null===n?null:e.priceToCoordinate(this._options.price,n.value)},t}(),Hr=function(t){function e(e){var n=t.call(this)||this;return n._model=e,n}return p(e,t),e.prototype.model=function(){return this._model},e}(Te),Nr={barColor:"",barBorderColor:"",barWickColor:""},Pr=function(){function t(t){this._series=t}return t.prototype.barStyle=function(t,e){var n=this._series.seriesType(),C=this._series.options();switch(n){case"Line":return this._lineStyle(C);case"Area":return this._areaStyle(C);case"Bar":return this._barStyle(C,t,e);case"Candlestick":return this._candleStyle(C,t,e);case"Histogram":return this._histogramStyle(C,t,e)}throw new S("Unknown chart style")},t.prototype._barStyle=function(t,e,n){var C=f({},Nr),_=t.upColor,ts=t.downColor,ta=O(this._findBar(e,n)),tl=D(ta.value[0])<=D(ta.value[3]);return C.barColor=tl?_:ts,C.barBorderColor=tl?_:ts,C},t.prototype._candleStyle=function(t,e,n){var C=f({},Nr),_=t.upColor,ts=t.downColor,ta=t.borderUpColor,tl=t.borderDownColor,th=t.wickUpColor,tc=t.wickDownColor,td=O(this._findBar(e,n)),tu=D(td.value[0])<=D(td.value[3]);return C.barColor=tu?_:ts,C.barBorderColor=tu?ta:tl,C.barWickColor=tu?th:tc,C},t.prototype._areaStyle=function(t){return f(f({},Nr),{barColor:t.lineColor})},t.prototype._lineStyle=function(t){return f(f({},Nr),{barColor:t.color})},t.prototype._histogramStyle=function(t,e,n){var C=f({},Nr),_=O(this._findBar(e,n));return C.barColor=void 0!==_.color?_.color:t.color,C},t.prototype._findBar=function(t,e){return void 0!==e?e.value:this._series.bars().valueAt(t)},t}();!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.Exact=0]="Exact",t[t.NearestRight=1]="NearestRight"}(wr||(wr={}));var Or=function(){function t(){this._items=[],this._minMaxCache=new Map,this._rowSearchCache=new Map}return t.prototype.clear=function(){this._items=[],this._minMaxCache.clear(),this._rowSearchCache.clear()},t.prototype.last=function(){return this.size()>0?this._items[this._items.length-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this._indexAt(0):null},t.prototype.lastIndex=function(){return this.size()>0?this._indexAt(this._items.length-1):null},t.prototype.size=function(){return this._items.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this._search(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.search=function(t,e){void 0===e&&(e=0);var n=this._search(t,e);return null===n?null:f(f({},this._valueAt(n)),{index:this._indexAt(n)})},t.prototype.rows=function(){return this._items},t.prototype.minMaxOnRangeCached=function(t,e,n){if(this.isEmpty())return null;var C,_,ts=null;try{for(var ta=g(n),tl=ta.next();!tl.done;tl=ta.next()){var th=tl.value;ts=Dr(ts,this._minMaxOnRangeCachedImpl(t,e,th))}}catch(tc){C={error:tc}}finally{try{tl&&!tl.done&&(_=ta.return)&&_.call(ta)}finally{if(C)throw C.error}}return ts},t.prototype.merge=function(t){0!==t.length&&(this.isEmpty()||t[t.length-1].index<this._items[0].index?this._prepend(t):t[0].index>this._items[this._items.length-1].index?this._append(t):1!==t.length||t[0].index!==this._items[this._items.length-1].index?this._merge(t):this._updateLast(t[0]))},t.prototype._indexAt=function(t){return this._items[t].index},t.prototype._valueAt=function(t){return this._items[t]},t.prototype._search=function(t,e){var n=this._bsearch(t);if(null===n&&0!==e)switch(e){case -1:return this._searchNearestLeft(t);case 1:return this._searchNearestRight(t);default:throw TypeError("Unknown search mode")}return n},t.prototype._searchNearestLeft=function(t){var e=this._lowerbound(t);return e>0&&(e-=1),e!==this._items.length&&this._indexAt(e)<t?e:null},t.prototype._searchNearestRight=function(t){var e=this._upperbound(t);return e!==this._items.length&&t<this._indexAt(e)?e:null},t.prototype._bsearch=function(t){var e=this._lowerbound(t);return e===this._items.length||t<this._items[e].index?null:e},t.prototype._lowerbound=function(t){return Pn(this._items,t,function(t,e){return t.index<e})},t.prototype._upperbound=function(t){return On(this._items,t,function(t,e){return e.index>t})},t.prototype._plotMinMax=function(t,e,n){for(var C=null,_=t;_<e;_++){var ts=this._items[_].value[n];Number.isNaN(ts)||(null===C?C={min:ts,max:ts}:(ts<C.min&&(C.min=ts),ts>C.max&&(C.max=ts)))}return C},t.prototype._invalidateCacheForRow=function(t){var e=Math.floor(t.index/30);this._minMaxCache.forEach(function(t){return t.delete(e)})},t.prototype._prepend=function(t){N(0!==t.length,"plotRows should not be empty"),this._rowSearchCache.clear(),this._minMaxCache.clear(),this._items=t.concat(this._items)},t.prototype._append=function(t){N(0!==t.length,"plotRows should not be empty"),this._rowSearchCache.clear(),this._minMaxCache.clear(),this._items=this._items.concat(t)},t.prototype._updateLast=function(t){N(!this.isEmpty(),"plot list should not be empty"),N(this._items[this._items.length-1].index===t.index,"last row index should match new row index"),this._invalidateCacheForRow(t),this._rowSearchCache.delete(t.index),this._items[this._items.length-1]=t},t.prototype._merge=function(t){N(0!==t.length,"plot rows should not be empty"),this._rowSearchCache.clear(),this._minMaxCache.clear(),this._items=function(t,e){for(var n=function(t,e){for(var n=t.length,C=e.length,_=n+C,ts=0,ta=0;ts<n&&ta<C;)t[ts].index<e[ta].index?ts++:t[ts].index>e[ta].index?ta++:(ts++,ta++,_--);return _}(t,e),C=Array(n),_=0,ts=0,ta=t.length,tl=e.length,th=0;_<ta&&ts<tl;)t[_].index<e[ts].index?(C[th]=t[_],_++):t[_].index>e[ts].index?(C[th]=e[ts],ts++):(C[th]=e[ts],_++,ts++),th++;for(;_<ta;)C[th]=t[_],_++,th++;for(;ts<tl;)C[th]=e[ts],ts++,th++;return C}(this._items,t)},t.prototype._minMaxOnRangeCachedImpl=function(t,e,n){if(this.isEmpty())return null;var C=null,_=O(this.firstIndex()),ts=O(this.lastIndex()),ta=Math.max(t,_),tl=Math.min(e,ts),th=30*Math.ceil(ta/30),tc=Math.max(th,30*Math.floor(tl/30)),td=this._lowerbound(ta),tu=this._upperbound(Math.min(tl,th,e));C=Dr(C,this._plotMinMax(td,tu,n));var tp=this._minMaxCache.get(n);void 0===tp&&(tp=new Map,this._minMaxCache.set(n,tp));for(var t8=Math.max(th+1,ta);t8<tc;t8+=30){var tf=Math.floor(t8/30),tv=tp.get(tf);if(void 0===tv){var tg=this._lowerbound(30*tf),tm=this._upperbound(30*(tf+1)-1);tv=this._plotMinMax(tg,tm,n),tp.set(tf,tv)}C=Dr(C,tv)}return td=this._lowerbound(tc),tu=this._upperbound(tl),Dr(C,this._plotMinMax(td,tu,n))},t}();function Dr(t,e){return null===t?e:null===e?t:{min:Math.min(t.min,e.min),max:Math.max(t.max,e.max)}}function Ar(t,e,n){if(t.length<e)return[];for(var C=[],_=0,ts=0;ts<e-1;ts++)_+=t[ts].value;var ta={time:e-2,price:_/e,x:NaN,y:NaN};for(ts=e-1;ts<t.length;ts++){var tl=Lr({index:ts,checkIndex:!1,prevPoint:ta,inputPoints:t,length:e,multiplier:n});tl&&(C.push(tl),ta=tl)}return C}function Lr(t){var e=t.checkIndex,n=t.prevPoint,C=t.index,_=t.inputPoints,ts=t.length,ta=t.multiplier;if(!e||C>=ts-1&&C<_.length){var tl=_[C],th=null==n?void 0:n.price;if(void 0!==th){var tc=tl.value*ta+th*(1-ta);return{time:tl.index,price:tc,x:NaN,y:NaN}}}}function Rr(t,e){return e?t[t.length-2]:t[t.length-1]}function Fr(t){return{index:t.index,value:t.value[3]}}function Br(t){return t.map(Fr)}function Vr(t){return 2/(t+1)}function zr(t){return 1/t}function Wr(t,e){var n=0===e.price?100:100-100/(1+t.price/e.price);return f(f({},t),{price:n})}function jr(t,e){var n=t[e],C=t[e-1],_=0,ts=0;if(!n||!C)return null;var ta=n.value[3],tl=C.value[3];return ta>tl?_=ta-tl:ts=tl-ta,{up:{index:n.index,value:_},down:{index:n.index,value:ts}}}var Gr,Ur,Zr=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t,e){if(this._data){var n=this._data,C=n.linesColor,_=n.levels,ts=n.backgroundColor,ta=n.linesStyle;t.save(),t.scale(e,e),t.fillStyle=ts;var tl=_.low,th=_.high;t.fillRect(0,th.y+1,t.canvas.width,tl.y-th.y-1),k(t,ta),t.strokeStyle=C,t.lineWidth=1,Object.values(_).forEach(function(e){return e&&T(t,e.y,0,t.canvas.width)}),t.restore()}},t}(),qr=dn(),Kr=function(t){function e(e){var n=t.call(this)||this;return n._active=e,n._data=null,n}return p(e,t),e.prototype.setData=function(t){this._data=t},e.prototype.setActive=function(t){this._active=t},e.prototype._drawImpl=function(t){var e;if(null!==this._data&&0!==this._data.items.length){if(t.lineCap="butt",t.lineWidth=this._data.lineWidth,k(t,this._data.lineStyle),t.strokeStyle=this._data.lineColor,t.lineJoin="round",t.beginPath(),In(t,this._data.items,0),t.stroke(),this._active){var n=null!==(e=this._prevArcInterval)&&void 0!==e?e:Math.ceil(100/(this._data.items[1].x-this._data.items[0].x));void 0===this._prevArcInterval&&(this._prevArcInterval=n),k(t,0),t.fillStyle=this._data.circlesBackground,t.lineWidth=4;for(var C=this._data.items.length-1,_=void 0;C>=0;){if(void 0===_){if((this._data.latestTimePointIndex-this._data.items[C].time)%n!=0){C--;continue}_=C}t.beginPath();var ts=this._data.items[C],ta=ts.x,tl=ts.y;t.moveTo(ta+4,tl),t.arc(ta,tl,4,0,2*Math.PI),t.fill(),t.stroke(),C-=n}}else this._prevArcInterval=void 0}},e.prototype.hitTest=function(t,e){var n;if(!(null===(n=this._data)||void 0===n?void 0:n.items.length))return null;for(var C,_,ts=this._data.items,ta=1;ta<ts.length;ta++)if(ts[ta].x>t){C={x:ts[ta].x,y:ts[ta].y},_={x:ts[ta-1].x,y:ts[ta-1].y};break}return _&&C&&ln(t,e,_,C,qr)?{}:null},e}(Z);!function(t){t.Line="Line",t.Background="Background",t.Histogram="Histogram"}(Ur||(Ur={}));var Yr=((Gr={})[Ur.Line]=Kr,Gr[Ur.Background]=Zr,Gr[Ur.Histogram]=Zn,Gr),Xr=function(){function t(t,e,n){this._series=t,this._model=e,this._renderers=[],this._renderersData=[],this._renderer=new U(this._rendererHitTest),this._coordsInvalidated=!1,this._renderersData=this._model.getRenderersData(),this._renderers=this._renderersData.map(function(t){return new Yr[t.type]}),this.setActive(n),this._renderer.setRenderers(this._renderers)}return t.prototype.renderer=function(t,e){var n=this;return this._series.visible()?(this._makeValid(),this._renderers.forEach(function(t,e){return t.setData(n._renderersData[e].data)}),this._renderer):null},t.prototype.clickHandler=function(){this._series.model().activateIndicator(this._model.data)},t.prototype.setActive=function(t){this._renderers.forEach(function(e){var n,C;return null===(C=(n=e).setActive)||void 0===C?void 0:C.call(n,t)})},t.prototype.update=function(){this._coordsInvalidated=!0},t.prototype._fillLineRendererCoordinates=function(t,e,n,C){e.indexesToCoordinates(C.items),t.pointsArrayToCoordinates(C.items,n)},t.prototype._fillHistogramRendererCoordinates=function(t,e,n,C){this._fillLineRendererCoordinates(t,e,n,C),C.histogramBase=t.priceToCoordinate(C.histogramBase,n)},t.prototype._fillBackgroundRendererCoordinates=function(t,e,n){var C=Object.values(n.levels);t.pointsArrayToCoordinates(C,e)},t.prototype._updatePoints=function(){var t=this,e=this._model.priceScale(),n=this._model.model().timeScale();if(!n.isEmpty()&&!e.isEmpty()&&null!==n.visibleStrictRange()&&0!==this._series.bars().size()){var C=this._model.firstValue();null!==C&&this._renderersData.forEach(function(_){Ur.Line===_.type?t._fillLineRendererCoordinates(e,n,C.value,_.data):Ur.Histogram===_.type?t._fillHistogramRendererCoordinates(e,n,C.value,_.data):t._fillBackgroundRendererCoordinates(e,C.value,_.data)})}},t.prototype._makeValid=function(){this._coordsInvalidated&&(this._renderersData=this._model.getRenderersData(),this._updatePoints(),this._coordsInvalidated=!1)},t.prototype._rendererHitTest=function(t,e){return{noHoverHandling:!0}},t}(),$r=function(t){function e(){return t.call(this)||this}return p(e,t),e.prototype._updateRendererData=function(t,e,n){},e}(xe),Jr=function(t){function e(e,n){var C=t.call(this,e.model())||this;return C.data=n,C._priceAxisView=new $r,C._autoScaleInfo=null,C._series=e,C}return p(e,t),e.prototype.autoscaleInfo=function(t,e){return this._autoScaleInfo=this._autoscaleInfoImpl(t,e),this._prevStartTimePoint=t,this._prevEndTimePoint=e,this._autoScaleInfo},e.prototype.isActive=function(){return!!this.data.active},e.prototype.formatter=function(){var t=this.minMove();return new Pe(Math.round(10/t),1)},e.prototype.priceLineColor=function(t){return this._series.priceLineColor(t)},e.prototype.minMove=function(){var t,e=null===(t=this._autoScaleInfo)||void 0===t?void 0:t.priceRange();if(!e)return .1;var n=e.maxValue()-e.minValue();if(0===n)return .1;for(var C=0;n<1;)n*=10,C++;return+Math.pow(10,-C).toFixed(C)},e.prototype.updateData=function(t){var e,n,C=this,_=this.data;this.data=z(t),this._shouldRecalcPoints(this.data,_)&&(this.update("allPoints"),this.updatePaneLabelOptions());var ts=this.model().getPaneByIndex(this.data.options.paneIndex);ts!==this.pane&&(null===(e=this.pane)||void 0===e||e.removeDataSource(this),this.pane=ts,null===(n=this.pane)||void 0===n||n.addDataSource(this,this.model().defaultVisiblePriceScaleId()),this.updatePaneLabelOptions(this.pane)),this.data.active!==_.active&&this.paneViews().forEach(function(t){return t.setActive(!!C.data.active)}),this.update()},e.prototype.updateAllViews=function(){this.update(),this._priceAxisView.update()},e.prototype.update=function(t){"allPoints"===t?this.calcPoints():"lastPoint"===t&&this.calcLastPoint(),this.paneViews().forEach(function(t){return t.update()})},e.prototype.calcPoints=function(){this._calcPoints(),void 0!==this._prevEndTimePoint&&null!=this._prevStartTimePoint&&this.autoscaleInfo(this._prevStartTimePoint,this._prevEndTimePoint),null===(t=this.pane)||void 0===t||t.updatePriceScalesFormatters();var t,e=this.model().paneForSource(this);this.model().recalculatePane(e)},e.prototype.calcLastPoint=function(){this._calcLastPoint()},e.prototype.priceAxisViews=function(t,e){return e!==this._priceScale?[]:[this._priceAxisView]},e.prototype.remove=function(){var t=this.model().paneForSource(this);null==t||t.removeDataSource(this),this._cleanUp()},e.prototype.updatePaneLabelOptions=function(t){void 0===t&&(t=this.model().paneForSource(this)),t&&(t.applyPaneOptions({label:this.formatPaneLabelOptions()}),this.model().invalidatePanesOptions())},e.prototype.formatPaneLabelOptions=function(){var t=this.model().options().indicatorsConfig.defaultOptions[this.data.type].label;if(t){var e=this._getPaneLabelText(t.text);return{style:t.style,text:e}}},e}(Hr);function Qr(t,e,n){var C,_,ts=e.model().timeScale(),ta=e.getLineRenderOptions(n),tl=ts.visibleStrictRange(),th=tl&&Ln(t,tl,!0),tc=th&&!ai(ta.lineStyle)?t.slice(th.from,th.to):t;return f(f({},ta),{items:tc,latestTimePointIndex:null!==(_=null===(C=t[t.length-1])||void 0===C?void 0:C.time)&&void 0!==_?_:0,barWidth:e.model().timeScale().barSpacing()})}function ei(t){var e=t.model().options().indicatorsConfig.defaultOptions[t.data.type].background,n=t.getLineRenderOptions(0).lineColor;return e&&ii(e,n)}function ti(t,e){var n,C;return(null===(n=t[t.length-1])||void 0===n?void 0:n.index)===(null===(C=e[e.length-1])||void 0===C?void 0:C.time)}function ni(t,e,n){var C=t;return n?C[C.length-1]=e:C.push(e),C}function ri(t){var e=t.data.options.paneIndex;if(void 0!==e){var n=t.model().getPaneByIndex(e);t.pane=n,t.updatePaneLabelOptions(n),null==n||n.addDataSource(t,t.model().defaultVisiblePriceScaleId())}t.calcPoints()}var ii=function(t,e){var n=t.levels,C=t.backgroundColor,_=t.backgroundOpacity,ts=m(t,["levels","backgroundColor","backgroundOpacity"]),ta=Object.entries(n).reduce(function(t,e){var n=v(e,2),C=n[0],_=n[1];return t[C]={price:_,y:NaN},t},{}),tl=null!=C?C:he(e,null!=_?_:.08);return f(f({},ts),{backgroundColor:tl,levels:ta})};function oi(t,e,n,C){var _=n.map(function(n){return function(t,e,n){var C=t.filter(function(t){return t.time>=e&&t.time<=n});if(!C.length)return null;var _=C[0].price,ts=_;return C.forEach(function(t){_=Math.min(_,t.price),ts=Math.max(t.price,ts)}),{min:_,max:ts}}(n,t,e)}).reduce(function(t,e){var n,C;return e&&(t.min=Math.min(e.min,null!==(n=t.min)&&void 0!==n?n:e.min),t.max=Math.max(e.max,null!==(C=t.max)&&void 0!==C?C:e.max)),t},C||{}),ts=_.min,ta=_.max,tl=new Ae(null!=ts?ts:0,null!=ta?ta:100);return new Mr(tl,{below:.1,above:.1})}var ai=function(t){return 0!==t},si=function(t){function e(e,n){var C=t.call(this,e,n)||this;return C.data=n,C._upPoints=[],C._downPoints=[],C._upEMAPoints=[],C._downEMAPoints=[],C._points=[],C._paneView=new Xr(C._series,C,!!C.data.active),ri(C),C}return p(e,t),e.prototype.updateAllViews=function(){this.update()},e.prototype._cleanUp=function(){this._resetPoints()},e.prototype._autoscaleInfoImpl=function(t,e){return oi(t,e,[this._points],{min:30,max:70})},e.prototype.getRenderersData=function(){return[{type:Ur.Background,data:ei(this)},{type:Ur.Line,data:Qr(this._points,this)}]},e.prototype.firstValue=function(){var t,e,n,C=this.model().timeScale().visibleStrictRange(),_=this.model().timeScale().indexToTime(null!==(t=null==C?void 0:C.left())&&void 0!==t?t:0);return{value:null!==(n=null===(e=this._points.find(function(t){return t.time===(null==C?void 0:C.left())}))||void 0===e?void 0:e.price)&&void 0!==n?n:100,timePoint:_}},e.prototype.paneViews=function(){return[this._paneView]},e.prototype._calcPoints=function(){this._resetPoints();var t,e,n=Vt(this.data.options.length),C=zr(n),_=function(t){for(var e=[],n=1;n<t.length;n++){var C=jr(t,n);C&&e.push(C)}return e}(this._series.bars().rows());this._upPoints=_.map(function(t){return t.up}),this._downPoints=_.map(function(t){return t.down}),this._upEMAPoints=Ar(this._upPoints,n,C),this._downEMAPoints=Ar(this._downPoints,n,C),this._points=(t=this._upEMAPoints,e=this._downEMAPoints,t.map(function(t,n){var C=e[n];return N(!!C,"RSI up and down EMAs not synked"),Wr(t,C)}))},e.prototype._calcLastPoint=function(){var t=this,e=Vt(this.data.options.length),n=zr(e),C=this._series.bars().rows(),_=C.length-1,ts=ti(C,this._points),ta=jr(this._series.bars().rows(),_);if(null!==ta){var tl=ta.up,th=ta.down;ni(this._upPoints,tl,ts),ni(this._downPoints,th,ts);var tc=function(C){return{index:_,prevPoint:Rr(C?t._upEMAPoints:t._downEMAPoints,ts),length:e,multiplier:n,checkIndex:!0,inputPoints:C?t._upPoints:t._downPoints}},td=Lr(tc(!0)),tu=Lr(tc(!1));if(td&&tu){ni(this._upEMAPoints,td,ts),ni(this._downEMAPoints,tu,ts);var tp=Wr(td,tu);ni(this._points,tp,ts)}}},e.prototype.getLineRenderOptions=function(){var t=this.model().options(),e=t.indicatorsConfig,n=t.drawingConfig,C=this.data.options,_=C.lineColor,ts=m(C,["lineColor"]);return f(f({},ts),{lineStyle:0,lineColor:d(_,n),circlesBackground:e.defaultOptions[this.data.type].circlesBackground})},e.prototype._shouldRecalcPoints=function(t,e){return Vt(t.options.length)!==Vt(e.options.length)},e.prototype._getPaneLabelText=function(t){return"RSI"+(t.withLength?" "+this.data.options.length:"")},e.prototype._resetPoints=function(){this._upPoints=[],this._downPoints=[],this._downEMAPoints=[],this._upEMAPoints=[],this._points=[]},e}(Jr),li=function(t){function e(e,n){var C=t.call(this,e,n)||this;return C.data=n,C._shortEMAPoints=[],C._longEMAPoints=[],C._MACDPoints=[],C._signalPoints=[],C._histogramPoints=[],C._calcMACDPoint=function(t,e){return f(f({},t),{price:e.price-t.price})},C._calcHistogramPoint=function(t,e,n){void 0===n&&(n=0);var _=e.price-t.price,ts=C._series.model().options().indicatorsConfig.defaultOptions.MACD.histogramColors,ta=ts.positive,tl=ts.negative,th=ts.positiveLight,tc=ts.negativeLight;return f(f({},t),{price:_,color:_>0?n>_?th:ta:n<_?tc:tl})},C._paneView=new Xr(C._series,C,!!C.data.active),ri(C),C}return p(e,t),e.prototype.paneViews=function(t){return[this._paneView]},e.prototype.getRenderersData=function(){var t,e,n,C;return[{type:Ur.Histogram,data:(t=this._histogramPoints,n=(e=this.model().timeScale()).barSpacing(),{histogramBase:0,visibleRange:(C=e.visibleStrictRange())&&Ln(t,C,!0),barSpacing:n,items:t})},{type:Ur.Line,data:Qr(this._MACDPoints,this,0)},{type:Ur.Line,data:Qr(this._signalPoints,this,1)}]},e.prototype._autoscaleInfoImpl=function(t,e){return oi(t,e,[this._MACDPoints,this._signalPoints,this._histogramPoints])},e.prototype._cleanUp=function(){this._resetPoints()},e.prototype.firstValue=function(){var t,e,n,C=this.model().timeScale().visibleStrictRange(),_=this.model().timeScale().indexToTime(null!==(t=null==C?void 0:C.left())&&void 0!==t?t:0);return{value:null!==(n=null===(e=this._shortEMAPoints.find(function(t){return t.time===(null==C?void 0:C.left())}))||void 0===e?void 0:e.price)&&void 0!==n?n:0,timePoint:_}},e.prototype._resetPoints=function(){this._MACDPoints=[],this._signalPoints=[],this._shortEMAPoints=[],this._longEMAPoints=[]},e.prototype._calcPoints=function(){var t=this;this._resetPoints();var e=Br(this._series.bars().rows()),n=this.getLengths(),C=n.shortLength,_=n.longLength,ts=n.signalLength,ta=Ar(e,_,Vr(_)),tl=Ar(e,C,Vr(C));this._longEMAPoints=ta.filter(function(t){return tl[0]&&t.time>=tl[0].time}),this._shortEMAPoints=tl.filter(function(e){return t._longEMAPoints[0]&&e.time>=t._longEMAPoints[0].time}),this._MACDPoints=this._longEMAPoints.map(function(e,n){return t._calcMACDPoint(e,P(t._shortEMAPoints[n]))});var th=this._MACDPoints.map(Bt);this._signalPoints=Ar(th,ts,Vr(ts));var tc=this._MACDPoints.filter(function(e){return t._signalPoints[0]&&e.time>=t._signalPoints[0].time}),td=0;this._histogramPoints=this._signalPoints.map(function(e,n){var C=t._calcHistogramPoint(e,tc[n],td);return td=C.price,C})},e.prototype._calcLastPoint=function(){var t=this,e=this.getLengths(),n=e.shortLength,C=e.longLength,_=e.signalLength,ts=this._series.bars().rows(),ta=Br(ts),tl=ts.length-1,th=ti(ts,this._MACDPoints),tc=function(e){var _="short"===e?n:C;return{index:tl,prevPoint:Rr("short"===e?t._shortEMAPoints:t._longEMAPoints,th),length:_,multiplier:Vr(_),checkIndex:!0,inputPoints:ta}},td=Lr(tc("short")),tu=Lr(tc("long"));if(td&&tu){ni(this._shortEMAPoints,td,th),ni(this._longEMAPoints,tu,th);var tp=this._calcMACDPoint(tu,td);ni(this._MACDPoints,tp,th);var t8=this._MACDPoints.map(Bt),tf=Lr({index:t8.length-1,prevPoint:Rr(this._signalPoints,th),length:_,multiplier:Vr(_),checkIndex:!0,inputPoints:t8});if(tf){ni(this._signalPoints,tf,th);var tv=this._calcHistogramPoint(tf,tp,this._histogramPoints[this._histogramPoints.length-(th?2:1)].price);ni(this._histogramPoints,tv,th)}}},e.prototype.getLengths=function(){var t=this.data.options,e=t.shortLength,n=t.longLength,C=t.signalLength;return{shortLength:Vt(e),longLength:Vt(n),signalLength:Vt(C)}},e.prototype.getLineRenderOptions=function(t){var e=this._series.model().options(),n=e.indicatorsConfig,C=e.drawingConfig,_=this.data.options,ts=_.colorsPair;return{lineWidth:m(_,["colorsPair"]).lineWidth,lineStyle:0,lineColor:d(ts[t],C),circlesBackground:n.defaultOptions.MACD.circlesBackground}},e.prototype._getLengths=function(t){void 0===t&&(t=this.data.options);var e=t.shortLength,n=t.longLength,C=t.signalLength;return{shortLength:Vt(e),signalLength:Vt(C),longLength:Vt(n)}},e.prototype._shouldRecalcPoints=function(t,e){var n=this._getLengths(),C=n.shortLength,_=n.longLength,ts=n.signalLength,ta=this._getLengths(e.options);return C!==ta.shortLength||_!==ta.longLength||ts!==ta.signalLength},e.prototype._getPaneLabelText=function(t){var e=this.data.options,n=e.shortLength,C=e.longLength,_=e.signalLength;return this.data.type+(t.withLength?" "+n+" "+C+" "+_:"")},e}(Jr),ci=function(){function t(t,e,n){this._series=t,this._model=e,this._rendererItems=[],this._coordsInvalidated=!1,this._renderer=new Kr(n)}return t.prototype.renderer=function(t,e){if(!this._series.visible())return null;var n,C,_=this._model.getRenderOptions(),ts=this._model.getPoints();this._makeValid();var ta={items:this._rendererItems,lineColor:_.lineColorValue,circlesBackground:_.circlesBackground,lineStyle:_.lineStyle,lineWidth:_.lineWidth,barWidth:this._series.model().timeScale().barSpacing(),latestTimePointIndex:null!==(C=null===(n=ts[ts.length-1])||void 0===n?void 0:n.time)&&void 0!==C?C:0};return this._renderer.setData(ta),this._renderer},t.prototype.clickHandler=function(){this._series.model().activateIndicator(this._model.data)},t.prototype.setActive=function(t){this._renderer.setActive(t)},t.prototype.update=function(){this._coordsInvalidated=!0},t.prototype._convertToCoordinates=function(t,e,n){e.indexesToCoordinates(this._rendererItems),t.pointsArrayToCoordinates(this._rendererItems,n)},t.prototype._updatePoints=function(){var t=this._series.priceScale(),e=this._series.model().timeScale();if(e.isEmpty()||t.isEmpty())this._rendererItems=[];else{var n=e.visibleStrictRange();if(null!==n){if(0!==this._series.bars().size()){var C=this._series.firstValue();if(null!==C){var _=this._model.getPoints(),ts=Ln(_,n,!0),ta=ai(this._model.getRenderOptions().lineStyle);this._rendererItems=ts&&!ta?_.slice(ts.from,ts.to):_,this._convertToCoordinates(t,e,C.value)}}else this._rendererItems=[]}}},t.prototype._makeValid=function(){this._coordsInvalidated&&(this._updatePoints(),this._coordsInvalidated=!1)},t}(),ui=function(){function t(t,e){this._series=t,this.data=e,this._points=[],this._paneView=new ci(this._series,this,!!e.active),this.calcPoints()}return t.prototype.getPoints=function(){return this._points},t.prototype.calcPoints=function(){this._points=[],this._points=this._calcPoints()},t.prototype.calcLastPoint=function(){var t=this._series.bars().rows(),e=this._shouldReplaceLast(t,this._points),n=this._calcLastPoint(e);n&&this._addLastPoint(this._points,n,e)},t.prototype.remove=function(){this._points=[]},t.prototype.updateData=function(t){var e=this.data;this.data=t,this.data.options.length!==e.options.length&&this.update("allPoints"),this.data.active!==e.active&&this._paneView.setActive(!!t.active),this._paneView.update()},t.prototype.update=function(t){"allPoints"===t?this.calcPoints():"lastPoint"===t&&this.calcLastPoint(),this.paneViews().forEach(function(t){return t.update()})},t.prototype.isActive=function(){return!!this.data.active},t.prototype.paneViews=function(){return[this._paneView]},t.prototype.getRenderOptions=function(){var t=this._series.model().options(),e=t.indicatorsConfig,n=t.drawingConfig,C=this.data.options,_=C.lineColor,ts=m(C,["lineColor"]);return f(f({},ts),{lineColorValue:d(_,n),circlesBackground:e.defaultOptions[this.data.type].circlesBackground})},t.prototype._shouldReplaceLast=function(t,e){var n;return t[t.length-1].index===(null===(n=e[e.length-1])||void 0===n?void 0:n.time)},t.prototype._addLastPoint=function(t,e,n){var C=t;return n?C[C.length-1]=e:C.push(e),C},t}(),di=function(t){function e(e,n){var C=t.call(this,e,n)||this;return C.data=n,C}return p(e,t),e.prototype._calcPoints=function(){var t=Vt(this.data.options.length),e=Vr(t);return Ar(Br(this._series.bars().rows()),t,e)},e.prototype._calcLastPoint=function(t){var e=Vt(this.data.options.length),n=Vr(e),C=this._series.bars().rows();return Lr({index:C.length-1,prevPoint:Rr(this.getPoints(),t),length:e,multiplier:n,checkIndex:!0,inputPoints:Br(C)})},e}(ui);function hi(t){var e=t.checkIndex,n=t.inputPoints,C=t.index,_=t.length;if(!e||C>=_-1&&C<n.length){for(var ts=0,ta=0;ta<_;ta++)ts+=n[C-ta].value;return{time:n[C].index,price:ts/_,x:NaN,y:NaN}}}function pi(t,e){var n=[];if(t.length<e)return[];for(var C=e-1;C<t.length;C++){var _=hi({index:C,checkIndex:!1,inputPoints:t,length:e});_&&n.push(_)}return n}var fi,mi=function(t){function e(e,n){var C=t.call(this,e,n)||this;return C.data=n,C}return p(e,t),e.prototype._calcPoints=function(){var t=Vt(this.data.options.length);return pi(Br(this._series.bars().rows()),t)},e.prototype._calcLastPoint=function(t){var e=Vt(this.data.options.length),n=this._series.bars().rows();return hi({index:n.length-1,checkIndex:!0,inputPoints:Br(n),length:e})},e}(ui),gi=function(t){function e(e,n){var C=t.call(this,e,n)||this;return C.data=n,C._KRawPoints=[],C._KPoints=[],C._DPoints=[],C._paneView=new Xr(C._series,C,!!C.data.active),ri(C),C}return p(e,t),e.prototype.paneViews=function(t){return[this._paneView]},e.prototype.getRenderersData=function(){return[{type:Ur.Background,data:ei(this)},{type:Ur.Line,data:Qr(this._KPoints,this,0)},{type:Ur.Line,data:Qr(this._DPoints,this,1)}]},e.prototype._autoscaleInfoImpl=function(t,e){return oi(t,e,[this._KPoints,this._DPoints],{min:20,max:80})},e.prototype._cleanUp=function(){this._resetPoints()},e.prototype.firstValue=function(){var t,e,n,C=this.model().timeScale().visibleStrictRange(),_=this.model().timeScale().indexToTime(null!==(t=null==C?void 0:C.left())&&void 0!==t?t:0);return{value:null!==(n=null===(e=this._KPoints.find(function(t){return t.time===(null==C?void 0:C.left())}))||void 0===e?void 0:e.price)&&void 0!==n?n:0,timePoint:_}},e.prototype._resetPoints=function(){this._KRawPoints=[],this._KPoints=[],this._DPoints=[]},e.prototype._calcPoints=function(){var t=this;this._resetPoints();var e=this._series.bars().rows(),n=Br(e),C=this._getHighLowValues(e),_=C.highValues,ts=C.lowValues,ta=this._getLengths(),tl=ta.KLength,th=ta.KSmoothing,tc=ta.DSmoothing;n.forEach(function(e,n){var C=t._calcKPoint({closeValue:e,highValues:_,lowValues:ts,index:n,length:tl});C&&t._KRawPoints.push(C)}),this._KPoints=pi(this._KRawPoints,th),this._DPoints=pi(this._KPoints.map(Bt),tc)},e.prototype._calcLastPoint=function(){var t=this._series.bars().rows(),e=Br(t),n=this._getHighLowValues(t),C=n.highValues,_=n.lowValues,ts=this._getLengths(),ta=ts.KLength,tl=ts.KSmoothing,th=ts.DSmoothing,tc=t.length-1,td=ti(t,this._KPoints),tu=e[tc],tp=this._calcKPoint({closeValue:tu,highValues:C,lowValues:_,index:tc,length:ta});if(tp){ni(this._KRawPoints,tp,td);var t8=hi({index:this._KRawPoints.length-1,checkIndex:!0,inputPoints:this._KRawPoints,length:tl});if(t8){ni(this._KPoints,t8,td);var tf=this._KPoints.map(Bt),tv=hi({index:tf.length-1,checkIndex:!0,inputPoints:tf,length:th});tv&&ni(this._DPoints,tv,td)}}},e.prototype._getLengths=function(t){void 0===t&&(t=this.data.options);var e=t.KLength,n=t.KSmoothing,C=t.DSmoothing;return{KLength:Vt(e),DSmoothing:Vt(C),KSmoothing:Vt(n)}},e.prototype._getHighLowValues=function(t){return t.reduce(function(t,e){return t.highValues.push(e.value[1]),t.lowValues.push(e.value[2]),t},{highValues:[],lowValues:[]})},e.prototype._calcKPoint=function(t){var e=t.closeValue,n=t.highValues,C=t.lowValues,_=t.index,ts=t.length,ta=_+1;if(ta<ts||ta>n.length)return null;var tl=Math.max.apply(Math,y([],v(n.slice(ta-ts,ta)),!1)),th=Math.min.apply(Math,y([],v(C.slice(ta-ts,ta)),!1));return{value:100*(e.value-th)/(tl-th),index:e.index}},e.prototype.getLineRenderOptions=function(t){var e=this._series.model().options(),n=e.indicatorsConfig,C=e.drawingConfig,_=this.data.options,ts=_.colorsPair,ta=_.lineStylePair;return{lineWidth:m(_,["colorsPair","lineStylePair"]).lineWidth,lineStyle:ta[t],lineColor:d(ts[t],C),circlesBackground:n.defaultOptions.STOCH.circlesBackground}},e.prototype._shouldRecalcPoints=function(t,e){var n=this._getLengths(),C=n.KLength,_=n.KSmoothing,ts=n.DSmoothing,ta=this._getLengths(e.options);return C!==ta.KLength||_!==ta.KSmoothing||ts!==ta.DSmoothing},e.prototype._getPaneLabelText=function(t){var e,n=this._getLengths(),C=n.KLength,_=n.KSmoothing,ts=n.DSmoothing;return(null!==(e=t.name)&&void 0!==e?e:this.data.type)+(t.withLength?" "+C+" "+_+" "+ts:"")},e}(Jr),vi={RSI:si,EMA:di,SMA:mi,MACD:li,STOCH:gi},yi=function(t){function e(e,n,C){var _=t.call(this,e)||this;_._data=new Or,_._priceLineView=new Sr(_),_._customPriceLines=[],_._baseHorizontalLineView=new ir(_),_._lastPriceAnimationPaneView=null,_._barColorerCache=null,_._markers=[],_._indexedMarkers=[],_._animationTimeoutId=null,_._indicators=new Map,_._isSeriesIndicator=function(t){return!t.data.options.anotherPane},_._options=n,_._seriesType=C;var ts=new Er(_);return _._priceAxisViews=[ts],_._panePriceAxisView=new tr(ts,_,e),"Area"!==C&&"Line"!==C||(_._lastPriceAnimationPaneView=new ur(_)),_._recreateFormatter(),_._recreatePaneViews(),_}return p(e,t),e.prototype.destroy=function(){null!==this._animationTimeoutId&&clearTimeout(this._animationTimeoutId),this._indicators.clear()},e.prototype.isMain=function(){return this._options.isMain},e.prototype.setIndicators=function(t){var e=this;this._indicators.forEach(function(n){t.find(function(t){return t.id===n.data.id})||(n.remove(),e._indicators.delete(n.data.id))}),t.forEach(function(t){var n=e._indicators.get(t.id);n?n.updateData(t):e._indicators.set(t.id,new vi[t.type](e,t))})},e.prototype.priceLineColor=function(t){return this._options.priceLineColor||t},e.prototype.lastValueData=function(t,e){var n={noData:!0},C=this.priceScale();if(this.model().timeScale().isEmpty()||C.isEmpty()||this._data.isEmpty())return n;var _,ts,ta=this.model().timeScale().visibleStrictRange(),tl=this.firstValue();if(null===ta||null===tl)return n;if(t){var th=this._data.last();if(null===th)return n;_=th,ts=th.index}else{var tc=this._data.search(ta.right(),-1);if(null===tc||null===(_=this._data.valueAt(tc.index)))return n;ts=tc.index}var td=_.value[3],tu=this.barColorer().barStyle(ts,{value:_}),tp=C.priceToCoordinate(td,tl.value);return{noData:!1,price:e?td:void 0,text:C.formatPrice(td,tl.value),formattedPriceAbsolute:C.formatPriceAbsolute(td),formattedPricePercentage:C.formatPricePercentage(td,tl.value),color:tu.barColor,coordinate:tp,index:ts}},e.prototype.barColorer=function(){return null!==this._barColorerCache||(this._barColorerCache=new Pr(this)),this._barColorerCache},e.prototype.options=function(){return this._options},e.prototype.applyOptions=function(t){var e,n=t.priceScaleId;void 0!==n&&n!==this._options.priceScaleId&&this.model().moveSeriesToScale(this,n);var C=void 0!==t.isMain&&t.isMain!==this._options.isMain,_=null!==(e=this._options.paneIndex)&&void 0!==e?e:0;L(this._options,t),null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:t.scaleMargins}),void 0!==t.priceFormat&&this._recreateFormatter(),t.paneIndex&&_!==t.paneIndex&&this.model().moveSeriesToPane(this,_,t.paneIndex),this.model().updateSource(this),C&&this.model().updateMainSeries(),this.model().updateCrosshair(),this._paneView.update("options")},e.prototype.clearData=function(){this._data.clear(),this._recreatePaneViews()},e.prototype.updateData=function(t,e){var n,C=t.length-1===this.bars().rows().length&&this.bars().rows().every(function(e,n){return e.value[3]===t[n].value[3]});e&&this._data.clear(),this._data.merge(t),this._recalculateMarkers(),this._paneView.update("data"),this.updateIndicators(e&&!C?"allPoints":"lastPoint"),this._markersPaneView.update("data"),null===(n=this._lastPriceAnimationPaneView)||void 0===n||n.update("data");var _=this.model().paneForSource(this);this.model().recalculatePane(_),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},e.prototype.setMarkers=function(t){this._markers=t.map(function(t){return f({},t)}),this._recalculateMarkers();var e=this.model().paneForSource(this);this._markersPaneView.update("data"),this.model().recalculatePane(e),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},e.prototype.indexedMarkers=function(){return this._indexedMarkers},e.prototype.createPriceLine=function(t){var e=new Ir(this,t);return this._customPriceLines.push(e),this.model().updateSource(this),e},e.prototype.removePriceLine=function(t){var e=this._customPriceLines.indexOf(t);-1!==e&&this._customPriceLines.splice(e,1),this.model().updateSource(this)},e.prototype.seriesType=function(){return this._seriesType},e.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:{value:t.value[3],timePoint:t.time}},e.prototype.firstBar=function(){var t=this.model().timeScale().visibleStrictRange();if(null===t)return null;var e=t.left();return this._data.search(e,1)},e.prototype.bars=function(){return this._data},e.prototype.dataAt=function(t){var e=this._data.valueAt(t);return null===e?null:"Bar"===this._seriesType||"Candlestick"===this._seriesType?{open:e.value[0],high:e.value[1],low:e.value[2],close:e.value[3]}:e.value[3]},e.prototype.topPaneViews=function(t){var e=this,n=this._lastPriceAnimationPaneView;return null!==n&&n.visible()?(null===this._animationTimeoutId&&n.animationActive()&&(this._animationTimeoutId=setTimeout(function(){e._animationTimeoutId=null,e.model().cursorUpdate()},0)),n.invalidateStage(),[n]):[]},e.prototype.paneViews=function(){var t,e,n=[];this._isOverlay()||n.push(this._baseHorizontalLineView);var C=this._getIndicatorsPaneViews(),_=C.indicators,ts=C.activeIndicator;this.model().options().indicatorsConfig.overlapSeries?n.push.apply(n,y([this._paneView,this._priceLineView],v(_),!1)):n.push.apply(n,y(y([],v(_),!1),[this._paneView,this._priceLineView],!1));try{for(var ta=g(this._customPriceLines),tl=ta.next();!tl.done;tl=ta.next()){var th=tl.value;n.push.apply(n,y([],v(th.paneViews()),!1))}}catch(tc){t={error:tc}}finally{try{tl&&!tl.done&&(e=ta.return)&&e.call(ta)}finally{if(t)throw t.error}}return n.push(this._panePriceAxisView,this._markersPaneView),ts&&n.push.apply(n,y([],v(ts),!1)),n},e.prototype.priceAxisViews=function(t,e){if(e!==this._priceScale&&!this._isOverlay())return[];var n,C,_=y([],v(this._priceAxisViews),!1);try{for(var ts=g(this._customPriceLines),ta=ts.next();!ta.done;ta=ts.next()){var tl=ta.value;_.push(tl.priceAxisView())}}catch(th){n={error:th}}finally{try{ta&&!ta.done&&(C=ts.return)&&C.call(ts)}finally{if(n)throw n.error}}return _},e.prototype.autoscaleInfo=function(t,e){var n=this;if(void 0!==this._options.autoscaleInfoProvider){var C=this._options.autoscaleInfoProvider(function(){var C=n._autoscaleInfoImpl(t,e);return null===C?null:C.toRaw()});return Mr.fromRaw(C)}return this._autoscaleInfoImpl(t,e)},e.prototype.minMove=function(){return this._options.priceFormat.minMove},e.prototype.formatter=function(){return this._formatter},e.prototype.updateAllViews=function(){var t,e,n,C,_;this._paneView.update(),this._markersPaneView.update();try{for(var ts=g(this._priceAxisViews),ta=ts.next();!ta.done;ta=ts.next())ta.value.update()}catch(tl){t={error:tl}}finally{try{ta&&!ta.done&&(e=ts.return)&&e.call(ts)}finally{if(t)throw t.error}}try{for(var th=g(this._customPriceLines),tc=th.next();!tc.done;tc=th.next())tc.value.update()}catch(td){n={error:td}}finally{try{tc&&!tc.done&&(C=th.return)&&C.call(th)}finally{if(n)throw n.error}}this.updateIndicators(),this._priceLineView.update(),this._baseHorizontalLineView.update(),null===(_=this._lastPriceAnimationPaneView)||void 0===_||_.update()},e.prototype.priceScale=function(){return O(this._priceScale)},e.prototype.markerDataAtIndex=function(t){if("Line"!==this._seriesType&&"Area"!==this._seriesType||!this._options.crosshairMarkerVisible)return null;var e=this._data.valueAt(t);return null===e?null:{price:e.value[3],radius:this._markerRadius(),borderColor:this._markerBorderColor(),backgroundColor:this._markerBackgroundColor(t)}},e.prototype.title=function(){return this._options.title},e.prototype.visible=function(){return this._options.visible},e.prototype._isOverlay=function(){return!en(this.priceScale().id())},e.prototype._getSeriesIndicators=function(){return Array.from(this._indicators.values()).filter(this._isSeriesIndicator)},e.prototype._getIndicatorsPaneViews=function(){var t,e,n,C,_={indicators:[]},ts=this._getSeriesIndicators();try{for(var ta=g(ts),tl=ta.next();!tl.done;tl=ta.next()){var th=tl.value;th.isActive()?C=th:(n=_.indicators).push.apply(n,y([],v(th.paneViews()),!1))}}catch(tc){t={error:tc}}finally{try{tl&&!tl.done&&(e=ta.return)&&e.call(ta)}finally{if(t)throw t.error}}return C&&(_.activeIndicator=C.paneViews()),_},e.prototype._autoscaleInfoImpl=function(t,e){if(!F(t)||!F(e)||this._data.isEmpty())return null;var n="Line"===this._seriesType||"Area"===this._seriesType||"Histogram"===this._seriesType?[3]:[2,1],C=this._data.minMaxOnRangeCached(t,e,n),_=null!==C?new Ae(C.min,C.max):null;if("Histogram"===this.seriesType()){var ts=this._options.base,ta=new Ae(ts,ts);_=null!==_?_.merge(ta):ta}return new Mr(_,this._markersPaneView.autoScaleMargins())},e.prototype._markerRadius=function(){switch(this._seriesType){case"Line":case"Area":return this._options.crosshairMarkerRadius}return 0},e.prototype._markerBorderColor=function(){switch(this._seriesType){case"Line":case"Area":var t=this._options.crosshairMarkerBorderColor;if(0!==t.length)return t}return null},e.prototype._markerBackgroundColor=function(t){switch(this._seriesType){case"Line":case"Area":var e=this._options.crosshairMarkerBackgroundColor;if(0!==e.length)return e}return this.barColorer().barStyle(t).barColor},e.prototype._recreateFormatter=function(){switch(this._options.priceFormat.type){case"custom":this._formatter={format:this._options.priceFormat.formatter};break;case"volume":this._formatter=new Tn(this._options.priceFormat.precision);break;case"percent":this._formatter=new Oe(this._options.priceFormat.precision);break;default:var t=Math.pow(10,this._options.priceFormat.precision);this._formatter=new Pe(t,this._options.priceFormat.minMove*t)}null!==this._priceScale&&this._priceScale.updateFormatter()},e.prototype.updateIndicators=function(t){this._indicators.forEach(function(e){return e.update(t)})},e.prototype._recalculateMarkers=function(){var t=this,e=this.model().timeScale();if(e.isEmpty()||0===this._data.size())this._indexedMarkers=[];else{var n=O(this._data.firstIndex());this._indexedMarkers=this._markers.map(function(C,_){var ts=O(e.timeToIndex(C.time,!0,!0,1));return{time:O(t._data.search(ts,ts<n?1:-1)).index,position:C.position,shape:C.shape,color:C.color,id:C.id,internalId:_,text:C.text,size:C.size}})}},e.prototype._recreatePaneViews=function(){switch(this._markersPaneView=new xr(this,this.model()),this._seriesType){case"Bar":this._paneView=new jn(this,this.model());break;case"Candlestick":this._paneView=new Un(this,this.model());break;case"Line":this._paneView=new $n(this,this.model());break;case"Area":this._paneView=new Vn(this,this.model());break;case"Histogram":this._paneView=new Xn(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this._seriesType)}},e}(Hr),_i=function(){function t(t){this._options=t}return t.prototype.align=function(t,e,n){var C=t;if(0===this._options.mode)return C;var _=n.defaultPriceScale(),ts=_.firstValue();if(null===ts)return C;var ta=_.priceToCoordinate(t,ts),tl=n.dataSources().filter(function(t){return t instanceof yi}).reduce(function(t,C){if(n.isOverlay(C)||!C.visible())return t;var _=C.priceScale(),ts=C.bars();if(_.isEmpty()||!ts.contains(e))return t;var ta=ts.valueAt(e);if(null===ta)return t;var tl=D(C.firstValue());return t.concat([_.priceToCoordinate(ta.value[3],tl.value)])},[]);if(0===tl.length)return C;tl.sort(function(t,e){return Math.abs(t-ta)-Math.abs(e-ta)});var th=tl[0];return _.coordinateToPrice(th,ts)},t.prototype.setOptions=function(t){this._options=t},t}(),Ci=function(t){function e(e){var n=t.call(this)||this;return n._metricsCache=new Map,n._data=e,n}return p(e,t),e.prototype._drawImpl=function(t){},e.prototype._drawBackgroundImpl=function(t){var e,n,C,_;if(this._data.visible){t.save();var ts=0;try{for(var ta=g(this._data.lines),tl=ta.next();!tl.done;tl=ta.next())if(0!==(t8=tl.value).text.length){t.font=t8.font;var th=this._metrics(t,t8.text);th>this._data.width?t8.zoom=this._data.width/th:t8.zoom=1,ts+=t8.lineHeight*t8.zoom}}catch(tc){e={error:tc}}finally{try{tl&&!tl.done&&(n=ta.return)&&n.call(ta)}finally{if(e)throw e.error}}var td=0;switch(this._data.vertAlign){case"top":td=0;break;case"center":td=Math.max((this._data.height-ts)/2,0);break;case"bottom":td=Math.max(this._data.height-ts,0)}t.fillStyle=this._data.color;try{for(var tu=g(this._data.lines),tp=tu.next();!tp.done;tp=tu.next()){var t8=tp.value;t.save();var tf=0;switch(this._data.horzAlign){case"left":t.textAlign="left",tf=t8.lineHeight/2;break;case"center":t.textAlign="center",tf=this._data.width/2;break;case"right":t.textAlign="right",tf=this._data.width-1-t8.lineHeight/2}t.translate(tf,td),t.textBaseline="top",t.font=t8.font,t.scale(t8.zoom,t8.zoom),t.fillText(t8.text,0,t8.vertOffset),t.restore(),td+=t8.lineHeight*t8.zoom}}catch(tv){C={error:tv}}finally{try{tp&&!tp.done&&(_=tu.return)&&_.call(tu)}finally{if(C)throw C.error}}t.restore()}},e.prototype._metrics=function(t,e){var n=this._fontCache(t.font),C=n.get(e);return void 0===C&&(C=t.measureText(e).width,n.set(e,C)),C},e.prototype._fontCache=function(t){var e=this._metricsCache.get(t);return void 0===e&&(e=new Map,this._metricsCache.set(t,e)),e},e}(Z),bi=function(){function t(t){this._invalidated=!0,this._rendererData={visible:!1,color:"",height:0,width:0,lines:[],vertAlign:"center",horzAlign:"center"},this._renderer=new Ci(this._rendererData),this._source=t}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(t,e){return this._invalidated&&(this._updateImpl(t,e),this._invalidated=!1),this._renderer},t.prototype._updateImpl=function(t,e){var n=this._source.options(),C=this._rendererData;C.visible=n.visible,C.visible&&(C.color=n.color,C.width=e,C.height=t,C.horzAlign=n.horzAlign,C.vertAlign=n.vertAlign,C.lines=[{text:n.text,font:wn(n.fontSize,n.fontFamily,n.fontStyle),lineHeight:1.2*n.fontSize,vertOffset:0,zoom:0}])},t}(),wi=function(t){function e(e,n){var C=t.call(this)||this;return C._options=n,C._paneView=new bi(C),C}return p(e,t),e.prototype.paneViews=function(){return[this._paneView]},e.prototype.options=function(){return this._options},e.prototype.updateAllViews=function(){this._paneView.update()},e}(Te);!function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom"}(fi||(fi={}));var xi,Si=function(){function t(t,e,n){var C=this;this.mainPaneIndex=0,this._panes=[],this._panesToIndex=new Map,this._drawnTools=new Map,this._serieses=[],this._width=0,this._initialTimeScrollPos=null,this._hoveredSource=null,this._priceScalesOptionsChanged=new Delegate,this._crosshairMoved=new Delegate,this._clicked=new Delegate,this._suppressSeriesMoving=!1,this._gradientColorsCache=null,this._isindicatorsConfigPassed=!1,this.isDrawingToolActive=function(){return null!==C.options().activeDrawingTool},this.isDrawnToolEditing=function(){var t;return C.isDrawingToolActive()&&!!(null===(t=C.options().activeDrawingTool)||void 0===t?void 0:t.initialData)},this.hasActiveIndicator=function(){return null!==C._options.activeIndicatorId},this._panesOptionsInvalidated=!1,this._saveCrosshairOptions=function(){var t=C.options().crosshair;C._crosshairInitialOptions={mode:t.mode,vertLine:f({},t.vertLine),horzLine:f({},t.horzLine)}},this.changeCrosshairColor=function(t){C.applyOptions({crosshair:{mode:0,vertLine:{color:t,labelBackgroundColor:t,labelVisible:!0},horzLine:{color:t,labelBackgroundColor:t,labelVisible:!0}}})},this._setInitialCrosshairOptions=function(){C._crosshairInitialOptions&&(C.applyOptions({crosshair:C._crosshairInitialOptions}),C._crosshairInitialOptions=void 0)},this._prevIndexToPanes={},this.chartWidget=t,this._invalidateHandler=e,this._options=z(n),this._rendererOptionsProvider=new En(this),this._timeScale=new gt(this,n.timeScale,this._options.localization),this._crosshair=new Ie(this,n.crosshair),this._drawingTool=n.activeDrawingTool&&_n[n.activeDrawingTool.type]?new _n[n.activeDrawingTool.type](this):void 0,this._magnet=new _i(n.crosshair),this._watermark=new wi(this,n.watermark),this._createPanesInitial(),this._backgroundTopColor=this._getBackgroundColor(0),this._backgroundBottomColor=this._getBackgroundColor(1)}return t.prototype.fullUpdate=function(){this._invalidate(new kn(3))},t.prototype.lightUpdate=function(){this._invalidate(new kn(2))},t.prototype.cursorUpdate=function(){this._invalidate(new kn(1))},t.prototype.updateSource=function(t){var e=this._invalidationMaskForSource(t);this._invalidate(e)},t.prototype.hoveredSource=function(){return this._hoveredSource},t.prototype.setHoveredSource=function(t){var e=this._hoveredSource;this._hoveredSource=t,(null==e?void 0:e.source)&&this.updateSource(e.source),(null==t?void 0:t.source)&&this.updateSource(t.source)},t.prototype.addTool=function(t){var e;(e=t,Ft.includes(e))?this._addIndicator(t):this.applyOptions({activeDrawingTool:{type:t}})},t.prototype.removeActiveTool=function(){this._removeActiveIndicator(),this._removeActiveDrawingTool()},t.prototype.switchOffTool=function(){var t,e;this.switchOffIndicator(),null===(e=null===(t=this.drawingToolSource())||void 0===t?void 0:t.switchOff)||void 0===e||e.call(t)},t.prototype.setActiveToolOptions=function(t){var e,n,C,_,ts=this.options(),ta=ts.activeIndicatorId,tl=ts.activeDrawingTool,th=ts.indicators;if(null==tl?void 0:tl.options){var tc=f(f({},tl.options),z(t));this.applyOptions({activeDrawingTool:{options:tc}}),null===(n=(e=this.chartWidget).activeToolChangeHandler)||void 0===n||n.call(e,{type:tl.type,options:tc})}else if(ta){th=z(th.map(function(e){return e.id===ta?f(f({},e),{options:f(f({},e.options),t)}):e})),this.applyOptions({indicators:th});var td=this.getActiveIndicator();td&&(null===(_=(C=this.chartWidget).activeToolChangeHandler)||void 0===_||_.call(C,{type:td.type,options:td.options}))}},t.prototype.updateMainSeries=function(){var t=this._serieses.find(function(t){return t.isMain()});t!==this._mainSeries&&(this._mainSeries&&this._mainSeries.setIndicators([]),this._mainSeries=t,this._updateMainSeriesIndicators(),this.fullUpdate())},t.prototype.getMainSeries=function(){return this._mainSeries},t.prototype.activateToolDrawing=function(t){var e=t.options,n=t.type,C=m(t,["options","type"]),_=y([],v(this.options().drawnTools),!1),ts=_.findIndex(function(t){return t.id===C.id});-1!==ts&&(_.splice(ts,1),this.applyOptions({activeDrawingTool:{type:n,options:e,initialData:C},drawnTools:_}),this._drawnTools.forEach(function(t){return t.deactivate()}))},t.prototype.options=function(){return this._options},t.prototype.switchOffIndicator=function(){var t,e;this._options.activeIndicatorId&&(this.applyOptions({activeIndicatorId:null}),null===(e=(t=this.chartWidget).activeToolChangeHandler)||void 0===e||e.call(t,{}))},t.prototype.activateIndicator=function(t){var e,n;this.applyOptions({activeIndicatorId:t.id}),null===(n=(e=this.chartWidget).activeToolChangeHandler)||void 0===n||n.call(e,{type:t.type,options:t.options})},t.prototype.getActiveIndicator=function(){var t=this;return this._options.indicators.find(function(e){return e.id===t._options.activeIndicatorId})},t.prototype.applyOptions=function(t,e){void 0===e&&(e=!0);var n,C,_,ts,ta=z(this._options),tl=z(t);L(this._options,tl),this._updatePanes(tl),void 0!==tl.timeScale&&this._timeScale.applyOptions(tl.timeScale),tl.indicatorsConfig&&(this._isindicatorsConfigPassed?this._serieses.forEach(function(t){return t.updateIndicators("allPoints")}):this._isindicatorsConfigPassed=!0),void 0!==tl.localization&&this._timeScale.applyLocalizationOptions(tl.localization),(tl.leftPriceScale||tl.rightPriceScale)&&this._priceScalesOptionsChanged.fire(),this._updateDrawingToolIfNeeded(ta),null===tl.indicators&&null===tl.activeIndicatorId||this._updateMainSeriesIndicators(),tl.crosshair&&(this._crosshair.setOptions(this._options.crosshair),this._magnet.setOptions(this._options.crosshair)),this._backgroundTopColor=this._getBackgroundColor(0),this._backgroundBottomColor=this._getBackgroundColor(1),this.fullUpdate(),e&&((t.indicators||t.panes)&&(null===(C=(n=this.chartWidget).saveHandler)||void 0===C||C.call(n,{panes:this._options.panes,indicators:this._options.indicators})),t.drawnTools&&!this._options.activeDrawingTool&&(null===(ts=(_=this.chartWidget).saveHandler)||void 0===ts||ts.call(_,{drawnTools:this._options.drawnTools})))},t.prototype.applyPriceScaleOptions=function(t,e){var n=this.findPriceScale(t);null!==n&&(n.priceScale.applyOptions(e),this._priceScalesOptionsChanged.fire())},t.prototype.findPriceScale=function(t){var e,n;try{for(var C=g(this._panes),_=C.next();!_.done;_=C.next()){var ts=_.value,ta=ts.priceScaleById(t);if(null!==ta)return{pane:ts,priceScale:ta}}}catch(tl){e={error:tl}}finally{try{_&&!_.done&&(n=C.return)&&n.call(C)}finally{if(e)throw e.error}}return null},t.prototype.timeScale=function(){return this._timeScale},t.prototype.panes=function(){return this._panes},t.prototype.watermarkSource=function(){return this._watermark},t.prototype.crosshairSource=function(){return this._crosshair},t.prototype.drawingToolSource=function(){return this._drawingTool},t.prototype.drawnToolsSourcesForPane=function(t){this._updateDrawnToolsIfNeeded(t);var e=Array.from(this._drawnTools.values()),n=this.getPaneIndex(t);return e.filter(function(t){return t.getPaneIndex()===n})},t.prototype.crosshairMoved=function(){return this._crosshairMoved},t.prototype.clicked=function(){return this._clicked},t.prototype.setPaneHeight=function(t,e){t.setHeight(e),this.recalculateAllPanes()},t.prototype.setWidth=function(t){this._width=t,this._timeScale.setWidth(this._width),this._panes.forEach(function(e){return e.setWidth(t)}),this.recalculateAllPanes()},t.prototype.getPaneWidgetByIndex=function(t){return this.chartWidget.paneWidgets()[t]},t.prototype.getPaneByIndex=function(t){return this.panes()[t]},t.prototype.createPane=function(t){var e=void 0===t?{}:t,n=e.index,C=e.options,_=e.updatePanesIndexes,ts=void 0===_||_;if(void 0!==n){if(n>this._panes.length)for(var ta=this._panes.length;ta<n;ta++)this.createPane({index:ta,updatePanesIndexes:ts});else if(n<this._panes.length)return this._panes[n]}var tl,th=void 0===n?this._panes.length-1+1:n,tc=L({stretchFactor:(tl=th===this.mainPaneIndex)?2e3:1e3,stretchFactorMobile:tl?2e3:1e3},this._options.panes[th],null!=C?C:{}),td=new an(this._timeScale,this,tc);this._panes.splice(th,0,td),this._updatePaneIndexes(),ts&&(this._updateToolsPanesIndexes(),td.applyScaleOptions(this._options));var tu=new kn(3);return tu.invalidatePane(th,{level:3,autoScale:!0}),this._invalidate(tu),td},t.prototype.updatePanesOptions=function(){var t=this._panes.map(function(t){var e=t.options();return e.label,m(e,["label"])});this._options.panes=t},t.prototype.removePane=function(t){var e=this,n=t.index,C=t.updatePanesIndexes;if(0!==n){var _=this._panes[n];if(_){if(_.orderedSources().forEach(function(t){t instanceof yi&&e.removeSeries(t)}),this._suppressSeriesMoving=!0,n!==this._panes.length-1)for(var ts=function(t){ta._panes[t].orderedSources().forEach(function(e){e instanceof yi&&e.applyOptions({paneIndex:t-1})})},ta=this,tl=n+1;tl<this._panes.length;tl++)ts(tl);this._suppressSeriesMoving=!1,this._panes.splice(n,1),this._updatePaneIndexes(),(void 0===C||C)&&(this._removeToolsOnPaneDelete(n),this._updateToolsPanesIndexes(!0)),this.fullUpdate()}}},t.prototype.swapPane=function(t,e){var n=this._panes[t],C=this._panes[e];this._suppressSeriesMoving=!0,n.orderedSources().forEach(function(t){t instanceof yi&&t.applyOptions({paneIndex:e})}),C.orderedSources().forEach(function(e){e instanceof yi&&e.applyOptions({paneIndex:t})}),this._panes[t]=C,this._panes[e]=n,this._suppressSeriesMoving=!1,this._updatePaneIndexes(),this._updateToolsPanesIndexes(),this.updatePanesOptions(),this.fullUpdate()},t.prototype.startScalePrice=function(t,e,n){t.startScalePrice(e,n)},t.prototype.scalePriceTo=function(t,e,n){t.scalePriceTo(e,n),this.updateCrosshair(),this._invalidate(this._paneInvalidationMask(t,2))},t.prototype.endScalePrice=function(t,e){t.endScalePrice(e),this._invalidate(this._paneInvalidationMask(t,2))},t.prototype.startScrollPrice=function(t,e,n){e.isAutoScale()||t.startScrollPrice(e,n)},t.prototype.scrollPriceTo=function(t,e,n){e.isAutoScale()||(t.scrollPriceTo(e,n),this.updateCrosshair(),this._invalidate(this._paneInvalidationMask(t,2)))},t.prototype.endScrollPrice=function(t,e){e.isAutoScale()||(t.endScrollPrice(e),this._invalidate(this._paneInvalidationMask(t,2)))},t.prototype.resetPriceScale=function(t,e){t.resetPriceScale(e),this._invalidate(this._paneInvalidationMask(t,3))},t.prototype.startScaleTime=function(t){this._timeScale.startScale(t)},t.prototype.zoomTime=function(t,e){var n=this.timeScale();!n.isEmpty()&&0!==e&&(t=Math.max(1,Math.min(t,n.width())),n.zoom(t,e),this.recalculateAllPanes())},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this._timeScale.scaleTo(t),this.recalculateAllPanes()},t.prototype.endScaleTime=function(){this._timeScale.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this._initialTimeScrollPos=t,this._timeScale.startScroll(t)},t.prototype.scrollTimeTo=function(t){var e=!1;return null!==this._initialTimeScrollPos&&Math.abs(t-this._initialTimeScrollPos)>20&&(this._initialTimeScrollPos=null,e=!0),this._timeScale.scrollTo(t),this.recalculateAllPanes(),e},t.prototype.endScrollTime=function(){this._timeScale.endScroll(),this.lightUpdate(),this._initialTimeScrollPos=null},t.prototype.serieses=function(){return this._serieses},t.prototype.setAndSaveCurrentPosition=function(t,e,n){this._crosshair.saveOriginCoord(t,e);var C=NaN,_=this._timeScale.coordinateToIndex(t),ts=this._timeScale.visibleStrictRange();null!==ts&&(_=Math.min(Math.max(ts.left(),_),ts.right()));var ta=n.defaultPriceScale(),tl=ta.firstValue();null!==tl&&(C=ta.coordinateToPrice(e,tl)),C=this._magnet.align(C,_,n),this._crosshair.setPosition(_,C,n),this.cursorUpdate();var th=this.getPaneIndex(n);this._crosshairMoved.fire(this._crosshair.appliedIndex(),{x:t,y:e,paneIndex:th})},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this.cursorUpdate(),this._crosshairMoved.fire(null,null)},t.prototype.updateCrosshair=function(){var t=this._crosshair.pane();if(null!==t){var e=this._crosshair.originCoordX(),n=this._crosshair.originCoordY();this.setAndSaveCurrentPosition(e,n,t)}this._crosshair.updateAllViews()},t.prototype.updateDrawingTool=function(){var t;null===(t=this._drawingTool)||void 0===t||t.updateAllViews()},t.prototype.updateTimeScale=function(t,e){var n=this._timeScale.indexToTime(0);void 0!==e&&this._timeScale.update(e);var C=this._timeScale.indexToTime(0),_=this._timeScale.baseIndex(),ts=this._timeScale.visibleStrictRange();if(null!==ts&&null!==n&&null!==C){var ta=ts.contains(_),tl=n.timestamp>C.timestamp,th=ta&&this._timeScale.options().shiftVisibleRangeOnNewBar;null===t||!(t>_)||tl||th||null===t||this._timeScale.setRightOffset(this._timeScale.rightOffset()-(t-_))}this._timeScale.setBaseIndex(t)},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var e=this._panes.find(function(e){return e.orderedSources().includes(t)});return void 0===e?null:e},t.prototype.recalculateAllPanes=function(){this._watermark.updateAllViews(),this._panes.forEach(function(t){return t.recalculate()}),this.updateCrosshair(),this.updateDrawingTool(),this._drawnTools.forEach(function(t){return t.updateAllViews()})},t.prototype.destroy=function(){var t,e;this._panes.forEach(function(t){return t.destroy()}),this._panes.length=0,this._options.localization.priceFormatter=void 0,this._options.localization.timeFormatter=void 0,this._options.localization.numberFormatter=void 0,this._options.onPlusClick=void 0,this._options.drawingConfig.eventHandler=void 0,this._options.indicatorsConfig.eventHandler=void 0,null===(t=this._drawingTool)||void 0===t||t.destroy(),this._crosshairMoved.destroy(),this._clicked.destroy(),null===(e=this._mainSeries)||void 0===e||e.destroy(),delete this._mainSeries,this._drawnTools.clear(),x.destroy()},t.prototype.rendererOptionsProvider=function(){return this._rendererOptionsProvider},t.prototype.priceAxisRendererOptions=function(){return this._rendererOptionsProvider.options()},t.prototype.priceScalesOptionsChanged=function(){return this._priceScalesOptionsChanged},t.prototype.createSeries=function(t,e){var n=e.paneIndex||0;this._panes.length-1<=n&&this.createPane({index:n});var C=this._panes[n],_=this._createSeries(e,t,C);return this._serieses.push(_),1===this._serieses.length?this.fullUpdate():this.lightUpdate(),_},t.prototype.removeSeries=function(t){var e=this.paneForSource(t);t.options().isMain&&t.setIndicators([]);var n=this._serieses.indexOf(t);N(-1!==n,"Series not found"),this._serieses.splice(n,1),O(e).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.moveSeriesToScale=function(t,e){var n=O(this.paneForSource(t));n.removeDataSource(t);var C=this.findPriceScale(e);if(null===C){var _=t.zorder();n.addDataSource(t,e,_)}else _=C.pane===n?t.zorder():void 0,C.pane.addDataSource(t,e,_)},t.prototype.fitContent=function(){var t=new kn(2);t.setFitContent(),this._invalidate(t)},t.prototype.setTargetLogicalRange=function(t){var e=new kn(2);e.applyRange(t),this._invalidate(e)},t.prototype.resetTimeScale=function(){var t=new kn(2);t.resetTimeScale(),this._invalidate(t)},t.prototype.setBarSpacing=function(t){var e=new kn(2);e.setBarSpacing(t),this._invalidate(e)},t.prototype.setRightOffset=function(t){var e=new kn(2);e.setRightOffset(t),this._invalidate(e)},t.prototype.defaultVisiblePriceScaleId=function(){return this._options.rightPriceScale.visible?"right":"left"},t.prototype.moveSeriesToPane=function(t,e,n){if(n!==e&&!this._suppressSeriesMoving){t.options().paneIndex!==n&&t.applyOptions({paneIndex:n});var C=this.paneForSource(t);null==C||C.removeDataSource(t);var _=this.createPane({index:n});this._addSeriesToPane(t,_)}},t.prototype.backgroundBottomColor=function(){return this._backgroundBottomColor},t.prototype.backgroundTopColor=function(){return this._backgroundTopColor},t.prototype.backgroundColorAtYPercentFromTop=function(t){var e=this._backgroundBottomColor,n=this._backgroundTopColor;if(e===n)return e;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this._gradientColorsCache||this._gradientColorsCache.topColor!==n||this._gradientColorsCache.bottomColor!==e)this._gradientColorsCache={topColor:n,bottomColor:e,colors:new Map};else{var C=this._gradientColorsCache.colors.get(t);if(void 0!==C)return C}var _,ts,ta,tl,th,tc,td,tu,tp,t8,tf,tv,tg,tm,ty=(_=n,ts=e,ta=t/100,th=(tl=v(ue(_),4))[0],tc=tl[1],td=tl[2],tu=tl[3],t8=(tp=v(ue(ts),4))[0],tf=tp[1],tv=tp[2],tg=tp[3],"rgba("+(tm=[ie(th+ta*(t8-th)),ie(tc+ta*(tf-tc)),ie(td+ta*(tv-td)),oe(tu+ta*(tg-tu))])[0]+", "+tm[1]+", "+tm[2]+", "+tm[3]+")");return this._gradientColorsCache.colors.set(t,ty),ty},t.prototype.getPaneIndex=function(t){return this._panesToIndex.get(t)},t.prototype._paneInvalidationMask=function(t,e){var n=new kn(e);if(null!==t){var C=this._panes.indexOf(t);n.invalidatePane(C,{level:e})}return n},t.prototype.getIndicators=function(){var t=this;return this._options.indicators.map(function(e){return e.id===t._options.activeIndicatorId?f(f({},e),{active:!0}):e})},t.prototype._invalidationMaskForSource=function(t,e){return void 0===e&&(e=2),this._paneInvalidationMask(this.paneForSource(t),e)},t.prototype._invalidate=function(t){this._invalidateHandler&&this._invalidateHandler(t),this._panes.forEach(function(t){return t.grid().paneView().update()})},t.prototype._createSeries=function(t,e,n){var C=new yi(this,t,e);return this._addSeriesToPane(C,n),t.isMain&&this.updateMainSeries(),C},t.prototype._addSeriesToPane=function(t,e){var n=t.options(),C=n.priceScaleId,_=n.isMain,ts=void 0!==C?C:this.defaultVisiblePriceScaleId();e.addDataSource(t,ts),en(ts)||t.applyOptions(t.options()),_&&(this._mainSeries=t,this._updateMainSeriesIndicators())},t.prototype._addIndicator=function(t){var e,n,C,_=this._options,ts=_.indicatorsConfig,ta=_.indicators,tl=ts.defaultOptions[t];tl.circlesBackground,tl.label,tl.background,tl.histogramColors;var th=m(tl,["circlesBackground","label","background","histogramColors"]),tc=String(Date.now()),td=th.anotherPane?this._panes.length:this.mainPaneIndex;th.anotherPane&&this.createPane({index:td});var tu={type:t,id:tc,options:f(f({},z(th)),{paneIndex:td})};this.applyOptions({activeIndicatorId:tc,indicators:y(y([],v(ta),!1),[tu],!1)}),null===(n=(e=this.chartWidget).activeToolChangeHandler)||void 0===n||n.call(e,{type:t,options:tu.options}),null===(C=ts.eventHandler)||void 0===C||C.call(ts,"add",t)},t.prototype._removeToolsOnPaneDelete=function(t){var e=function(e){return e.options.paneIndex!==t};this._options.drawnTools.some(e)&&(this._options.drawnTools=this._options.drawnTools.filter(e)),this._options.indicators.some(e)&&(this._options.indicators=this._options.indicators.filter(e))},t.prototype._removeActiveIndicator=function(){var t,e,n,C,_=this.getActiveIndicator();if(_){var ts=this._options,ta=ts.indicatorsConfig,tl=ts.indicators;if(null===(t=ta.eventHandler)||void 0===t||t.call(ta,"remove",_.type),null===(e=this.applyOptions)||void 0===e||e.call(this,{activeIndicatorId:null,indicators:tl.filter(function(t){return t.id!==_.id})},!_.options.anotherPane),_.options.anotherPane){var th=_.options.paneIndex;void 0!==th&&this.removePane({index:th})}null===(C=(n=this.chartWidget).activeToolChangeHandler)||void 0===C||C.call(n,{})}},t.prototype._removeActiveDrawingTool=function(){var t,e;this.options().activeDrawingTool&&(this.applyOptions({activeDrawingTool:{options:{notSave:!0}}}),null===(e=null===(t=this._drawingTool)||void 0===t?void 0:t.switchOff)||void 0===e||e.call(t))},t.prototype.invalidatePanesOptions=function(){this._panesOptionsInvalidated=!0},t.prototype._updateMainSeriesIndicators=function(){var t,e=this.getIndicators();null===(t=this.getMainSeries())||void 0===t||t.setIndicators(e),this._panesOptionsInvalidated&&(this._panesOptionsInvalidated=!1,this.updatePanesOptions())},t.prototype._updateDrawingToolIfNeeded=function(t){var e,n,C,_=t.activeDrawingTool,ts=this.options().activeDrawingTool,ta=(null==_?void 0:_.type)!==(null==ts?void 0:ts.type),tl=(null===(e=null==ts?void 0:ts.options)||void 0===e?void 0:e.lineColor)!==(null===(n=null==_?void 0:_.options)||void 0===n?void 0:n.lineColor);ta&&this._updateOnDrawingModeChange();var th=null===(C=null==ts?void 0:ts.options)||void 0===C?void 0:C.lineColor;tl&&th&&this.changeCrosshairColor(d(th,this._options.drawingConfig))},t.prototype._updateOnDrawingModeChange=function(){var t,e,n,C,_=this._options.activeDrawingTool;this._drawingTool&&(null===(e=(t=this._drawingTool).destroy)||void 0===e||e.call(t),this._setInitialCrosshairOptions()),_&&(this._saveCrosshairOptions(),this.isDrawnToolEditing()||null===(C=(n=this._options.drawingConfig).eventHandler)||void 0===C||C.call(n,"add",_.type)),this._drawingTool=_&&_n[_.type]?new _n[_.type](this):void 0},t.prototype._createPanesInitial=function(){this._options.panes.length?this._updatePanes(this._options):this.createPane()},t.prototype._updatePanes=function(t){if(t.panes){for(var e=this._panes.length;t.panes.length>e;)this.createPane({index:e,updatePanesIndexes:!1}),e++;for(;t.panes.length<e;)this.removePane({index:e-1,updatePanesIndexes:!1}),e--}this._panes.forEach(function(e){e.applyScaleOptions(t)})},t.prototype._updateDrawnToolsIfNeeded=function(t){var e=this;this._drawnTools.forEach(function(t){var n=t.getId();e.options().drawnTools.some(function(t){return t.id===n})||e._drawnTools.delete(n)}),this.options().drawnTools.forEach(function(t){var n=t.id,C=e._drawnTools.get(n);if(C)C.setData(t);else{var _=Cn[t.type];_&&e._drawnTools.set(n,new Mn(e,_,t))}})},t.prototype._getBackgroundColor=function(t){var e=this._options.layout;return"gradient"===e.background.type?0===t?e.background.topColor:e.background.bottomColor:e.background.color},t.prototype._updatePaneIndexes=function(){var t=this;this._setPrevIndexToPanes(),this._panesToIndex.clear(),this._panes.forEach(function(e,n){t._panesToIndex.set(e,n)})},t.prototype._updateToolsPanesIndexes=function(t){var e,n,C=this._updateDrawingToolsPaneIndexes()||t,_=this._updateIndicatorsPaneIndexes()||t;null===(n=(e=this.chartWidget).saveHandler)||void 0===n||n.call(e,f(f({},C?{drawnTools:this._options.drawnTools}:{}),_?{panes:this._options.panes,indicators:this._options.indicators}:{})),_&&this._updateMainSeriesIndicators()},t.prototype._setPrevIndexToPanes=function(){this._prevIndexToPanes=Array.from(this._panesToIndex.keys()).reduce(function(t,e,n){return t[n]=e,t},{})},t.prototype._updateDrawingToolsPaneIndexes=function(){var t=this,e=!1,n=this.options(),C=n.drawnTools,_=n.activeDrawingTool;return y(y([],v(C),!1),[_],!1).forEach(function(n){if(null==n?void 0:n.options){var C=n.options.paneIndex;if(R(C)){var _=t._prevIndexToPanes[C];if(_){var ts=t.getPaneIndex(_);void 0!==ts&&(n.options.paneIndex!==ts&&(e=!0),n.options.paneIndex=ts)}}}}),e},t.prototype._updateIndicatorsPaneIndexes=function(){var t=this,e=!1;return y([],v(this._options.indicators),!1).forEach(function(n){if(n){var C=n.options.paneIndex;if(R(C)){var _=t._prevIndexToPanes[C];if(_){var ts=t.getPaneIndex(_);void 0!==ts&&(n.options.paneIndex!==ts&&(e=!0),n.options.paneIndex=ts)}}}}),this.updatePanesOptions(),e},t}(),Ei=function(){function t(t,e){this.w=t,this.h=e}return t.prototype.equals=function(t){return this.w===t.w&&this.h===t.h},t}();function Mi(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function ki(t){var e=O(t.getContext("2d"));return e.setTransform(1,0,0,1,0,0),e}function Ti(t,e){var n=t.createElement("canvas"),C=Mi(n);return n.style.width=e.w+"px",n.style.height=e.h+"px",n.width=e.w*C,n.height=e.h*C,n}function Ii(t,e){var n=O(t.ownerDocument).createElement("canvas");t.appendChild(n);var C,_=(void 0===C&&(C=r),new l(n,C));return _.resizeCanvas({width:e.w,height:e.h}),_}!function(t){t[t.ResetClick=500]="ResetClick",t[t.LongTap=240]="LongTap"}(xi||(xi={}));var Hi=function(){function t(t,e,n){this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._target=t,this._handler=e,this._options=n,this._init()}return t.prototype.destroy=function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()},t.prototype._mouseEnterHandler=function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var n=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",n)},this._target.addEventListener("mousemove",n),Oi(t)&&this._mouseMoveHandler(t);var C=this._makeCompatEvent(t);this._processEvent(C,this._handler.mouseEnterEvent)},t.prototype._resetClickTimeout=function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null},t.prototype._mouseMoveHandler=function(t){if(!this._mousePressed||Oi(t)){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}},t.prototype._mouseMoveWithDownHandler=function(t){if((!("button"in t)||0===t.button)&&null===this._startPinchMiddlePoint){var e=Oi(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;var n=this._makeCompatEvent(t),C=D(this._mouseMoveStartPosition),_=Math.abs(C.x-n.pageX),ts=Math.abs(C.y-n.pageY),ta=_+ts>5;if(ta||!e){if(ta&&!this._moveExceededManhattanDistance&&e){var tl=.5*_,th=ts>=tl&&!this._options.treatVertTouchDragAsPageScroll,tc=tl>ts&&!this._options.treatHorzTouchDragAsPageScroll;th||tc||(this._preventDragProcess=!0)}ta&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(n,this._handler.pressedMouseMoveEvent),e&&Di(t))}}}},t.prototype._mouseUpHandler=function(t){if(!("button"in t)||0===t.button){var e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),Oi(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),Oi(t)&&(Di(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}},t.prototype._clearLongTapTimeout=function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)},t.prototype._mouseDownHandler=function(t){if(!("button"in t)||0===t.button){var e=this._makeCompatEvent(t);this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,Oi(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var n=this._mouseMoveWithDownHandler.bind(this),C=this._mouseUpHandler.bind(this),_=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){_.removeEventListener("touchmove",n),_.removeEventListener("touchend",C),_.removeEventListener("mousemove",n),_.removeEventListener("mouseup",C)},_.addEventListener("touchmove",n,{passive:!1}),_.addEventListener("touchend",C,{passive:!1}),this._clearLongTapTimeout(),Oi(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),240):(_.addEventListener("mousemove",n),_.addEventListener("mouseup",C)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}},t.prototype._init=function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e=this._target.ownerDocument,n=function(e){t._handler.mouseDownOutsideEvent&&(e.composed&&t._target.contains(e.composedPath()[0])||e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){e.removeEventListener("mousedown",n),e.removeEventListener("touchstart",n)},e.addEventListener("mousedown",n),e.addEventListener("touchstart",n,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),zt||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",function(){},{passive:!1})},t.prototype._initPinch=function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",function(e){return t._checkPinchState(e.touches)},{passive:!0}),this._target.addEventListener("touchmove",function(e){if(2===e.touches.length&&null!==t._startPinchMiddlePoint&&void 0!==t._handler.pinchEvent){var n=Pi(e.touches[0],e.touches[1])/t._startPinchDistance;t._handler.pinchEvent(t._startPinchMiddlePoint,n),Di(e)}},{passive:!1}),this._target.addEventListener("touchend",function(e){t._checkPinchState(e.touches)}))},t.prototype._checkPinchState=function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)},t.prototype._startPinch=function(t){var e=Ni(this._target);this._startPinchMiddlePoint={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=Pi(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()},t.prototype._stopPinch=function(){null!==this._startPinchMiddlePoint&&(this._startPinchMiddlePoint=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())},t.prototype._mouseLeaveHandler=function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)},t.prototype._longTapHandler=function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0},t.prototype._processEvent=function(t,e){e&&e.call(this._handler,t)},t.prototype._makeCompatEvent=function(t){e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var e,n=Ni(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-n.left,localY:e.clientY-n.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?"mouse":"touch",view:t.view}},t}();function Ni(t){return t.getBoundingClientRect()||{left:0,top:0}}function Pi(t,e){var n=t.clientX-e.clientX,C=t.clientY-e.clientY;return Math.sqrt(n*n+C*C)}function Oi(t){return Boolean(t.touches)}function Di(t){t.cancelable&&t.preventDefault()}var Ai,Li=2*(dn()-2)+1,Ri=function(){function t(t,e,n,C){if(this._startY=0,this._deltaY=0,this._totalHeight=0,this._totalStretch=0,this._maxPaneHeight=0,this._pixelStretchFactor=0,this._mouseActive=!1,this._chartWidget=t,this._paneA=t.paneWidgets()[e],this._paneB=t.paneWidgets()[n],this._rowElement=document.createElement("tr"),this._rowElement.style.height="1px",this._cell=document.createElement("td"),this._cell.style.position="relative",this._cell.style.padding="0",this._cell.style.margin="0",this._cell.style.height="1px",this._cell.setAttribute("colspan","3"),this._updateBorderColor(),this._rowElement.appendChild(this._cell),C)this._handleContainer=null,this._handle=null,this._mouseEventHandler=null;else{this._handleContainer=document.createElement("div"),this._handleContainer.style.position="absolute",this._handleContainer.style.zIndex="3",this._setHandleContainerStylesByPadding(0),this._handleContainer.style.cursor="row-resize",this._handleContainer.style.width="100%",this._handle=document.createElement("div"),this._handle.style.height=Li+"px",this._handle.style.backgroundColor="",this._handleContainer.appendChild(this._handle),this._cell.appendChild(this._handleContainer);var _={mouseEnterEvent:this._mouseOverEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseDownEvent:this._mouseDownEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this)};this._mouseEventHandler=new Hi(this._handleContainer,_,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}}return t.prototype.destroy=function(){null!==this._mouseEventHandler&&this._mouseEventHandler.destroy()},t.prototype.getElement=function(){return this._rowElement},t.prototype.getSize=function(){return new Ei(this._paneA.getSize().w,1)},t.prototype.getImage=function(){var t=this.getSize(),e=Ti(document,t),n=ki(e);return n.fillStyle=this._getTimeScaleBorderColor(),n.fillRect(0,0,t.w,t.h),e},t.prototype.update=function(){this._updateBorderColor()},t.prototype._updateBorderColor=function(){this._cell.style.background=this._getTimeScaleBorderColor()},t.prototype._mouseOverEvent=function(t){if(null!==this._handle){var e=he(this._getTimeScaleBorderColor(),.6);this._handle.style.backgroundColor=e}},t.prototype._mouseLeaveEvent=function(t){null===this._handle||this._mouseActive||(this._handle.style.backgroundColor="")},t.prototype._mouseDownEvent=function(t){this._startY=t.pageY,this._deltaY=0,this._totalHeight=this._paneA.getSize().h+this._paneB.getSize().h,this._totalStretch=this._paneA.stretchFactor()+this._paneB.stretchFactor(),this._setHandleContainerStylesByPadding(document.documentElement.clientHeight),this._maxPaneHeight=this._totalHeight-30,this._pixelStretchFactor=this._totalStretch/this._totalHeight,this._mouseActive=!0},t.prototype._pressedMouseMoveEvent=function(t){this._deltaY=t.pageY-this._startY;var e=this._paneA.getSize().h,n=Le(e+this._deltaY,30,this._maxPaneHeight)*this._pixelStretchFactor,C=this._totalStretch-n;this._paneA.setStretchFactor(n),this._paneB.setStretchFactor(C),this._chartWidget.adjustSize(),this._paneA.getSize().h!==e&&(this._startY=t.pageY)},t.prototype._setHandleContainerStylesByPadding=function(t){null!==this._handleContainer&&(this._handleContainer.style.padding=t+"px 0",this._handleContainer.style.top=(1-Li)/2-t+"px")},t.prototype._mouseUpEvent=function(t){var e,n;this._startY=0,this._deltaY=0,this._totalHeight=0,this._totalStretch=0,this._maxPaneHeight=0,this._pixelStretchFactor=0,this._mouseActive=!1,this._setHandleContainerStylesByPadding(0),this._chartWidget.model().updatePanesOptions(),this._mouseLeaveEvent(t),null===(n=(e=this._chartWidget).saveHandler)||void 0===n||n.call(e,{panes:this._chartWidget.options().panes,indicators:this._chartWidget.options().indicators})},t.prototype._getTimeScaleBorderColor=function(){return this._chartWidget.options().timeScale.borderColor},t}();function Fi(t,e){return t.position-e.position}function Bi(t,e,n){var C=(t.position-e.position)/(t.time-e.time);return Math.sign(C)*Math.min(Math.abs(C),n)}!function(t){t[t.MaxStartDelay=50]="MaxStartDelay",t[t.EpsilonDistance=1]="EpsilonDistance"}(Ai||(Ai={}));var Vi,zi=function(){function t(t,e,n,C){this._position1=null,this._position2=null,this._position3=null,this._position4=null,this._animationStartPosition=null,this._durationMsecs=0,this._speedPxPerMsec=0,this._terminated=!1,this._minSpeed=t,this._maxSpeed=e,this._dumpingCoeff=n,this._minMove=C}return t.prototype.addPosition=function(t,e){if(null!==this._position1){if(this._position1.time===e)return void(this._position1.position=t);if(Math.abs(this._position1.position-t)<this._minMove)return}this._position4=this._position3,this._position3=this._position2,this._position2=this._position1,this._position1={time:e,position:t}},t.prototype.start=function(t,e){if(null!==this._position1&&null!==this._position2&&!(e-this._position1.time>50)){var n=0,C=Bi(this._position1,this._position2,this._maxSpeed),_=Fi(this._position1,this._position2),ts=[C],ta=[_];if(n+=_,null!==this._position3){var tl=Bi(this._position2,this._position3,this._maxSpeed);if(Math.sign(tl)===Math.sign(C)){var th=Fi(this._position2,this._position3);if(ts.push(tl),ta.push(th),n+=th,null!==this._position4){var tc=Bi(this._position3,this._position4,this._maxSpeed);if(Math.sign(tc)===Math.sign(C)){var td=Fi(this._position3,this._position4);ts.push(tc),ta.push(td),n+=td}}}}for(var tu,tp,t8,tf=0,tv=0;tv<ts.length;++tv)tf+=ta[tv]/n*ts[tv];Math.abs(tf)<this._minSpeed||(this._animationStartPosition={position:t,time:e},this._speedPxPerMsec=tf,this._durationMsecs=(tu=Math.abs(tf),Math.log(-(1*(t8=Math.log(tp=this._dumpingCoeff))/tu))/t8))}},t.prototype.getPosition=function(t){var e=O(this._animationStartPosition),n=t-e.time;return e.position+this._speedPxPerMsec*(Math.pow(this._dumpingCoeff,n)-1)/Math.log(this._dumpingCoeff)},t.prototype.finished=function(t){return null===this._animationStartPosition||this._progressDuration(t)===this._durationMsecs},t.prototype.terminated=function(){return this._terminated},t.prototype.terminate=function(){this._terminated=!0},t.prototype._progressDuration=function(t){return Math.min(t-O(this._animationStartPosition).time,this._durationMsecs)},t}(),Wi=function(){function t(t,e,n,C){this._textWidthCache=new Qn(200),this._fontSize=0,this._color="",this._font="",this._keys=[],this._hash=new Map,this._fontSize=t,this._color=e,this._font=wn(t,n,C)}return t.prototype.destroy=function(){this._textWidthCache.reset(),this._keys=[],this._hash.clear()},t.prototype.paintTo=function(t,e,n,C,_){var ts=this._getLabelImage(t,e);if("left"!==_){var ta=Mi(t.canvas);n-=Math.floor(ts.textWidth*ta)}C-=Math.floor(ts.height/2),t.drawImage(ts.canvas,n,C,ts.width,ts.height)},t.prototype._getLabelImage=function(t,e){var n,C=this;if(this._hash.has(e))n=P(this._hash.get(e));else{if(this._keys.length>=200){var _=P(this._keys.shift());this._hash.delete(_)}var ts=Mi(t.canvas),ta=Math.ceil(this._fontSize/4.5),tl=Math.round(this._fontSize/10),th=Math.ceil(this._textWidthCache.measureText(t,e)),tc=Be(Math.round(th+2*ta)),td=Be(this._fontSize+2*ta),tu=Ti(document,new Ei(tc,td));n={text:e,textWidth:Math.round(Math.max(1,th)),width:Math.ceil(tc*ts),height:Math.ceil(td*ts),canvas:tu},0!==th&&(this._keys.push(n.text),this._hash.set(n.text,n)),ve(t=ki(n.canvas),ts,function(){t.font=C._font,t.fillStyle=C._color,t.fillText(e,0,td-ta-tl)})}return n},t}();!function(t){t[t.Default=0]="Default",t[t.NsResize=1]="NsResize"}(Vi||(Vi={}));var ji,Gi,Ui=function(){function t(t,e,n,C){var _=this;this._priceScale=null,this._size=null,this._updateTimeout=null,this._mousedown=!1,this._widthCache=new Qn(50),this._tickMarksCache=new Wi(11,"#000"),this._color=null,this._font=null,this._prevOptimalWidth=0,this._canvasConfiguredHandler=function(){_._recreateTickMarksCache(_._rendererOptionsProvider.options()),_._pane.chart().model().lightUpdate()},this._topCanvasConfiguredHandler=function(){_._pane.chart().model().lightUpdate()},this._pane=t,this._options=e,this._rendererOptionsProvider=n,this._isLeft="left"===C,this._cell=document.createElement("div"),this._cell.style.height="100%",this._cell.style.overflow="hidden",this._cell.style.width="25px",this._cell.style.left="0",this._cell.style.position="relative",this._canvasBinding=Ii(this._cell,new Ei(16,16)),this._canvasBinding.subscribeCanvasConfigured(this._canvasConfiguredHandler);var ts=this._canvasBinding.canvas;ts.style.position="absolute",ts.style.zIndex="1",ts.style.left="0",ts.style.top="0",this._topCanvasBinding=Ii(this._cell,new Ei(16,16)),this._topCanvasBinding.subscribeCanvasConfigured(this._topCanvasConfiguredHandler);var ta=this._topCanvasBinding.canvas;ta.style.position="absolute",ta.style.zIndex="2",ta.style.left="0",ta.style.top="0";var tl={mouseDownEvent:this._mouseDownEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseDownOutsideEvent:this._mouseDownOutsideEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseDoubleClickEvent:this._mouseDoubleClickEvent.bind(this),mouseEnterEvent:this._mouseEnterEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this)};this._mouseEventHandler=new Hi(this._topCanvasBinding.canvas,tl,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}return t.prototype.destroy=function(){this._mouseEventHandler.destroy(),this._topCanvasBinding.unsubscribeCanvasConfigured(this._topCanvasConfiguredHandler),this._topCanvasBinding.destroy(),this._canvasBinding.unsubscribeCanvasConfigured(this._canvasConfiguredHandler),this._canvasBinding.destroy(),null!==this._priceScale&&this._priceScale.onMarksChanged().unsubscribeAll(this),this._priceScale=null,null!==this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=null),this._tickMarksCache.destroy()},t.prototype.getElement=function(){return this._cell},t.prototype.lineColor=function(){return O(this._priceScale).options().borderColor},t.prototype.textColor=function(){return this._options.textColor},t.prototype.fontSize=function(){return this._options.fontSize},t.prototype.baseFont=function(){return wn(this.fontSize(),this._options.fontFamily)},t.prototype.rendererOptions=function(){var t=this._rendererOptionsProvider.options(),e=this._color!==t.color,n=this._font!==t.font;return(e||n)&&(this._recreateTickMarksCache(t),this._color=t.color),n&&(this._widthCache.reset(),this._font=t.font),t},t.prototype.optimalWidth=function(){if(null===this._priceScale)return 0;var t=34,e=this.rendererOptions(),n=ki(this._canvasBinding.canvas),C=this._priceScale.marks();n.font=this.baseFont(),C.length>0&&(t=Math.max(this._widthCache.measureText(n,C[0].label),this._widthCache.measureText(n,C[C.length-1].label)));for(var _=this._backLabels(),ts=_.length;ts--;){var ta=this._widthCache.measureText(n,_[ts].text());ta>t&&(t=ta)}var tl=this._priceScale.firstValue();if(null!==tl&&null!==this._size){var th=this._priceScale.coordinateToPrice(1,tl),tc=this._priceScale.coordinateToPrice(this._size.h-2,tl);t=Math.max(t,this._widthCache.measureText(n,this._priceScale.formatPrice(Math.floor(Math.min(th,tc))+.11111111111111,tl)),this._widthCache.measureText(n,this._priceScale.formatPrice(Math.ceil(Math.max(th,tc))-.11111111111111,tl)))}var td=Math.ceil(e.borderSize+e.tickLength+e.paddingInner+e.paddingOuter+t);return td+td%2},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new S("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this._size&&this._size.equals(t)||(this._size=t,this._topCanvasBinding.resizeCanvas({width:t.w,height:t.h}),this._canvasBinding.resizeCanvas({width:t.w,height:t.h}),this._cell.style.width=t.w+"px",this._cell.style.height=t.h+"px",this._cell.style.minWidth=t.w+"px")},t.prototype.getWidth=function(){return O(this._size).w},t.prototype.setPriceScale=function(t){this._priceScale!==t&&(null!==this._priceScale&&this._priceScale.onMarksChanged().unsubscribeAll(this),this._priceScale=t,t.onMarksChanged().subscribe(this._onMarksChanged.bind(this),this))},t.prototype.priceScale=function(){return this._priceScale},t.prototype.reset=function(){var t=this._pane.state();this._pane.chart().model().resetPriceScale(t,O(this.priceScale()))},t.prototype.paint=function(t){if(null!==this._size){if(1!==t){var e=ki(this._canvasBinding.canvas);this._alignLabels(),this._drawBackground(e,this._canvasBinding.pixelRatio),this._drawBorder(e,this._canvasBinding.pixelRatio),this._drawTickMarks(e,this._canvasBinding.pixelRatio),this._drawBackLabels(e,this._canvasBinding.pixelRatio)}var n=ki(this._topCanvasBinding.canvas),C=this._size.w,_=this._size.h;ve(n,this._topCanvasBinding.pixelRatio,function(){n.clearRect(0,0,C,_)}),this._drawCrosshairAndDrawingLabel(n,this._topCanvasBinding.pixelRatio)}},t.prototype.getImage=function(){return this._canvasBinding.canvas},t.prototype._mouseDownEvent=function(t){if(null!==this._priceScale&&!this._priceScale.isEmpty()&&this._pane.chart().options().handleScale.axisPressedMouseMove.price){var e=this._pane.chart().model(),n=this._pane.state();this._mousedown=!0,e.startScalePrice(n,this._priceScale,t.localY)}},t.prototype._pressedMouseMoveEvent=function(t){if(null!==this._priceScale&&this._pane.chart().options().handleScale.axisPressedMouseMove.price){var e=this._pane.chart().model(),n=this._pane.state(),C=this._priceScale;e.scalePriceTo(n,C,t.localY)}},t.prototype._mouseDownOutsideEvent=function(){if(null!==this._priceScale&&this._pane.chart().options().handleScale.axisPressedMouseMove.price){var t=this._pane.chart().model(),e=this._pane.state(),n=this._priceScale;this._mousedown&&(this._mousedown=!1,t.endScalePrice(e,n))}},t.prototype._mouseUpEvent=function(t){if(null!==this._priceScale&&this._pane.chart().options().handleScale.axisPressedMouseMove.price){var e=this._pane.chart().model(),n=this._pane.state();this._mousedown=!1,e.endScalePrice(n,this._priceScale)}},t.prototype._mouseDoubleClickEvent=function(t){this._pane.chart().options().handleScale.axisDoubleClickReset&&this.reset()},t.prototype._mouseEnterEvent=function(t){null!==this._priceScale&&(!this._pane.chart().model().options().handleScale.axisPressedMouseMove.price||this._priceScale.isPercentage()||this._priceScale.isIndexedTo100()||this._setCursor(1))},t.prototype._mouseLeaveEvent=function(t){this._setCursor(0)},t.prototype._backLabels=function(){var t=this,e=[],n=null===this._priceScale?void 0:this._priceScale;return function(C){for(var _=0;_<C.length;++_)for(var ts=C[_].priceAxisViews(t._pane.state(),n),ta=0;ta<ts.length;ta++)e.push(ts[ta])}(this._pane.state().orderedSources()),e},t.prototype._drawBackground=function(t,e){var n=this;if(null!==this._size){var C=this._size.w,_=this._size.h;ve(t,e,function(){var e=n._pane.state().model(),ts=e.backgroundTopColor(),ta=e.backgroundBottomColor();ts===ta?ye(t,0,0,C,_,ts):_e(t,0,0,C,_,ts,ta)})}},t.prototype._drawBorder=function(t,e){if(null!==this._size&&null!==this._priceScale&&this._priceScale.options().borderVisible){t.save(),t.fillStyle=this.lineColor();var n,C=Math.max(1,Math.floor(this.rendererOptions().borderSize*e));n=this._isLeft?Math.floor(this._size.w*e)-C:0,t.fillRect(n,0,C,Math.ceil(this._size.h*e)),t.restore()}},t.prototype._drawTickMarks=function(t,e){var n,C,_,ts;if(null!==this._size&&null!==this._priceScale){var ta=this._priceScale.marks();t.save(),t.strokeStyle=this.lineColor(),t.font=this.baseFont(),t.fillStyle=this.lineColor();var tl=this.rendererOptions(),th=this._priceScale.options().borderVisible&&this._priceScale.options().drawTicks,tc=this._isLeft?Math.floor((this._size.w-tl.tickLength)*e-tl.borderSize*e):Math.floor(tl.borderSize*e),td=this._isLeft?Math.round(tc-tl.paddingInner*e):Math.round(tc+tl.tickLength*e+tl.paddingInner*e),tu=this._isLeft?"right":"left",tp=Math.max(1,Math.floor(e)),t8=Math.floor(.5*e);if(th){var tf=Math.round(tl.tickLength*e);t.beginPath();try{for(var tv=g(ta),tg=tv.next();!tg.done;tg=tv.next()){var tm=tg.value;t.rect(tc,Math.round(tm.coord*e)-t8,tf,tp)}}catch(ty){n={error:ty}}finally{try{tg&&!tg.done&&(C=tv.return)&&C.call(tv)}finally{if(n)throw n.error}}t.fill()}t.fillStyle=this.textColor();try{for(var t$=g(ta),tS=t$.next();!tS.done;tS=t$.next())tm=tS.value,this._tickMarksCache.paintTo(t,tm.label,td,Math.round(tm.coord*e),tu)}catch(tb){_={error:tb}}finally{try{tS&&!tS.done&&(ts=t$.return)&&ts.call(t$)}finally{if(_)throw _.error}}t.restore()}},t.prototype._alignLabels=function(){if(null!==this._size&&null!==this._priceScale){var t=this._size.h/2,e=[],n=this._priceScale.orderedSources().slice(),C=this._pane.state(),_=this.rendererOptions();this._priceScale===C.defaultPriceScale()&&this._pane.state().orderedSources().forEach(function(t){C.isOverlay(t)&&n.push(t)});var ts=this._priceScale.dataSources()[0],ta=this._priceScale;n.forEach(function(n){var _=n.priceAxisViews(C,ta);_.forEach(function(t){t.setFixedCoordinate(null),t.isVisible()&&e.push(t)}),ts===n&&_.length>0&&(t=_[0].coordinate())});var tl=e.filter(function(e){return e.coordinate()<=t}),th=e.filter(function(e){return e.coordinate()>t});if(tl.sort(function(t,e){return e.coordinate()-t.coordinate()}),tl.length&&th.length&&th.push(tl[0]),th.sort(function(t,e){return t.coordinate()-e.coordinate()}),e.forEach(function(t){return t.setFixedCoordinate(t.coordinate())}),this._priceScale.options().alignLabels){for(var tc,td,tu=1;tu<tl.length;tu++){var tp=tl[tu],t8=(tc=tl[tu-1]).height(_,!1);tp.coordinate()>(td=tc.getFixedCoordinate())-t8&&tp.setFixedCoordinate(td-t8)}for(var tf=1;tf<th.length;tf++)tp=th[tf],t8=(tc=th[tf-1]).height(_,!0),tp.coordinate()<(td=tc.getFixedCoordinate())+t8&&tp.setFixedCoordinate(td+t8)}}},t.prototype._drawBackLabels=function(t,e){var n=this;if(null!==this._size){t.save();var C=this._size,_=this._backLabels(),ts=this.rendererOptions(),ta=this._isLeft?"right":"left";_.forEach(function(_){if(_.isAxisLabelVisible()){var tl=_.renderer(O(n._priceScale));t.save(),tl.draw(t,ts,n._widthCache,C.w,ta,e),t.restore()}}),t.restore()}},t.prototype._drawCrosshairAndDrawingLabel=function(t,e){var n=this;if(null!==this._size&&null!==this._priceScale){t.save();var C=this._size,_=this._pane.chart().model(),ts=[],ta=this._pane.state(),tl=_.drawingToolSource();if(tl){var th=tl.priceAxisViews(ta,this._priceScale);ts.push(th)}var tc=_.crosshairSource().priceAxisViews(ta,this._priceScale);ts.push(tc);var td=this.rendererOptions(),tu=this._isLeft?"right":"left";ts.forEach(function(_){_.forEach(function(_){t.save(),_.renderer(O(n._priceScale)).draw(t,td,n._widthCache,C.w,tu,e),t.restore()})}),t.restore()}},t.prototype._setCursor=function(t){this._cell.style.cursor=1===t?"ns-resize":"default"},t.prototype._onMarksChanged=function(){var t=this,e=this.optimalWidth();if(this._prevOptimalWidth<e){var n=this._pane.chart();null===this._updateTimeout&&(this._updateTimeout=setTimeout(function(){n&&n.model().fullUpdate(),t._updateTimeout=null},100))}this._prevOptimalWidth=e},t.prototype._recreateTickMarksCache=function(t){this._tickMarksCache.destroy(),this._tickMarksCache=new Wi(t.fontSize,t.color,t.fontFamily)},t}(),Zi=zt;function qi(t,e,n,C,_){t.drawBackground&&t.drawBackground(e,n,C,_)}function Ki(t,e,n,C,_,ts){t.draw(e,n,C,_)}function Yi(t,e){return t.paneViews(e)}function Xi(t,e){return void 0!==t.topPaneViews?t.topPaneViews(e):[]}!function(t){t[t.MinScrollSpeed=.2]="MinScrollSpeed",t[t.MaxScrollSpeed=7]="MaxScrollSpeed",t[t.DumpingCoeff=.997]="DumpingCoeff",t[t.ScrollMinMove=15]="ScrollMinMove"}(ji||(ji={})),function(t){t.ESC="Escape",t.BACKSPACE="Backspace",t.DELETE="Delete"}(Gi||(Gi={}));var $i,Ji,Qi=function(){function t(t,e){var n=this;this._size=new Ei(0,0),this._leftPriceAxisWidget=null,this._rightPriceAxisWidget=null,this._startScrollingPos=null,this._isScrolling=!1,this._clicked=new Delegate,this._prevPinchScale=0,this._longTap=!1,this._startTrackPoint=null,this._exitTrackingModeOnNextTry=!1,this._initCrosshairPosition=null,this._scrollXAnimation=null,this._pressedMoving=null,this._ignoreClickAfterMouseDownHandling=!1,this.getPaneMiddlePoint=function(){var t=n._topCanvasBinding.canvasSize;return{x:t.width/2,y:t.height/2}},this._canvasConfiguredHandler=function(){return n._state&&n._model().lightUpdate()},this._topCanvasConfiguredHandler=function(){return n._state&&n._model().lightUpdate()},this._chart=t,this._state=e,this._state.onDestroyed().subscribe(this._onStateDestroyed.bind(this),this,!0),this._paneCell=document.createElement("td"),this._paneCell.style.padding="0";var C=this.chart().options(),_=document.createElement("div");this._paneWrapper=_,_.classList.add("CHART_CANVAS_CONTAINER"),_.style.width="100%",_.style.height="100%",_.style.position="relative",_.style.cursor=C.cursor,this._leftAxisCell=document.createElement("td"),this._leftAxisCell.style.padding="0",this._rightAxisCell=document.createElement("td"),this._rightAxisCell.style.padding="0",this._paneCell.appendChild(_),this._canvasBinding=Ii(_,new Ei(16,16)),this._canvasBinding.subscribeCanvasConfigured(this._canvasConfiguredHandler);var ts=this._canvasBinding.canvas;ts.style.position="absolute",ts.style.zIndex="1",ts.style.left="0",ts.style.top="0",this._topCanvasBinding=Ii(_,new Ei(16,16)),this._topCanvasBinding.subscribeCanvasConfigured(this._topCanvasConfiguredHandler);var ta=this._topCanvasBinding.canvas;ta.style.position="absolute",ta.style.zIndex="2",ta.style.left="0",ta.style.top="0",this._rowElement=document.createElement("tr"),this._rowElement.appendChild(this._leftAxisCell),this._rowElement.appendChild(this._paneCell),this._rowElement.appendChild(this._rightAxisCell),this.updatePriceAxisWidgets();var tl=C.handleScroll;this._mouseEventHandler=new Hi(this._topCanvasBinding.canvas,this,{treatVertTouchDragAsPageScroll:!tl.vertTouchDrag,treatHorzTouchDragAsPageScroll:!tl.horzTouchDrag}),ta.tabIndex=-1,ta.onkeydown=this.keyDownEventHandler.bind(this)}return t.prototype.destroy=function(){null!==this._leftPriceAxisWidget&&this._leftPriceAxisWidget.destroy(),null!==this._rightPriceAxisWidget&&this._rightPriceAxisWidget.destroy(),this._topCanvasBinding.canvas.onkeydown=null,this._topCanvasBinding.unsubscribeCanvasConfigured(this._topCanvasConfiguredHandler),this._topCanvasBinding.destroy(),this._canvasBinding.unsubscribeCanvasConfigured(this._canvasConfiguredHandler),this._canvasBinding.destroy(),null!==this._state&&this._state.onDestroyed().unsubscribeAll(this),this._mouseEventHandler.destroy()},t.prototype.state=function(){return O(this._state)},t.prototype.setState=function(e){null!==this._state&&this._state.onDestroyed().unsubscribeAll(this),this._state=e,null!==this._state&&this._state.onDestroyed().subscribe(t.prototype._onStateDestroyed.bind(this),this,!0),this.updatePriceAxisWidgets()},t.prototype.chart=function(){return this._chart},t.prototype.getElement=function(){return this._rowElement},t.prototype.updatePriceAxisWidgets=function(){if(null!==this._state&&(this._recreatePriceAxisWidgets(),0!==this._model().serieses().length)){if(null!==this._leftPriceAxisWidget){var t=this._state.leftPriceScale();this._leftPriceAxisWidget.setPriceScale(O(t))}if(null!==this._rightPriceAxisWidget){var e=this._state.rightPriceScale();this._rightPriceAxisWidget.setPriceScale(O(e))}}},t.prototype.stretchFactor=function(){return null!==this._state?this._state.stretchFactor():0},t.prototype.setStretchFactor=function(t){this._state&&this._state.setStretchFactor(t)},t.prototype.mouseEnterEvent=function(t){if(this._state){var e=t.localX,n=t.localY;zt||this._setCrosshairPosition(e,n)}},t.prototype.keyDownEventHandler=function(t){(this._model().isDrawingToolActive()||this._model().hasActiveIndicator())&&(t.preventDefault(),t.stopPropagation(),"Escape"===t.code&&this._model().switchOffTool(),"Delete"!==t.code&&"Backspace"!==t.code||this._model().removeActiveTool())},t.prototype.mouseDownEvent=function(t){var e,n,C,_=this._model(),ts=t.localX,ta=t.localY,tl=!zt&&!_.isDrawingToolActive();if(!t.shiftKey&&!_.hasActiveIndicator()&&(_.isDrawnToolEditing()||tl)){var th,tc,td=this.hitTest(ts,ta),tu=null===(e=null==td?void 0:td.object)||void 0===e?void 0:e.hitTestData;if(null!==td&&(null===(tc=th=tu)||void 0===tc?void 0:tc.pressedMouseMoveble)){var tp=td.view.mouseDownHandler&&!td.view.pressedMouseMoveHandler;tp&&(null===(C=(n=td.view).mouseDownHandler)||void 0===C||C.call(n,ts,ta),this._ignoreClickAfterMouseDownHandling=!0);var t8=tu.pointsIndexes,tf=tu.crosshairPoint,tv=null!=tf?tf:{x:ts,y:ta};return this._pressedMoving={view:tp?void 0:td.view,pointsToMove:null!=t8?t8:[],startPoint:tv},void(zt?this.startTrackingMode(tv,tv):this._preventCrosshairMove()||this._setCrosshairPosition(tv.x,tv.y))}}if(this._state){if(this._terminateKineticAnimation(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)O(document.activeElement).blur();else{var tg=document.getSelection();null!==tg&&tg.removeAllRanges()}if(!this._state.defaultPriceScale().isEmpty()&&!_.timeScale().isEmpty()){if(null!==this._startTrackPoint){var tm=_.crosshairSource();this._initCrosshairPosition={x:tm.appliedX(),y:tm.appliedY()},this._startTrackPoint={x:t.localX,y:t.localY}}zt||this._setCrosshairPosition(t.localX,t.localY)}}},t.prototype.mouseMoveEvent=function(t){if(this._state){var e=t.localX,n=t.localY;this._preventCrosshairMove()&&this._clearCrosshairPosition();var C=this._model();if(!zt){if(this._setCrosshairPosition(e,n),C.hasActiveIndicator())this._topCanvasBinding.canvas.style.cursor="inherit";else{var _=this.hitTest(e,n);C.setHoveredSource(_&&_.source&&{source:_.source,object:_.object}),null!==_&&void 0!==_.view.moveHandler&&_.view.moveHandler(e,n);var ts=_&&!_.source,ta=C.isDrawingToolActive()?ts:_;this._topCanvasBinding.canvas.style.cursor=ta?"pointer":"inherit"}}}},t.prototype.mouseClickEvent=function(t){var e,n;if(null!==this._state){if(this._ignoreClickAfterMouseDownHandling)this._ignoreClickAfterMouseDownHandling=!1;else{var C=this._model();if(C.hasActiveIndicator())C.switchOffIndicator();else if(C.isDrawnToolEditing())null===(n=null===(e=C.drawingToolSource())||void 0===e?void 0:e.switchOff)||void 0===n||n.call(e);else{var _=t.localX,ts=t.localY,ta=C.crosshairSource().appliedIndex(),tl=this._model().getPaneIndex(O(this._state)),th=t.shiftKey;if(!C.isDrawingToolActive()&&!th){var tc=this.hitTest(_,ts);null!==tc&&void 0!==tc.view.clickHandler&&tc.view.clickHandler(_,ts)}this._clicked.hasListeners()&&this._clicked.fire(ta,{x:_,y:ts,paneIndex:tl}),!C.isDrawingToolActive()&&th&&void 0!==tl&&(this._model().addTool("ruler"),this._model().drawingToolSource().setFirstPoint({x:_,y:ts},ta,tl))}var td=C.options().drawingOptionsInternal;zt&&!td.saveMobileCrosshairOnClick&&(this._longTap=!1,this._exitTrackingModeOnNextTry=null!==this._startTrackPoint),this._tryExitTrackingMode()}}},t.prototype.pressedMouseMoveEvent=function(t){var e,n,C,_,ts=this;if(null!==this._state){setTimeout(function(){ts._ignoreClickAfterMouseDownHandling=!1},200);var ta,tl,th=this._model(),tc=t.localX,td=t.localY;if(null!==this._startTrackPoint){this._exitTrackingModeOnNextTry=!1;var tu=O(this._initCrosshairPosition);ta=tu.x+(tc-this._startTrackPoint.x),tl=tu.y+(td-this._startTrackPoint.y),this._setCrosshairPosition(ta,tl)}else this._preventCrosshairMove()||this._setCrosshairPosition(tc,td);if(!th.timeScale().isEmpty()){if(this._pressedMoving){this._topCanvasBinding.canvas.style.cursor="grabbing";var tp=this._pressedMoving,t8=tp.pointsToMove,tf=tp.startPoint,tv=this._pressedMoving.view;tv||(tv=null===(C=this.hitTest(null!==(e=null==tf?void 0:tf.x)&&void 0!==e?e:tc,null!==(n=null==tf?void 0:tf.y)&&void 0!==n?n:td))||void 0===C?void 0:C.view,this._pressedMoving.view=tv);var tg={x:null!=ta?ta:tc,y:null!=tl?tl:td};return null===(_=null==tv?void 0:tv.pressedMouseMoveHandler)||void 0===_||_.call(tv,tg,t8,tf),void(this._pressedMoving.startPoint=void 0)}var tm=this._chart.options(),ty=tm.handleScroll,t$=tm.kineticScroll;if(ty.pressedMouseMove&&"touch"!==t.type||(ty.horzTouchDrag||ty.vertTouchDrag)&&"mouse"!==t.type){var tS=this._state.defaultPriceScale(),tb=performance.now();null!==this._startScrollingPos||this._preventScroll()||(this._startScrollingPos={x:t.clientX,y:t.clientY,timestamp:tb,localX:t.localX,localY:t.localY}),null!==this._scrollXAnimation&&this._scrollXAnimation.addPosition(t.localX,tb),null===this._startScrollingPos||this._isScrolling||this._startScrollingPos.x===t.clientX&&this._startScrollingPos.y===t.clientY||(null===this._scrollXAnimation&&("touch"===t.type&&t$.touch||"mouse"===t.type&&t$.mouse)&&(this._scrollXAnimation=new zi(.2,7,.997,15),this._scrollXAnimation.addPosition(this._startScrollingPos.localX,this._startScrollingPos.timestamp),this._scrollXAnimation.addPosition(t.localX,tb)),tS.isEmpty()||th.startScrollPrice(this._state,tS,t.localY),th.startScrollTime(t.localX),this._isScrolling=!0),this._isScrolling&&(tS.isEmpty()||th.scrollPriceTo(this._state,tS,t.localY),th.scrollTimeTo(t.localX))}}}},t.prototype.mouseUpEvent=function(t){var e,n;if(null!==this._state){var C=this._model().options().drawingOptionsInternal;this._longTap=!1,this._pressedMoving&&(null===(n=null===(e=this._pressedMoving.view)||void 0===e?void 0:e.pressedMouseMoveFinish)||void 0===n||n.call(e),this._pressedMoving=null,zt&&!C.saveMobileCrosshairOnClick&&(this._exitTrackingModeOnNextTry=!0,this._tryExitTrackingMode())),this._endScroll(t)}},t.prototype.longTapEvent=function(t){if(this._longTap=!0,null===this._startTrackPoint&&Zi){var e={x:t.localX,y:t.localY};this.startTrackingMode(e,e)}},t.prototype.mouseLeaveEvent=function(t){null!==this._state&&(this._state.model().setHoveredSource(null),zt||this._clearCrosshairPosition(),this._model().drawnToolsSourcesForPane(this._state).forEach(function(t){return t.deactivate()}))},t.prototype.clicked=function(){return this._clicked},t.prototype.pinchStartEvent=function(){this._prevPinchScale=1,this._terminateKineticAnimation()},t.prototype.pinchEvent=function(t,e){if(this._chart.options().handleScale.pinch){var n=5*(e-this._prevPinchScale);this._prevPinchScale=e,this._model().zoomTime(t.x,n)}},t.prototype.hitTest=function(t,e){var n,C,_,ts,ta,tl=this._state;if(null===tl)return null;var th=this._model(),tc=th.isDrawingToolActive()?[th.drawingToolSource()]:th.drawnToolsSourcesForPane(tl);try{for(var td=g(tc),tu=td.next();!tu.done;tu=td.next())if((tm=tu.value)&&null!==(tg=this._hitTestPaneView(tm.paneViews(tl),t,e)))return{source:null,view:tg.view,object:tg.object}}catch(tp){n={error:tp}}finally{try{tu&&!tu.done&&(C=td.return)&&C.call(td)}finally{if(n)throw n.error}}var t8=tl.orderedSources();try{for(var tf=g(t8),tv=tf.next();!tv.done;tv=tf.next()){var tg,tm=tv.value;if(null!==(tg=this._hitTestPaneView(tm.paneViews(tl),t,e)))return{source:(null===(ta=tg.object)||void 0===ta?void 0:ta.noHoverHandling)?null:tm,view:tg.view,object:tg.object}}}catch(ty){_={error:ty}}finally{try{tv&&!tv.done&&(ts=tf.return)&&ts.call(tf)}finally{if(_)throw _.error}}var t$=this._hitTestPaneView(this._model().crosshairSource().paneViews(tl),t,e);return null!==t$?{source:null,view:t$.view,object:t$.object}:null},t.prototype.setPriceAxisSize=function(t,e){O("left"===e?this._leftPriceAxisWidget:this._rightPriceAxisWidget).setSize(new Ei(t,this._size.h))},t.prototype.getSize=function(){return this._size},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new S("Try to set invalid size to PaneWidget "+JSON.stringify(t));this._size.equals(t)||(this._size=t,this._topCanvasBinding.resizeCanvas({width:t.w,height:t.h}),this._canvasBinding.resizeCanvas({width:t.w,height:t.h}),this._paneCell.style.width=t.w+"px",this._paneCell.style.height=t.h+"px")},t.prototype.recalculatePriceScales=function(){var t,e,n=O(this._state);n.recalculatePriceScale(n.leftPriceScale()),n.recalculatePriceScale(n.rightPriceScale());try{for(var C=g(n.dataSources()),_=C.next();!_.done;_=C.next()){var ts=_.value;if(n.isOverlay(ts)){var ta=ts.priceScale();null!==ta&&n.recalculatePriceScale(ta),ts.updateAllViews()}}}catch(tl){t={error:tl}}finally{try{_&&!_.done&&(e=C.return)&&e.call(C)}finally{if(t)throw t.error}}},t.prototype.getImage=function(){return this._canvasBinding.canvas},t.prototype.getTopCanvas=function(){return this._topCanvasBinding.canvas},t.prototype.paint=function(t){if(0!==t&&null!==this._state){if(t>1&&this.recalculatePriceScales(),null!==this._leftPriceAxisWidget&&this._leftPriceAxisWidget.paint(t),null!==this._rightPriceAxisWidget&&this._rightPriceAxisWidget.paint(t),1!==t){var e=ki(this._canvasBinding.canvas);e.save(),this._drawBackground(e,this._canvasBinding.pixelRatio),this._state&&(this._drawLabel(),this._drawGrid(e,this._canvasBinding.pixelRatio),this._drawWatermark(e,this._canvasBinding.pixelRatio),this._model().options().drawingConfig.overlapSeries?(this._drawSources(e,this._canvasBinding.pixelRatio,Yi),this._drawDrawnTools(e,this._canvasBinding.pixelRatio)):(this._drawDrawnTools(e,this._canvasBinding.pixelRatio),this._drawSources(e,this._canvasBinding.pixelRatio,Yi))),e.restore()}var n=ki(this._topCanvasBinding.canvas);n.clearRect(0,0,Math.ceil(this._size.w*this._topCanvasBinding.pixelRatio),Math.ceil(this._size.h*this._topCanvasBinding.pixelRatio)),this._drawSources(n,this._canvasBinding.pixelRatio,Xi),this._model().isDrawingToolActive()&&this._drawDrawingTool(n,this._topCanvasBinding.pixelRatio),this._drawCrosshair(n,this._topCanvasBinding.pixelRatio)}},t.prototype.leftPriceAxisWidget=function(){return this._leftPriceAxisWidget},t.prototype.getPaneCell=function(){return this._paneCell},t.prototype.rightPriceAxisWidget=function(){return this._rightPriceAxisWidget},t.prototype._onStateDestroyed=function(){null!==this._state&&this._state.onDestroyed().unsubscribeAll(this),this._state=null},t.prototype._drawBackground=function(t,e){var n=this;ve(t,e,function(){var e=n._model(),C=e.backgroundTopColor(),_=e.backgroundBottomColor();C===_?ye(t,0,0,n._size.w,n._size.h,_):_e(t,0,0,n._size.w,n._size.h,C,_)})},t.prototype._drawGrid=function(t,e){var n=O(this._state),C=n.grid().paneView().renderer(n.height(),n.width(),n);null!==C&&(t.save(),C.draw(t,e,!1),t.restore())},t.prototype._drawLabel=function(){var t,e=this.state().options().label;if(e){for(t in this._labelElement||(this._labelElement=document.createElement("span"),this._labelElement.style.position="absolute",this._labelElement.style.borderRadius="4px",this._labelElement.style.padding="2px 6px",this._labelElement.style.pointerEvents="none",this._labelElement.style.zIndex="3",this._paneWrapper.appendChild(this._labelElement)),e.style){var n=e.style[t];t&&void 0!==n&&(this._labelElement.style[t]=n)}this._labelElement.innerText=e.text}else this._labelElement&&this._labelElement.remove()},t.prototype._drawWatermark=function(t,e){var n=this._model().watermarkSource();this._drawSourceImpl(t,e,Yi,qi,n),this._drawSourceImpl(t,e,Yi,Ki,n)},t.prototype._drawCrosshair=function(t,e){this._drawSourceImpl(t,e,Yi,Ki,this._model().crosshairSource())},t.prototype._drawDrawnTools=function(t,e){var n=this;this._state&&this._model().drawnToolsSourcesForPane(this._state).forEach(function(C){return n._drawSourceImpl(t,e,Yi,Ki,C)})},t.prototype._drawDrawingTool=function(t,e){if(this._state){var n=this._model().drawingToolSource();n&&this._drawSourceImpl(t,e,Yi,Ki,n)}},t.prototype._drawSources=function(t,e,n){var C,_,ts,ta,tl=O(this._state).orderedSources();try{for(var th=g(tl),tc=th.next();!tc.done;tc=th.next()){var td=tc.value;this._drawSourceImpl(t,e,n,qi,td)}}catch(tu){C={error:tu}}finally{try{tc&&!tc.done&&(_=th.return)&&_.call(th)}finally{if(C)throw C.error}}try{for(var tp=g(tl),t8=tp.next();!t8.done;t8=tp.next())td=t8.value,this._drawSourceImpl(t,e,n,Ki,td)}catch(tf){ts={error:tf}}finally{try{t8&&!t8.done&&(ta=tp.return)&&ta.call(tp)}finally{if(ts)throw ts.error}}},t.prototype._drawSourceImpl=function(t,e,n,C,_){var ts,ta,tl=O(this._state),th=n(_,tl),tc=tl.height(),td=tl.width(),tu=tl.model().hoveredSource(),tp=null!==tu&&tu.source===_,t8=null!==tu&&tp&&void 0!==tu.object?tu.object.hitTestData:void 0;try{for(var tf=g(th),tv=tf.next();!tv.done;tv=tf.next()){var tg=tv.value.renderer(tc,td,tl);null!==tg&&(t.save(),C(tg,t,e,tp,t8),t.restore())}}catch(tm){ts={error:tm}}finally{try{tv&&!tv.done&&(ta=tf.return)&&ta.call(tf)}finally{if(ts)throw ts.error}}},t.prototype._hitTestPaneView=function(t,e,n){var C,_,ts,ta,tl=O(this._state);try{for(var th=g(t),tc=th.next();!tc.done;tc=th.next()){var td=tc.value,tu=td.renderer(this._size.h,this._size.w,tl);if(null!==tu&&tu.hitTest){var tp=tu.hitTest(e,n);tp&&(ts=tp,ta=td)}}}catch(t8){C={error:t8}}finally{try{tc&&!tc.done&&(_=th.return)&&_.call(th)}finally{if(C)throw C.error}}return ts&&ta?{view:ta,object:ts}:null},t.prototype._recreatePriceAxisWidgets=function(){if(null!==this._state){var t=this._chart;t.options().leftPriceScale.visible||null===this._leftPriceAxisWidget||(this._leftAxisCell.removeChild(this._leftPriceAxisWidget.getElement()),this._leftPriceAxisWidget.destroy(),this._leftPriceAxisWidget=null),t.options().rightPriceScale.visible||null===this._rightPriceAxisWidget||(this._rightAxisCell.removeChild(this._rightPriceAxisWidget.getElement()),this._rightPriceAxisWidget.destroy(),this._rightPriceAxisWidget=null);var e=t.model().rendererOptionsProvider();t.options().leftPriceScale.visible&&null===this._leftPriceAxisWidget&&(this._leftPriceAxisWidget=new Ui(this,t.options().layout,e,"left"),this._leftAxisCell.appendChild(this._leftPriceAxisWidget.getElement())),t.options().rightPriceScale.visible&&null===this._rightPriceAxisWidget&&(this._rightPriceAxisWidget=new Ui(this,t.options().layout,e,"right"),this._rightAxisCell.appendChild(this._rightPriceAxisWidget.getElement()))}},t.prototype._preventCrosshairMove=function(){return Zi&&null===this._startTrackPoint},t.prototype._preventScroll=function(){return Zi&&this._longTap||null!==this._startTrackPoint},t.prototype._correctXCoord=function(t){return Math.max(0,Math.min(t,this._size.w-1))},t.prototype._correctYCoord=function(t){return Math.max(0,Math.min(t,this._size.h-1))},t.prototype._setCrosshairPosition=function(t,e){this._model().setAndSaveCurrentPosition(this._correctXCoord(t),this._correctYCoord(e),O(this._state))},t.prototype._clearCrosshairPosition=function(){this._model().clearCurrentPosition()},t.prototype._tryExitTrackingMode=function(){this._exitTrackingModeOnNextTry&&(this._startTrackPoint=null,this._clearCrosshairPosition())},t.prototype.startTrackingMode=function(t,e){this._startTrackPoint=t,this._exitTrackingModeOnNextTry=!1,this._setCrosshairPosition(e.x,e.y);var n=this._model().crosshairSource();this._initCrosshairPosition={x:n.appliedX(),y:n.appliedY()}},t.prototype._model=function(){return this._chart.model()},t.prototype._finishScroll=function(){var t=this._model(),e=this.state(),n=e.defaultPriceScale();t.endScrollPrice(e,n),t.endScrollTime(),this._startScrollingPos=null,this._isScrolling=!1},t.prototype._endScroll=function(t){var e=this;if(this._isScrolling){var n=performance.now();if(null!==this._scrollXAnimation&&this._scrollXAnimation.start(t.localX,n),null===this._scrollXAnimation||this._scrollXAnimation.finished(n))this._finishScroll();else{var C=this._model(),_=C.timeScale(),ts=this._scrollXAnimation,ta=function(){if(!ts.terminated()){var t=performance.now(),n=ts.finished(t);if(!ts.terminated()){var tl=_.rightOffset();C.scrollTimeTo(ts.getPosition(t)),tl===_.rightOffset()&&(n=!0,e._scrollXAnimation=null)}n?e._finishScroll():requestAnimationFrame(ta)}};requestAnimationFrame(ta)}}},t.prototype._terminateKineticAnimation=function(){var t=performance.now(),e=null===this._scrollXAnimation||this._scrollXAnimation.finished(t);null!==this._scrollXAnimation&&(e||this._finishScroll()),null!==this._scrollXAnimation&&(this._scrollXAnimation.terminate(),this._scrollXAnimation=null)},t}(),eo=function(){function t(t,e,n,C,_){var ts=this;this._invalidated=!0,this._size=new Ei(0,0),this._canvasConfiguredHandler=function(){return ts.paint(3)},this._isLeft="left"===t,this._rendererOptionsProvider=n.rendererOptionsProvider,this._options=e,this._borderVisible=C,this._bottomColor=_,this._cell=document.createElement("div"),this._cell.style.width="25px",this._cell.style.height="100%",this._cell.style.overflow="hidden",this._cell.style.borderTop="solid 1px "+this._options.timeScale.borderColor,this._canvasBinding=Ii(this._cell,new Ei(16,16)),this._canvasBinding.subscribeCanvasConfigured(this._canvasConfiguredHandler)}return t.prototype.destroy=function(){this._canvasBinding.unsubscribeCanvasConfigured(this._canvasConfiguredHandler),this._canvasBinding.destroy()},t.prototype.getElement=function(){return this._cell},t.prototype.getSize=function(){return this._size},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new S("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this._size.equals(t)||(this._size=t,this._canvasBinding.resizeCanvas({width:t.w,height:t.h}),this._cell.style.width=t.w+"px",this._cell.style.minWidth=t.w+"px",this._cell.style.height=t.h+"px",this._invalidated=!0)},t.prototype.paint=function(t){if((!(t<3)||this._invalidated)&&0!==this._size.w&&0!==this._size.h){this._invalidated=!1;var e=ki(this._canvasBinding.canvas);this._drawBackground(e,this._canvasBinding.pixelRatio),this._drawBorder(e,this._canvasBinding.pixelRatio)}},t.prototype.getImage=function(){return this._canvasBinding.canvas},t.prototype._drawBorder=function(t,e){if(this._borderVisible()){var n=this._size.w;this._cell.style.borderTop="solid 1px "+this._options.timeScale.borderColor,t.save(),t.fillStyle=this._options.timeScale.borderColor;var C=Math.floor(this._rendererOptionsProvider.options().borderSize*e),_=this._isLeft?Math.round(n*e)-C:0;t.fillRect(_,0,C,C),t.restore()}},t.prototype._drawBackground=function(t,e){var n=this;ve(t,e,function(){ye(t,0,0,n._size.w,n._size.h,n._bottomColor())})},t}();function to(t,e){return t.weight>e.weight?t:e}!function(t){t[t.BorderSize=1]="BorderSize",t[t.TickLength=3]="TickLength"}($i||($i={})),function(t){t[t.Default=0]="Default",t[t.EwResize=1]="EwResize"}(Ji||(Ji={}));var no=function(){function t(t){var e=this;this._leftStub=null,this._rightStub=null,this._rendererOptions=null,this._mouseDown=!1,this._size=new Ei(0,0),this._widthCache=new Qn(5),this._canvasConfiguredHandler=function(){return e._chart.model().lightUpdate()},this._topCanvasConfiguredHandler=function(){return e._chart.model().lightUpdate()},this._chart=t,this._options=t.options().layout,this._element=document.createElement("tr"),this._leftStubCell=document.createElement("td"),this._leftStubCell.style.padding="0",this._rightStubCell=document.createElement("td"),this._rightStubCell.style.padding="0",this._cell=document.createElement("td"),this._cell.style.height="25px",this._cell.style.padding="0",this._dv=document.createElement("div"),this._dv.style.width="100%",this._dv.style.height="100%",this._dv.style.position="relative",this._dv.style.overflow="hidden",this._cell.appendChild(this._dv),this._canvasBinding=Ii(this._dv,new Ei(16,16)),this._canvasBinding.subscribeCanvasConfigured(this._canvasConfiguredHandler);var n=this._canvasBinding.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this._topCanvasBinding=Ii(this._dv,new Ei(16,16)),this._topCanvasBinding.subscribeCanvasConfigured(this._topCanvasConfiguredHandler);var C=this._topCanvasBinding.canvas;C.style.position="absolute",C.style.zIndex="2",C.style.left="0",C.style.top="0",this._element.appendChild(this._leftStubCell),this._element.appendChild(this._cell),this._element.appendChild(this._rightStubCell),this._recreateStubs(),this._chart.model().priceScalesOptionsChanged().subscribe(this._recreateStubs.bind(this),this),this._mouseEventHandler=new Hi(this._topCanvasBinding.canvas,this,{treatVertTouchDragAsPageScroll:!0,treatHorzTouchDragAsPageScroll:!1})}return t.prototype.destroy=function(){this._mouseEventHandler.destroy(),null!==this._leftStub&&this._leftStub.destroy(),null!==this._rightStub&&this._rightStub.destroy(),this._topCanvasBinding.unsubscribeCanvasConfigured(this._topCanvasConfiguredHandler),this._topCanvasBinding.destroy(),this._canvasBinding.unsubscribeCanvasConfigured(this._canvasConfiguredHandler),this._canvasBinding.destroy()},t.prototype.getElement=function(){return this._element},t.prototype.leftStub=function(){return this._leftStub},t.prototype.rightStub=function(){return this._rightStub},t.prototype.mouseDownEvent=function(t){if(!this._mouseDown){this._mouseDown=!0;var e=this._chart.model();!e.timeScale().isEmpty()&&this._chart.options().handleScale.axisPressedMouseMove.time&&e.startScaleTime(t.localX)}},t.prototype.mouseDownOutsideEvent=function(){var t=this._chart.model();!t.timeScale().isEmpty()&&this._mouseDown&&(this._mouseDown=!1,this._chart.options().handleScale.axisPressedMouseMove.time&&t.endScaleTime())},t.prototype.pressedMouseMoveEvent=function(t){var e=this._chart.model();!e.timeScale().isEmpty()&&this._chart.options().handleScale.axisPressedMouseMove.time&&e.scaleTimeTo(t.localX)},t.prototype.mouseUpEvent=function(t){this._mouseDown=!1;var e=this._chart.model();e.timeScale().isEmpty()&&!this._chart.options().handleScale.axisPressedMouseMove.time||e.endScaleTime()},t.prototype.mouseDoubleClickEvent=function(){this._chart.options().handleScale.axisDoubleClickReset&&this._chart.model().resetTimeScale()},t.prototype.mouseEnterEvent=function(t){this._chart.model().options().handleScale.axisPressedMouseMove.time&&this._setCursor(1)},t.prototype.mouseLeaveEvent=function(t){this._setCursor(0)},t.prototype.getSize=function(){return this._size},t.prototype.setSizes=function(t,e,n){this._size&&this._size.equals(t)||(this._size=t,this._topCanvasBinding.resizeCanvas({width:t.w,height:t.h}),this._canvasBinding.resizeCanvas({width:t.w,height:t.h}),this._cell.style.width=t.w+"px",this._cell.style.height=t.h+"px"),null!==this._leftStub&&this._leftStub.setSize(new Ei(e,t.h)),null!==this._rightStub&&this._rightStub.setSize(new Ei(n,t.h))},t.prototype.optimalHeight=function(){var t=this._getRendererOptions();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.update=function(){this._chart.model().timeScale().marks()},t.prototype.getImage=function(){return this._canvasBinding.canvas},t.prototype.paint=function(t){if(0!==t){var e=ki(this._canvasBinding.canvas);1!==t&&(this._drawBackground(e,this._canvasBinding.pixelRatio),this._drawBorder(e,this._canvasBinding.pixelRatio),this._drawTickMarks(e,this._canvasBinding.pixelRatio),null!==this._leftStub&&this._leftStub.paint(t),null!==this._rightStub&&this._rightStub.paint(t));var n=ki(this._topCanvasBinding.canvas),C=this._topCanvasBinding.pixelRatio;n.clearRect(0,0,Math.ceil(this._size.w*C),Math.ceil(this._size.h*C));var _=this._chart.model().drawingToolSource();_&&this._drawLabels([_],n,this._canvasBinding.pixelRatio),this._drawLabels([this._chart.model().crosshairSource()],n,C)}},t.prototype._drawBackground=function(t,e){var n=this;ve(t,e,function(){ye(t,0,0,n._size.w,n._size.h,n._chart.model().backgroundBottomColor())})},t.prototype._drawBorder=function(t,e){if(this._chart.options().timeScale.borderVisible){t.save(),t.fillStyle=this._lineColor();var n=Math.max(1,Math.floor(this._getRendererOptions().borderSize*e));t.fillRect(0,0,Math.ceil(this._size.w*e),n),t.restore()}},t.prototype._drawTickMarks=function(t,e){var n=this,C=this._chart.model().timeScale().marks();if(C&&0!==C.length){var _=C.reduce(to,C[0]).weight;_>30&&_<40&&(_=30),t.save(),t.strokeStyle=this._lineColor();var ts=this._getRendererOptions(),ta=ts.borderSize+ts.tickLength+ts.paddingTop+ts.fontSize-ts.baselineOffset;t.textAlign="center",t.fillStyle=this._lineColor();var tl=Math.floor(this._getRendererOptions().borderSize*e),th=Math.max(1,Math.floor(e)),tc=Math.floor(.5*e);if(this._chart.model().timeScale().options().borderVisible){t.beginPath();for(var td=Math.round(ts.tickLength*e),tu=C.length;tu--;){var tp=Math.round(C[tu].coord*e);t.rect(tp-tc,tl,th,td)}t.fill()}t.fillStyle=this._textColor(),ve(t,e,function(){var e,ts,tl,th;t.font=n._baseFont();try{for(var tc=g(C),td=tc.next();!td.done;td=tc.next())if((t8=td.value).weight<_){var tu=t8.needAlignCoordinate?n._alignTickMarkLabelCoordinate(t,t8.coord,t8.label):t8.coord;t.fillText(t8.label,tu,ta)}}catch(tp){e={error:tp}}finally{try{td&&!td.done&&(ts=tc.return)&&ts.call(tc)}finally{if(e)throw e.error}}t.font=n._baseBoldFont();try{for(var t8,tf=g(C),tv=tf.next();!tv.done;tv=tf.next())(t8=tv.value).weight>=_&&(tu=t8.needAlignCoordinate?n._alignTickMarkLabelCoordinate(t,t8.coord,t8.label):t8.coord,t.fillText(t8.label,tu,ta))}catch(tg){tl={error:tg}}finally{try{tv&&!tv.done&&(th=tf.return)&&th.call(tf)}finally{if(tl)throw tl.error}}})}},t.prototype._alignTickMarkLabelCoordinate=function(t,e,n){var C=this._widthCache.measureText(t,n),_=Math.floor(e-C/2)+.5;return _<0?e+=Math.abs(0-_):_+C>this._size.w&&(e-=Math.abs(this._size.w-(_+C))),e},t.prototype._drawLabels=function(t,e,n){var C,_,ts,ta,tl=this._getRendererOptions();try{for(var th=g(t),tc=th.next();!tc.done;tc=th.next()){var td=tc.value;try{for(var tu=(ts=void 0,g(td.timeAxisViews())),tp=tu.next();!tp.done;tp=tu.next()){var t8=tp.value;e.save(),t8.renderer().draw(e,tl,n),e.restore()}}catch(tf){ts={error:tf}}finally{try{tp&&!tp.done&&(ta=tu.return)&&ta.call(tu)}finally{if(ts)throw ts.error}}}}catch(tv){C={error:tv}}finally{try{tc&&!tc.done&&(_=th.return)&&_.call(th)}finally{if(C)throw C.error}}},t.prototype._lineColor=function(){return this._chart.options().timeScale.borderColor},t.prototype._textColor=function(){return this._options.textColor},t.prototype._fontSize=function(){return this._options.fontSize},t.prototype._baseFont=function(){return wn(this._fontSize(),this._options.fontFamily)},t.prototype._baseBoldFont=function(){return wn(this._fontSize(),this._options.fontFamily,"bold")},t.prototype._getRendererOptions=function(){null===this._rendererOptions&&(this._rendererOptions={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new Qn});var t=this._rendererOptions,e=this._baseFont();if(t.font!==e){var n=this._fontSize();t.fontSize=n,t.font=e,t.paddingTop=Math.ceil(n/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(n/2),t.baselineOffset=Math.round(this._fontSize()/5),t.widthCache.reset()}return this._rendererOptions},t.prototype._setCursor=function(t){this._cell.style.cursor=1===t?"ew-resize":"default"},t.prototype._recreateStubs=function(){var t=this._chart.model(),e=t.options();e.leftPriceScale.visible||null===this._leftStub||(this._leftStubCell.removeChild(this._leftStub.getElement()),this._leftStub.destroy(),this._leftStub=null),e.rightPriceScale.visible||null===this._rightStub||(this._rightStubCell.removeChild(this._rightStub.getElement()),this._rightStub.destroy(),this._rightStub=null);var n={rendererOptionsProvider:this._chart.model().rendererOptionsProvider()},C=function(){return e.leftPriceScale.borderVisible&&t.timeScale().options().borderVisible},_=function(){return t.backgroundBottomColor()};e.leftPriceScale.visible&&null===this._leftStub&&(this._leftStub=new eo("left",e,n,C,_),this._leftStubCell.appendChild(this._leftStub.getElement())),e.rightPriceScale.visible&&null===this._rightStub&&(this._rightStub=new eo("right",e,n,C,_),this._rightStubCell.appendChild(this._rightStub.getElement()))},t}(),ro=function(){function t(t,e){var n,C=this;this._paneWidgets=[],this._paneSeparators=[],this._drawRafId=0,this._height=0,this._width=0,this._leftPriceAxisWidth=0,this._rightPriceAxisWidth=0,this._invalidateMask=null,this._drawPlanned=!1,this._clicked=new Delegate,this._crosshairMoved=new Delegate,this.activeToolChangeHandler=function(t){var e;if(t.options){var n,_=((n=t.options).anotherPane,n.paneIndex,m(n,["anotherPane","paneIndex"]));t.options=_}null===(e=C.onActiveToolChange)||void 0===e||e.call(C,t)},this.debugger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return console.log.apply(console,y(["DEBUGGER"],v(t),!1))},this._element=document.createElement("div"),this._element.classList.add("tv-lightweight-charts"),this._element.style.overflow="hidden",this._element.style.width="100%",this._element.style.height="100%",(n=this._element).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this._tableElement=document.createElement("table"),this._tableElement.setAttribute("cellspacing","0"),this._element.appendChild(this._tableElement),this._onWheelBound=this._onMousewheel.bind(this),this._element.addEventListener("wheel",this._onWheelBound,{passive:!1}),this._model=new Si(this,this._invalidateHandler.bind(this),e),this.model().crosshairMoved().subscribe(this._onPaneWidgetCrosshairMoved.bind(this),this),this._timeAxisWidget=new no(this),this._tableElement.appendChild(this._timeAxisWidget.getElement());var _=e.width,ts=e.height;if(0===_||0===ts){var ta=t.getBoundingClientRect();0===_&&(_=Math.floor(ta.width),_-=_%2),0===ts&&(ts=Math.floor(ta.height),ts-=ts%2)}this.resize(_,ts),this._syncGuiWithModel(),t.appendChild(this._element),this._updateTimeAxisVisibility(),this._model.timeScale().optionsApplied().subscribe(this._model.fullUpdate.bind(this._model),this),this._model.priceScalesOptionsChanged().subscribe(this._model.fullUpdate.bind(this._model),this)}return t.prototype.model=function(){return this._model},t.prototype.options=function(){return this.model().options()},t.prototype.paneWidgets=function(){return this._paneWidgets},t.prototype.destroy=function(){var t,e,n,C;this._element.removeEventListener("wheel",this._onWheelBound),0!==this._drawRafId&&window.cancelAnimationFrame(this._drawRafId),this._model.crosshairMoved().unsubscribeAll(this),this._model.timeScale().optionsApplied().unsubscribeAll(this),this._model.priceScalesOptionsChanged().unsubscribeAll(this),this._model.destroy(),this.onActiveToolChange=void 0,this.saveHandler=void 0,this.debugger=void 0;try{for(var _=g(this._paneWidgets),ts=_.next();!ts.done;ts=_.next()){var ta=ts.value;this._tableElement.removeChild(ta.getElement()),ta.clicked().unsubscribeAll(this),ta.destroy()}}catch(tl){t={error:tl}}finally{try{ts&&!ts.done&&(e=_.return)&&e.call(_)}finally{if(t)throw t.error}}this._paneWidgets=[];try{for(var th=g(this._paneSeparators),tc=th.next();!tc.done;tc=th.next()){var td=tc.value;this._destroySeparator(td)}}catch(tu){n={error:tu}}finally{try{tc&&!tc.done&&(C=th.return)&&C.call(th)}finally{if(n)throw n.error}}this._paneSeparators=[],O(this._timeAxisWidget).destroy(),null!==this._element.parentElement&&this._element.parentElement.removeChild(this._element),this._crosshairMoved.destroy(),this._clicked.destroy()},t.prototype.resize=function(t,e,n){if(void 0===n&&(n=!1),this._height!==e||this._width!==t){this._height=e,this._width=t;var C=e+"px",_=t+"px";O(this._element).style.height=C,O(this._element).style.width=_,this._tableElement.style.height=C,this._tableElement.style.width=_,n?this._drawImpl(new kn(3)):this._model.fullUpdate()}},t.prototype.paint=function(t){void 0===t&&(t=new kn(3));for(var e=0;e<this._paneWidgets.length;e++)this._paneWidgets[e].paint(t.invalidateForPane(e).level);this._timeAxisWidget.paint(t.fullInvalidation())},t.prototype.applyOptions=function(t){this._model.applyOptions(t,!1),this._updateTimeAxisVisibility(),this._paneSeparators.forEach(function(t){return t.update()});var e=t.width||this._width,n=t.height||this._height;this.resize(e,n)},t.prototype.clicked=function(){return this._clicked},t.prototype.crosshairMoved=function(){return this._crosshairMoved},t.prototype.takeScreenshot=function(){var t=this;null!==this._invalidateMask&&(this._drawImpl(this._invalidateMask),this._invalidateMask=null);var e=this._paneWidgets[0],n=Ti(document,new Ei(this._width,this._height)),C=ki(n),_=Mi(n);return ve(C,_,function(){var n=0,_=0,ts=function(e){for(var ts=0;ts<t._paneWidgets.length;ts++){var ta=t._paneWidgets[ts],tl=ta.getSize().h,th=O("left"===e?ta.leftPriceAxisWidget():ta.rightPriceAxisWidget()),tc=th.getImage();if(C.drawImage(tc,n,_,th.getWidth(),tl),_+=tl,ts<t._paneWidgets.length-1){var td=t._paneSeparators[ts],tu=td.getSize(),tp=td.getImage();C.drawImage(tp,n,_,tu.w,tu.h),_+=tu.h}}};t._isLeftAxisVisible()&&(ts("left"),n=O(e.leftPriceAxisWidget()).getWidth()),_=0;for(var ta=0;ta<t._paneWidgets.length;ta++){var tl=t._paneWidgets[ta],th=tl.getSize(),tc=tl.getImage();if(C.drawImage(tc,n,_,th.w,th.h),_+=th.h,ta<t._paneWidgets.length-1){var td=t._paneSeparators[ta],tu=td.getSize(),tp=td.getImage();C.drawImage(tp,n,_,tu.w,tu.h),_+=tu.h}}n+=e.getSize().w,t._isRightAxisVisible()&&(_=0,ts("right"));var t8=function(e){var ts=O("left"===e?t._timeAxisWidget.leftStub():t._timeAxisWidget.rightStub()),ta=ts.getSize(),tl=ts.getImage();C.drawImage(tl,n,_,ta.w,ta.h)};if(t.options().timeScale.visible){n=0,t._isLeftAxisVisible()&&(t8("left"),n=O(e.leftPriceAxisWidget()).getWidth());var tf=t._timeAxisWidget.getSize();tc=t._timeAxisWidget.getImage(),C.drawImage(tc,n,_,tf.w,tf.h),t._isRightAxisVisible()&&(n+=e.getSize().w,t8("right"),C.restore())}}),n},t.prototype.getPriceAxisWidth=function(t){if("none"===t||"left"===t&&!this._isLeftAxisVisible()||"right"===t&&!this._isRightAxisVisible()||0===this._paneWidgets.length)return 0;var e=this.model().mainPaneIndex;return O("left"===t?this._paneWidgets[e].leftPriceAxisWidget():this._paneWidgets[e].rightPriceAxisWidget()).getWidth()},t.prototype.focusTopCanvas=function(){this._paneWidgets[this.model().mainPaneIndex].getTopCanvas().focus()},t.prototype.adjustSize=function(){this._adjustSizeImpl()},t.prototype._adjustSizeImpl=function(){var t,e,n,C,_,ts=0,ta=0,tl=0;try{for(var th=g(this._paneWidgets),tc=th.next();!tc.done;tc=th.next()){var td=tc.value;this._isLeftAxisVisible()&&(ta=Math.max(ta,O(td.leftPriceAxisWidget()).optimalWidth())),this._isRightAxisVisible()&&(tl=Math.max(tl,O(td.rightPriceAxisWidget()).optimalWidth())),ts+=td.stretchFactor()}}catch(tu){n={error:tu}}finally{try{tc&&!tc.done&&(C=th.return)&&C.call(th)}finally{if(n)throw n.error}}var tp=this._width,t8=this._height,tf=Math.max(tp-ta-tl,0),tv=1*this._paneSeparators.length,tg=this.options().timeScale.visible?this._timeAxisWidget.optimalHeight():0;tg%2&&(tg+=1);for(var tm=tv+tg,ty=t8<tm?0:t8-tm,t$=ty/ts,tS=0,tb=(null===(_=document.defaultView)||void 0===_?void 0:_.devicePixelRatio)||1,tw=0;tw<this._paneWidgets.length;++tw)(td=this._paneWidgets[tw]).setState(this._model.panes()[tw]),e=tw===this._paneWidgets.length-1?Math.ceil((ty-tS)*tb)/tb:Math.round(td.stretchFactor()*t$*tb)/tb,tS+=t=Math.max(e,2),td.setSize(new Ei(tf,t)),this._isLeftAxisVisible()&&td.setPriceAxisSize(ta,"left"),this._isRightAxisVisible()&&td.setPriceAxisSize(tl,"right"),td.state()&&this._model.setPaneHeight(td.state(),t);this._timeAxisWidget.setSizes(new Ei(tf,tg),ta,tl),this._model.setWidth(tf),this._leftPriceAxisWidth!==ta&&(this._leftPriceAxisWidth=ta),this._rightPriceAxisWidth!==tl&&(this._rightPriceAxisWidth=tl)},t.prototype._onMousewheel=function(t){var e=t.deltaX/100,n=-t.deltaY/100;if(0!==e&&this.options().handleScroll.mouseWheel||0!==n&&this.options().handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120,n*=120;break;case t.DOM_DELTA_LINE:e*=32,n*=32}if(0!==n&&this.options().handleScale.mouseWheel){var C=Math.sign(n)*Math.min(1,Math.abs(n)),_=t.clientX-this._element.getBoundingClientRect().left;this.model().zoomTime(_,C)}0!==e&&this.options().handleScroll.mouseWheel&&this.model().scrollChart(-80*e)}},t.prototype._drawImpl=function(t){var e,n,C=t.fullInvalidation();if(3===C&&this._updateGui(),3===C||2===C){for(var _=this._model.panes(),ts=0;ts<_.length;ts++)t.invalidateForPane(ts).autoScale&&_[ts].momentaryAutoScale();var ta=t.timeScaleInvalidations();try{for(var tl=g(ta),th=tl.next();!th.done;th=tl.next()){var tc=th.value;this._applyTimeScaleInvalidation(tc)}}catch(td){e={error:td}}finally{try{th&&!th.done&&(n=tl.return)&&n.call(tl)}finally{if(e)throw e.error}}ta.length>0&&(this._model.recalculateAllPanes(),this._model.updateCrosshair(),this._model.lightUpdate()),this._timeAxisWidget.update()}this.paint(t)},t.prototype._applyTimeScaleInvalidation=function(t){var e=this._model.timeScale();switch(t.type){case 0:e.fitContent();break;case 1:e.setLogicalRange(t.value);break;case 2:e.setBarSpacing(t.value);break;case 3:e.setRightOffset(t.value);break;case 4:e.restoreDefault()}},t.prototype._invalidateHandler=function(t){var e=this;null!==this._invalidateMask?this._invalidateMask.merge(t):this._invalidateMask=t,this._drawPlanned||(this._drawPlanned=!0,this._drawRafId=window.requestAnimationFrame(function(){e._drawPlanned=!1,e._drawRafId=0,null!==e._invalidateMask&&(e._drawImpl(e._invalidateMask),e._invalidateMask=null)}))},t.prototype._updateGui=function(){this._syncGuiWithModel()},t.prototype._destroySeparator=function(t){this._tableElement.removeChild(t.getElement()),t.destroy()},t.prototype._syncGuiWithModel=function(){for(var t=this._model.panes(),e=t.length,n=this._paneWidgets.length,C=e;C<n;C++){var _=P(this._paneWidgets.pop());this._tableElement.removeChild(_.getElement()),_.clicked().unsubscribeAll(this),_.destroy(),void 0!==(ts=this._paneSeparators.pop())&&this._destroySeparator(ts)}for(C=n;C<e;C++){if((_=new Qi(this,t[C])).clicked().subscribe(this._onPaneWidgetClicked.bind(this),this),this._paneWidgets.push(_),C>0){var ts=new Ri(this,C-1,C,!1);this._paneSeparators.push(ts),this._tableElement.insertBefore(ts.getElement(),this._timeAxisWidget.getElement())}this._tableElement.insertBefore(_.getElement(),this._timeAxisWidget.getElement())}for(C=0;C<e;C++){var ta=t[C];(_=this._paneWidgets[C]).state()!==ta?_.setState(ta):_.updatePriceAxisWidgets()}this._updateTimeAxisVisibility(),this._adjustSizeImpl()},t.prototype._getMouseEventParamsImpl=function(t,e){var n,C=new Map;if(null!==t&&this._model.serieses().forEach(function(e){var n=e.dataAt(t);null!==n&&C.set(e,n)}),null!==t){var _=this._model.timeScale().indexToTime(t);null!==_&&(n=_)}var ts,ta,tl=this.model().hoveredSource(),th=null!==tl&&tl.source instanceof yi?tl.source:void 0;return(null==tl?void 0:tl.object)&&(ts=tl.object.externalId,ta=tl.object.internalType),{time:n,timeIndex:t,point:e&&{x:e.x,y:e.y}||void 0,paneIndex:null==e?void 0:e.paneIndex,hoveredSeries:th,seriesPrices:C,hoveredObject:ts,objectType:ta}},t.prototype._onPaneWidgetClicked=function(t,e){var n=this;this._clicked.fire(function(){return n._getMouseEventParamsImpl(t,e)}),this.model().clicked().fire(t,e)},t.prototype._onPaneWidgetCrosshairMoved=function(t,e){var n=this;this._crosshairMoved.fire(function(){return n._getMouseEventParamsImpl(t,e)})},t.prototype._updateTimeAxisVisibility=function(){var t=this.options().timeScale.visible?"":"none";this._timeAxisWidget.getElement().style.display=t},t.prototype._isLeftAxisVisible=function(){return this.options().leftPriceScale.visible},t.prototype._isRightAxisVisible=function(){return this.options().rightPriceScale.visible},t}();function io(t,e,n){return{index:e,time:t,value:[n.open,n.high,n.low,n.close]}}function oo(t){return void 0!==t.value}function ao(t){return function(e,n,C){var _;return void 0===(_=C).open&&void 0===_.value?{time:e,index:n}:t(e,n,C)}}var so={Candlestick:ao(io),Bar:ao(io),Area:ao(io),Histogram:ao(function(t,e,n){var C=n.value,_={index:e,time:t,value:[C,C,C,C]};return"color"in n&&void 0!==n.color&&(_.color=n.color),_}),Line:ao(io)};function lo(t){return so[t]}function co(t){return 60*t*6e4}function uo(t){return 60*t*1e3}var ho=[{divisor:1,weight:20},{divisor:1e3,weight:19},{divisor:uo(1),weight:20},{divisor:uo(5),weight:21},{divisor:uo(30),weight:22},{divisor:co(1),weight:30},{divisor:co(3),weight:31},{divisor:co(6),weight:32},{divisor:co(12),weight:33}];function po(t,e){if(null!==e){var n=new Date(1e3*e),C=new Date(1e3*t);if(C.getUTCFullYear()!==n.getUTCFullYear())return 70;if(C.getUTCMonth()!==n.getUTCMonth())return 60;if(C.getUTCDate()!==n.getUTCDate())return 50;for(var _=ho.length-1;_>=0;--_)if(Math.floor(n.getTime()/ho[_].divisor)!==Math.floor(C.getTime()/ho[_].divisor))return ho[_].weight}return 20}function fo(t){if(!Lt(t))throw new S("time must be of type BusinessDay");return{timestamp:Math.round(new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0)).getTime()/1e3),businessDay:t}}function mo(t){if(!Rt(t))throw new S("time must be of type isUTCTimestamp");return{timestamp:t}}function go(t){return 0===t.length?null:Lt(t[0].time)?fo:mo}function vo(t){return Rt(t)?mo(t):Lt(t)?fo(t):fo(yo(t))}function yo(t){var e=new Date(t);if(isNaN(e.getTime()))throw new S("Invalid date string="+t+", expected format=yyyy-mm-dd");return{day:e.getUTCDate(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}}function _o(t){B(t.time)&&(t.time=yo(t.time))}function Co(t){return{index:0,mapping:new Map,timePoint:t}}var bo=function(){function t(){this._pointDataByTimePoint=new Map,this._seriesRowsBySeries=new Map,this._seriesLastTimePoint=new Map,this._sortedTimePoints=[]}return t.prototype.destroy=function(){this._pointDataByTimePoint.clear(),this._seriesRowsBySeries.clear(),this._seriesLastTimePoint.clear(),this._sortedTimePoints=[]},t.prototype.setSeriesData=function(t,e){var n=this;this._seriesLastTimePoint.has(t)&&this._pointDataByTimePoint.forEach(function(e){return e.mapping.delete(t)});var C=[];if(0!==e.length){!function(t){t.forEach(_o)}(e);var _=O(go(e)),ts=lo(t.seriesType());C=e.map(function(e){var C=_(e.time),ta=n._pointDataByTimePoint.get(C.timestamp);void 0===ta&&(ta=Co(C),n._pointDataByTimePoint.set(C.timestamp,ta));var tl=ts(C,ta.index,e);return ta.mapping.set(t,tl),tl})}return this._cleanupPointsData(),this._setRowsToSeries(t,C),this._syncIndexesAndApplyChanges(t)},t.prototype.removeSeries=function(t){return this.setSeriesData(t,[])},t.prototype.updateSeriesData=function(t,e){_o(e);var n=O(go([e]))(e.time),C=this._seriesLastTimePoint.get(t);if(void 0!==C&&n.timestamp<C.timestamp)throw new S("Cannot update oldest data, last time="+C.timestamp+", new time="+n.timestamp);var _=this._pointDataByTimePoint.get(n.timestamp),ts=void 0===_;void 0===_&&(_=Co(n),this._pointDataByTimePoint.set(n.timestamp,_));var ta=lo(t.seriesType())(n,_.index,e);_.mapping.set(t,ta);var tl=this._updateLastSeriesRow(t,ta);if(!ts){var th=new Map;return null!==tl&&th.set(t,tl),{series:th,timeScale:{baseIndex:this._getBaseIndex()}}}return this._syncIndexesAndApplyChanges(t)},t.prototype._updateLastSeriesRow=function(t,e){var n=this._seriesRowsBySeries.get(t);void 0===n&&(n=[],this._seriesRowsBySeries.set(t,n));var C=0!==n.length?n[n.length-1]:null,_=null;return null===C||e.time.timestamp>C.time.timestamp?oo(e)&&(n.push(e),_={fullUpdate:!1,data:[e]}):oo(e)?(n[n.length-1]=e,_={fullUpdate:!1,data:[e]}):(n.splice(-1,1),_={fullUpdate:!0,data:n}),this._seriesLastTimePoint.set(t,e.time),_},t.prototype._setRowsToSeries=function(t,e){0!==e.length?(this._seriesRowsBySeries.set(t,e.filter(oo)),this._seriesLastTimePoint.set(t,e[e.length-1].time)):(this._seriesRowsBySeries.delete(t),this._seriesLastTimePoint.delete(t))},t.prototype._cleanupPointsData=function(){var t=new Map;this._pointDataByTimePoint.forEach(function(e,n){e.mapping.size>0&&t.set(n,e)}),this._pointDataByTimePoint=t},t.prototype._updateTimeScalePoints=function(t){for(var e=-1,n=0;n<this._sortedTimePoints.length&&n<t.length;++n){var C=this._sortedTimePoints[n],_=t[n];if(C.time.timestamp!==_.time.timestamp){e=n;break}_.timeWeight=C.timeWeight}if(-1===e&&this._sortedTimePoints.length!==t.length&&(e=Math.min(this._sortedTimePoints.length,t.length)),-1===e)return -1;var ts=function(e){var n=P(ta._pointDataByTimePoint.get(t[e].time.timestamp));n.index=e,n.mapping.forEach(function(t){t.index=e})},ta=this;for(n=e;n<t.length;++n)ts(n);return function(t,e){void 0===e&&(e=0);for(var n=0===e||0===t.length?null:t[e-1].time.timestamp,C=0,_=e;_<t.length;++_){var ts=t[_];ts.timeWeight=po(ts.time.timestamp,n),C+=ts.time.timestamp-(n||ts.time.timestamp),n=ts.time.timestamp}if(0===e&&t.length>1){var ta=Math.ceil(C/(t.length-1)),tl=t[0].time.timestamp-ta;t[0].timeWeight=po(t[0].time.timestamp,tl)}}(t,e),this._sortedTimePoints=t,e},t.prototype._getBaseIndex=function(){if(0===this._seriesRowsBySeries.size)return null;var t=0;return this._seriesRowsBySeries.forEach(function(e){0!==e.length&&(t=Math.max(t,e[e.length-1].index))}),t},t.prototype._syncIndexesAndApplyChanges=function(t){var e=Array.from(this._pointDataByTimePoint.values()).map(function(t){return{timeWeight:0,time:t.timePoint}});e.sort(function(t,e){return t.time.timestamp-e.time.timestamp});var n=this._updateTimeScalePoints(e),C={series:new Map,timeScale:{baseIndex:this._getBaseIndex()}};if(-1!==n)this._seriesRowsBySeries.forEach(function(t,e){C.series.set(e,{data:t,fullUpdate:!0})}),this._seriesRowsBySeries.has(t)||C.series.set(t,{data:[],fullUpdate:!0}),C.timeScale.points=this._sortedTimePoints;else{var _=this._seriesRowsBySeries.get(t);C.series.set(t,{data:_||[],fullUpdate:!0})}return C},t}(),wo={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,axisLabelVisible:!0,title:""},xo=function(){function t(t){this._priceLine=t}return t.prototype.applyOptions=function(t){this._priceLine.applyOptions(t)},t.prototype.options=function(){return this._priceLine.options()},t.prototype.priceLine=function(){return this._priceLine},t}();function So(t){var e=t.overlay,n=m(t,["overlay"]);return e&&(n.priceScaleId=""),n}var Eo,Mo=function(){function t(t,e,n){this._series=t,this._dataUpdatesConsumer=e,this._priceScaleApiProvider=n}return t.prototype.priceFormatter=function(){return this._series.formatter()},t.prototype.priceToCoordinate=function(t){var e=this._series.firstValue();return null===e?null:this._series.priceScale().priceToCoordinate(t,e.value)},t.prototype.coordinateToPrice=function(t){var e=this._series.firstValue();return null===e?null:this._series.priceScale().coordinateToPrice(t,e.value)},t.prototype.barsInLogicalRange=function(t){if(null===t)return null;var e=new ft(new lt(t.from,t.to)).strictRange(),n=this._series.bars();if(n.isEmpty())return null;var C=n.search(e.left(),1),_=n.search(e.right(),-1),ts=O(n.firstIndex()),ta=O(n.lastIndex());if(null!==C&&null!==_&&C.index>_.index)return{barsBefore:t.from-ts,barsAfter:ta-t.to};var tl={barsBefore:null===C||C.index===ts?t.from-ts:C.index-ts,barsAfter:null===_||_.index===ta?ta-t.to:ta-_.index};return null!==C&&null!==_&&(tl.from=C.time.businessDay||C.time.timestamp,tl.to=_.time.businessDay||_.time.timestamp),tl},t.prototype.setData=function(t){this._series.seriesType(),this._dataUpdatesConsumer.applyNewData(this._series,t)},t.prototype.update=function(t){this._series.seriesType(),this._dataUpdatesConsumer.updateData(this._series,t)},t.prototype.setMarkers=function(t){var e=t.map(function(t){return f(f({},t),{time:vo(t.time)})});this._series.setMarkers(e)},t.prototype.applyOptions=function(t){var e=So(t);this._series.applyOptions(e)},t.prototype.options=function(){return z(this._series.options())},t.prototype.priceScale=function(){return this._priceScaleApiProvider.priceScale(this._series.priceScale().id())},t.prototype.createPriceLine=function(t){var e=L(z(wo),t),n=this._series.createPriceLine(e);return new xo(n)},t.prototype.removePriceLine=function(t){this._series.removePriceLine(t.priceLine())},t.prototype.seriesType=function(){return this._series.seriesType()},t}(),ko=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.applyOptions=function(e){ee(e),t.prototype.applyOptions.call(this,e)},e}(Mo),To={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,drawTicks:!0,scaleMargins:{bottom:.1,top:.1}},Io={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:bn,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},Ho={width:0,height:0,cursor:"crosshair",layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:bn,markersFontSize:10},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:f({},To),leftPriceScale:f(f({},To),{visible:!1}),rightPriceScale:f(f({},To),{visible:!0}),nonPrimaryPriceScale:f(f({},To),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0},watermark:Io,localization:{locale:b?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},activeDrawingTool:null,drawingOptionsInternal:{},drawingConfig:{defaultOptions:{ruler:{colorUp:"#18D888",colorDown:"#FF7373",backgroundUp:"rgba(13, 128, 80, 0.24)",backgroundDown:"rgba(192, 58, 58, 0.24)",tooltipBackground:"#333F4A",tooltipColor:"#CFD6DA",tooltipShadow:"0 0 8px rgba(51, 63, 74, 0.24)",tooltipBoldFont:"normal 500 13px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif",tooltipFont:"normal 400 13px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif",tooltipBoldLineHeight:"16px",tooltipLineHeight:"16px",defaultCrosshairColor:"#336FEE"},trendLineSegment:{lineColor:"Blue",lineStyle:0,circlesBackground:"#FFFFFF",lineWidth:o.medium,paneIndex:0},trendLineBeam:{lineColor:"Blue",lineStyle:0,circlesBackground:"#FFFFFF",lineWidth:o.medium,paneIndex:0},horizontalLine:{lineColor:"Blue",lineStyle:0,circlesBackground:"#FFFFFF",lineWidth:o.medium,paneIndex:0}},colors:i,eventHandler:function(){},overlapSeries:!0,blockClickHandlers:!0,blockCrosshairMoveHandlers:!0},drawnTools:[],kineticScroll:{mouse:!1,touch:!0},timeframe:"D",sessionsSchedule:{startTime:"10:00",endTime:"18:45",holidays:[],timezoneOffset:3},activeIndicatorId:null,indicators:[],indicatorsConfig:{defaultOptions:{SMA:{lineColor:"Blue",lineStyle:0,circlesBackground:"#FFFFFF",lineWidth:o.medium,length:20,anotherPane:!1},EMA:{lineColor:"Blue",lineStyle:0,circlesBackground:"#FFFFFF",lineWidth:o.medium,length:20,anotherPane:!1},RSI:{lineColor:"Blue",circlesBackground:"#FFFFFF",lineWidth:o.medium,length:14,anotherPane:!0,label:{text:{},style:{backgroundColor:"",color:"rgba(199, 201, 204, 1)"}},background:{levels:{low:30,high:70,middle:50},linesColor:"#C7C9CC",linesStyle:3}},MACD:{colorsPair:["Blue","Orange"],circlesBackground:"#FFFFFF",lineWidth:o.medium,shortLength:12,longLength:26,signalLength:9,anotherPane:!0,label:{text:{},style:{backgroundColor:"",color:"rgba(199, 201, 204, 1)"}},histogramColors:{positive:"rgba(11, 176, 109, 0.56)",negative:"rgba(213, 54, 69, 0.56)",positiveLight:"rgba(11, 176, 109, 0.32)",negativeLight:"rgba(213, 54, 69, 0.32)"}},STOCH:{colorsPair:["Blue","Orange"],lineStylePair:[0,3],circlesBackground:"#FFFFFF",lineWidth:o.medium,KLength:14,KSmoothing:1,DSmoothing:3,anotherPane:!0,label:{text:{},style:{backgroundColor:"",color:"rgba(199, 201, 204, 1)"}},background:{levels:{low:20,high:80},linesColor:"#C7C9CC",linesStyle:3}}},eventHandler:function(){},overlapSeries:!0},panes:[]},No={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Po={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Oo={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Do={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ao={color:"#26a69a",base:0},Lo={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01},isMain:!1},Ro=function(){function t(t,e){this._chartWidget=t,this._priceScaleId=e}return t.prototype.applyOptions=function(t){this._chartWidget.model().applyPriceScaleOptions(this._priceScaleId,t)},t.prototype.options=function(){return this._priceScale().options()},t.prototype.width=function(){return en(this._priceScaleId)?this._chartWidget.getPriceAxisWidth("left"===this._priceScaleId?"left":"right"):0},t.prototype._priceScale=function(){return O(this._chartWidget.model().findPriceScale(this._priceScaleId)).priceScale},t}();!function(t){t[t.AnimationDurationMs=1e3]="AnimationDurationMs"}(Eo||(Eo={}));var Fo=function(){function t(t){this._timeRangeChanged=new Delegate,this._logicalRangeChanged=new Delegate,this._model=t,this._timeScale().visibleBarsChanged().subscribe(this._onVisibleBarsChanged.bind(this)),this._timeScale().logicalRangeChanged().subscribe(this._onVisibleLogicalRangeChanged.bind(this))}return t.prototype.destroy=function(){this._timeScale().visibleBarsChanged().unsubscribeAll(this),this._timeScale().logicalRangeChanged().unsubscribeAll(this),this._timeRangeChanged.destroy()},t.prototype.scrollPosition=function(){return this._timeScale().rightOffset()},t.prototype.scrollToPosition=function(t,e){e?this._timeScale().scrollToOffsetAnimated(t,1e3):this._model.setRightOffset(t)},t.prototype.scrollToRealTime=function(){this._timeScale().scrollToRealTime()},t.prototype.getVisibleRange=function(){var t,e,n=this._timeScale().visibleTimeRange();return null===n?null:{from:null!==(t=n.from.businessDay)&&void 0!==t?t:n.from.timestamp,to:null!==(e=n.to.businessDay)&&void 0!==e?e:n.to.timestamp}},t.prototype.setVisibleRange=function(t){var e={from:vo(t.from),to:vo(t.to)},n=this._timeScale().logicalRangeForTimeRange(e);this._model.setTargetLogicalRange(n)},t.prototype.getVisibleLogicalRange=function(){var t=this._timeScale().visibleLogicalRange();return null===t?null:{from:t.left(),to:t.right()}},t.prototype.setVisibleLogicalRange=function(t){N(t.from<=t.to,"The from index cannot be after the to index."),this._model.setTargetLogicalRange(t)},t.prototype.resetTimeScale=function(){this._model.resetTimeScale()},t.prototype.fitContent=function(){this._model.fitContent()},t.prototype.logicalToCoordinate=function(t){var e=this._model.timeScale();return e.isEmpty()?null:e.indexToCoordinate(t)},t.prototype.coordinateToLogical=function(t){var e=this._model.timeScale();return e.isEmpty()?null:e.coordinateToIndex(t)},t.prototype.timeToCoordinate=function(t){var e=vo(t),n=this._model.timeScale(),C=n.timeToIndex(e,!1);return null===C?null:n.indexToCoordinate(C)},t.prototype.coordinateToTime=function(t){var e,n=this._model.timeScale(),C=n.coordinateToIndex(t),_=n.indexToTime(C);return null===_?null:null!==(e=_.businessDay)&&void 0!==e?e:_.timestamp},t.prototype.subscribeVisibleTimeRangeChange=function(t){this._timeRangeChanged.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this._timeRangeChanged.unsubscribe(t)},t.prototype.subscribeVisibleLogicalRangeChange=function(t){this._logicalRangeChanged.subscribe(t)},t.prototype.unsubscribeVisibleLogicalRangeChange=function(t){this._logicalRangeChanged.unsubscribe(t)},t.prototype.applyOptions=function(t){this._timeScale().applyOptions(t)},t.prototype.options=function(){return z(this._timeScale().options())},t.prototype._timeScale=function(){return this._model.timeScale()},t.prototype._onVisibleBarsChanged=function(){this._timeRangeChanged.hasListeners()&&this._timeRangeChanged.fire(this.getVisibleRange())},t.prototype._onVisibleLogicalRangeChanged=function(){this._logicalRangeChanged.hasListeners()&&this._logicalRangeChanged.fire(this.getVisibleLogicalRange())},t}();function Bo(t){if(void 0!==t&&"custom"!==t.type){var e=t;void 0!==e.minMove&&void 0===e.precision&&(e.precision=te(e.minMove))}}function Vo(t){var e;return function(t){if(V(t.handleScale)){var e=t.handleScale;t.handleScale={axisDoubleClickReset:e,axisPressedMouseMove:{time:e,price:e},mouseWheel:e,pinch:e}}else if(void 0!==t.handleScale&&V(t.handleScale.axisPressedMouseMove)){var n=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:n,price:n}}var C=t.handleScroll;V(C)&&(t.handleScroll={horzTouchDrag:C,vertTouchDrag:C,mouseWheel:C,pressedMouseMove:C})}(t),function(t){if(t.priceScale){t.leftPriceScale=t.leftPriceScale||{},t.rightPriceScale=t.rightPriceScale||{};var e=t.priceScale.position;delete t.priceScale.position,t.leftPriceScale=L(t.leftPriceScale,t.priceScale),t.rightPriceScale=L(t.rightPriceScale,t.priceScale),"left"===e&&(t.leftPriceScale.visible=!0,t.rightPriceScale.visible=!1),"right"===e&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!0),"none"===e&&(t.leftPriceScale.visible=!1,t.rightPriceScale.visible=!1),t.overlayPriceScales=t.overlayPriceScales||{},void 0!==t.priceScale.invertScale&&(t.overlayPriceScales.invertScale=t.priceScale.invertScale),void 0!==t.priceScale.scaleMargins&&(t.overlayPriceScales.scaleMargins=t.priceScale.scaleMargins)}}(t),(e=t).layout&&e.layout.backgroundColor&&!e.layout.background&&(e.layout.background={type:"solid",color:e.layout.backgroundColor}),function(t){var e,n;y(y([],v(null!==(e=t.drawnTools)&&void 0!==e?e:[]),!1),v(null!==(n=t.indicators)&&void 0!==n?n:[]),!1).forEach(function(t){var e,n=t.options;void 0!==n&&(n.paneIndex=null!==(e=n.paneIndex)&&void 0!==e?e:0)})}(t),t}var zo=function(){function t(t,e){var n=this;this._dataLayer=new bo,this._seriesMap=new Map,this._seriesMapReversed=new Map,this._clickedDelegate=new Delegate,this._crosshairMovedDelegate=new Delegate,this.onActiveToolChange=function(t){n._chartWidget.onActiveToolChange=t},this.registerDebug=function(t){n._chartWidget.debugger=t},this.onSaveNeeded=function(t){n._chartWidget.saveHandler=t};var C=void 0===e?z(Ho):L(z(Ho),Vo(e));this._chartWidget=new ro(t,C),this._chartWidget.clicked().subscribe(function(t){var e=n.options(),C=e.activeDrawingTool,_=e.drawingConfig.blockClickHandlers&&C;n._clickedDelegate.hasListeners()&&!_&&n._clickedDelegate.fire(n._convertMouseParams(t()))},this),this._chartWidget.crosshairMoved().subscribe(function(t){var e=n.options(),C=e.activeDrawingTool,_=e.drawingConfig.blockCrosshairMoveHandlers&&C;n._crosshairMovedDelegate.hasListeners()&&!_&&n._crosshairMovedDelegate.fire(n._convertMouseParams(t()))},this);var _=this._chartWidget.model();this._timeScaleApi=new Fo(_)}return t.prototype.remove=function(){this._chartWidget.clicked().unsubscribeAll(this),this._chartWidget.crosshairMoved().unsubscribeAll(this),this._timeScaleApi.destroy(),this._chartWidget.destroy(),this._seriesMap.clear(),this._seriesMapReversed.clear(),this._clickedDelegate.destroy(),this._crosshairMovedDelegate.destroy(),this._dataLayer.destroy(),be.clear()},t.prototype.resize=function(t,e,n){this._chartWidget.resize(t,e,n)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),Bo((t=So(t)).priceFormat);var e=L(z(Lo),Do,t),n=this._chartWidget.model().createSeries("Area",e),C=new Mo(n,this,this);return this._seriesMap.set(C,n),this._seriesMapReversed.set(n,C),C},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),Bo((t=So(t)).priceFormat);var e=L(z(Lo),Po,t),n=this._chartWidget.model().createSeries("Bar",e),C=new Mo(n,this,this);return this._seriesMap.set(C,n),this._seriesMapReversed.set(n,C),C},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),ee(t=So(t)),Bo(t.priceFormat);var e=L(z(Lo),No,t),n=this._chartWidget.model().createSeries("Candlestick",e),C=new ko(n,this,this);return this._seriesMap.set(C,n),this._seriesMapReversed.set(n,C),C},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),Bo((t=So(t)).priceFormat);var e=L(z(Lo),Ao,t),n=this._chartWidget.model().createSeries("Histogram",e),C=new Mo(n,this,this);return this._seriesMap.set(C,n),this._seriesMapReversed.set(n,C),C},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),Bo((t=So(t)).priceFormat);var e=L(z(Lo),Oo,t),n=this._chartWidget.model().createSeries("Line",e),C=new Mo(n,this,this);return this._seriesMap.set(C,n),this._seriesMapReversed.set(n,C),C},t.prototype.removeSeries=function(t){var e=P(this._seriesMap.get(t)),n=this._dataLayer.removeSeries(e);this._chartWidget.model().removeSeries(e),this._sendUpdateToChart(n),this._seriesMap.delete(t),this._seriesMapReversed.delete(e)},t.prototype.focus=function(){this._chartWidget.focusTopCanvas()},t.prototype.addTool=function(t){this._chartWidget.model().addTool(t)},t.prototype.removeActiveTool=function(){this._chartWidget.model().removeActiveTool()},t.prototype.setActiveToolOptions=function(t){this._chartWidget.model().setActiveToolOptions(t)},t.prototype.switchOffTool=function(){this._chartWidget.model().switchOffTool()},t.prototype.applyNewData=function(t,e){this._sendUpdateToChart(this._dataLayer.setSeriesData(t,e))},t.prototype.updateData=function(t,e){this._sendUpdateToChart(this._dataLayer.updateSeriesData(t,e))},t.prototype.subscribeClick=function(t){this._clickedDelegate.subscribe(t)},t.prototype.unsubscribeClick=function(t){this._clickedDelegate.unsubscribe(t)},t.prototype.subscribeCrosshairMove=function(t){this._crosshairMovedDelegate.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this._crosshairMovedDelegate.unsubscribe(t)},t.prototype.priceScale=function(t){return void 0===t&&(t=this._chartWidget.model().defaultVisiblePriceScaleId()),new Ro(this._chartWidget,t)},t.prototype.timeScale=function(){return this._timeScaleApi},t.prototype.applyOptions=function(t){var e=Vo(t);this._chartWidget.applyOptions(e)},t.prototype.options=function(){return this._chartWidget.model().options()},t.prototype.takeScreenshot=function(){return this._chartWidget.takeScreenshot()},t.prototype.getPaneIndicatorsCount=function(){return this._chartWidget.model().getIndicators().filter(function(t){return t.options.anotherPane}).length},t.prototype.removePane=function(t){this._chartWidget.model().removePane({index:t})},t.prototype.swapPane=function(t,e){this._chartWidget.model().swapPane(t,e)},t.prototype.getPaneElements=function(){return this._chartWidget.paneWidgets().map(function(t){return t.getPaneCell()})},t.prototype._sendUpdateToChart=function(t){var e=this._chartWidget.model();e.updateTimeScale(t.timeScale.baseIndex,t.timeScale.points),t.series.forEach(function(t,e){return e.updateData(t.data,t.fullUpdate)}),e.recalculateAllPanes()},t.prototype._mapSeriesToApi=function(t){return P(this._seriesMapReversed.get(t))},t.prototype._convertMouseParams=function(t){var e=this,n=new Map;t.seriesPrices.forEach(function(t,C){n.set(e._mapSeriesToApi(C),t)});var C=void 0===t.hoveredSeries?void 0:this._mapSeriesToApi(t.hoveredSeries);return{time:t.time&&(t.time.businessDay||t.time.timestamp),timeIndex:t.timeIndex,point:t.point,paneIndex:t.paneIndex,hoveredSeries:C,hoveredItemId:t.hoveredObject,seriesPrices:n,itemType:t.objectType}},t}();function createChart(t,e){var n;if(B(t)){var C=document.getElementById(t);N(null!==C,"Cannot find element in DOM with id="+t),n=C}else n=t;return new zo(n,e)}export{createChart,CrosshairMode,Delegate,LineStyle};
